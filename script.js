import"./_snowpack/pkg/bootstrap.js";import"./_snowpack/pkg/bootstrap/dist/css/bootstrap.min.css.proxy.js";import c from"./_snowpack/pkg/axios.js";import p from"./_snowpack/pkg/pretty-bytes.js";import y from"./setupEditor.js";const{requestEditor:S,updateResponseEditor:v}=y(),q=document.querySelector("[data-form]"),d=document.querySelector("[data-query-params]"),u=document.querySelector("[data-request-headers]"),k=document.querySelector("[data-key-value-template]"),s=document.querySelector("[data-response-headers]");d.append(n()),u.append(n()),document.querySelector("[data-add-query-param-btn]").addEventListener("click",e=>{d.append(n())}),document.querySelector("[data-add-request-header-btn]").addEventListener("click",e=>{u.append(n())});function i(e){return e.customData=e.customData||{},e.customData.time=new Date().getTime()-e.config.customData.startTime,e}function f(e){const a=JSON.stringify(e.data).length,t=JSON.stringify(e.headers).length;document.querySelector("[data-status]").textContent=e.status,document.querySelector("[data-time]").textContent=e.customData.time,document.querySelector("[data-size]").textContent=p(a+t)}function h(e){s.innerHTML="",Object.entries(e).forEach(([a,t])=>{const r=document.createElement("div");r.textContent=a,s.append(r);const o=document.createElement("div");o.textContent=t,s.append(o)})}function n(){const e=k.content.cloneNode(!0);return e.querySelector("[data-remove-btn]").addEventListener("click",a=>{a.target.closest("[data-key-value-pair]").remove()}),e}function m(e){return[...e.querySelectorAll("[data-key-value-pair]")].reduce((t,r)=>{const o=r.querySelector("[data-key]").value,l=r.querySelector("[data-value]").value;return o===""?t:{...t,[o]:l}},{})}c.interceptors.request.use(e=>(e.customData=e.customData||{},e.customData.startTime=new Date().getTime(),e)),c.interceptors.response.use(i,e=>Promise.reject(i(e.response))),q.addEventListener("submit",e=>{e.preventDefault();let a;try{a=JSON.parse(S.state.doc.toString()||null)}catch(t){alert("JSON data is malformed");return}c({url:document.querySelector("[data-url]").value,method:document.querySelector("[data-method]").value,params:m(d),headers:m(u),data:a}).catch(t=>t).then(t=>{document.querySelector("[data-response-section]").classList.remove("d-none"),f(t),v(t.data),h(t.headers)})}),window.addEventListener("load",()=>{document.querySelector("body").removeAttribute("hidden")});
