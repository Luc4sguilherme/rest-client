import"./_snowpack/pkg/bootstrap.js";import"./_snowpack/pkg/bootstrap/dist/css/bootstrap.min.css.proxy.js";import l from"./_snowpack/pkg/axios.js";import p from"./_snowpack/pkg/pretty-bytes.js";import y from"./setupEditor.js";const{requestEditor:q,updateResponseEditor:S}=y(),v=document.querySelector("[data-form]"),c=document.querySelector("[data-query-params]"),s=document.querySelector("[data-request-headers]"),f=document.querySelector("[data-key-value-template]"),u=document.querySelector("[data-response-headers]");c.append(o()),s.append(o()),document.querySelector("[data-add-query-param-btn]").addEventListener("click",e=>{c.append(o())}),document.querySelector("[data-add-request-header-btn]").addEventListener("click",e=>{s.append(o())});function d(e){return e.customData=e.customData||{},e.customData.time=new Date().getTime()-e.config.customData.startTime,e}function k(e){const t=JSON.stringify(e.data).length,a=JSON.stringify(e.headers).length;document.querySelector("[data-status]").textContent=e.status,document.querySelector("[data-time]").textContent=e.customData.time,document.querySelector("[data-size]").textContent=p(t+a)}function h(e){u.innerHTML="",Object.entries(e).forEach(([t,a])=>{const r=document.createElement("div");r.textContent=t,u.append(r);const n=document.createElement("div");n.textContent=a,u.append(n)})}function o(){const e=f.content.cloneNode(!0);return e.querySelector("[data-remove-btn]").addEventListener("click",t=>{t.target.closest("[data-key-value-pair]").remove()}),e}function i(e){return[...e.querySelectorAll("[data-key-value-pair]")].reduce((a,r)=>{const n=r.querySelector("[data-key]").value,m=r.querySelector("[data-value]").value;return n===""?a:{...a,[n]:m}},{})}function E(e){const t=l.create({baseURL:document.querySelector("[data-url]").value,method:document.querySelector("[data-method]").value,params:i(c),headers:i(s),data:e});return t.interceptors.request.use(a=>(a.customData=a.customData||{},a.customData.startTime=new Date().getTime(),a)),t.interceptors.response.use(d,a=>Promise.reject(d(a.response))),t}function b(e){e().catch(t=>t).then(t=>{document.querySelector("[data-response-section]").classList.remove("d-none"),k(t),S(t.data),h(t.headers)})}v.addEventListener("submit",e=>{e.preventDefault();let t;try{t=JSON.parse(q.state.doc.toString()||null)}catch(r){alert("JSON data is malformed");return}const a=E(t);b(a)}),window.addEventListener("load",()=>{document.querySelector("body").removeAttribute("hidden")});
