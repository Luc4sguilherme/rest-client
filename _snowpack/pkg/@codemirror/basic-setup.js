import{E as y,F as w,c as X,S as V,a as m,T as Oe,C as Ai,b as Ei,A as Re,d as x,M as Pe,R as I,V as $,B as ct,P as ht,D as le,e as ft,f as v,W as ut,g as dt,h as R,i as E,j as ae,k as Ie,l as mt,r as Li,m as ce,n as pt,o as gt,p as Di,q as Oi,s as Ri,t as Pi,u as Ii,v as Bi}from"../common/index-58a76124.js";export{u as EditorState}from"../common/index-58a76124.js";import{f as he,l as bt,s as xt,i as Ni}from"../common/index-5d650ab5.js";import{b as Vi,d as $i}from"../common/index-546591ea.js";import{d as Hi}from"../common/index-87116b74.js";const Be=Re.define(),Fi=Re.define(),qi=w.define(),vt=w.define({combine(i){return X(i,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function zi(i){let e=0;return i.iterChangedRanges((t,n)=>e=n),e}const yt=V.define({create(){return P.empty},update(i,e){let t=e.state.facet(vt),n=e.annotation(Be);if(n){let a=e.docChanged?m.single(zi(e.changes)):void 0,c=S.fromTransaction(e,a),h=n.side,f=h==0?i.undone:i.done;return c?f=ue(f,f.length,t.minDepth,c):f=kt(f,e.startState.selection),new P(h==0?n.rest:f,h==0?f:n.rest)}let s=e.annotation(Fi);if((s=="full"||s=="before")&&(i=i.isolate()),e.annotation(Oe.addToHistory)===!1)return e.changes.empty?i:i.addMapping(e.changes.desc);let o=S.fromTransaction(e),r=e.annotation(Oe.time),l=e.annotation(Oe.userEvent);return o?i=i.addChanges(o,r,l,t.newGroupDelay,t.minDepth):e.selection&&(i=i.addSelection(e.startState.selection,r,l,t.newGroupDelay)),(s=="full"||s=="after")&&(i=i.isolate()),i},toJSON(i){return{done:i.done.map(e=>e.toJSON()),undone:i.undone.map(e=>e.toJSON())}},fromJSON(i){return new P(i.done.map(S.fromJSON),i.undone.map(S.fromJSON))}});function Wi(i={}){return[yt,vt.of(i),y.domEventHandlers({beforeinput(e,t){let n=e.inputType=="historyUndo"?wt:e.inputType=="historyRedo"?Ct:null;return n?(e.preventDefault(),n(t)):!1}})]}function fe(i,e){return function({state:t,dispatch:n}){if(!e&&t.readOnly)return!1;let s=t.field(yt,!1);if(!s)return!1;let o=s.pop(i,t,e);return o?(n(o),!0):!1}}const wt=fe(0,!1),Ct=fe(1,!1),Ui=fe(0,!0),Gi=fe(1,!0);class S{constructor(e,t,n,s,o){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=s,this.selectionsAfter=o}setSelAfter(e){return new S(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(e){return new S(e.changes&&Ai.fromJSON(e.changes),[],e.mapped&&Ei.fromJSON(e.mapped),e.startSelection&&m.fromJSON(e.startSelection),e.selectionsAfter.map(m.fromJSON))}static fromTransaction(e,t){let n=L;for(let s of e.startState.facet(qi)){let o=s(e);o.length&&(n=n.concat(o))}return!n.length&&e.changes.empty?null:new S(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,L)}static selection(e){return new S(void 0,L,void 0,void 0,e)}}function ue(i,e,t,n){let s=e+1>t+20?e-t-1:0,o=i.slice(s,e);return o.push(n),o}function ji(i,e){let t=[],n=!1;return i.iterChangedRanges((s,o)=>t.push(s,o)),e.iterChangedRanges((s,o,r,l)=>{for(let a=0;a<t.length;){let c=t[a++],h=t[a++];l>=c&&r<=h&&(n=!0)}}),n}function Ji(i,e){return i.ranges.length==e.ranges.length&&i.ranges.filter((t,n)=>t.empty!=e.ranges[n].empty).length===0}function St(i,e){return i.length?e.length?i.concat(e):i:e}const L=[],Ki=200;function kt(i,e){if(i.length){let t=i[i.length-1],n=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-Ki));return n.length&&n[n.length-1].eq(e)?i:(n.push(e),ue(i,i.length-1,1e9,t.setSelAfter(n)))}else return[S.selection([e])]}function Qi(i){let e=i[i.length-1],t=i.slice();return t[i.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Ne(i,e){if(!i.length)return i;let t=i.length,n=L;for(;t;){let s=_i(i[t-1],e,n);if(s.changes&&!s.changes.empty||s.effects.length){let o=i.slice(0,t);return o[t-1]=s,o}else e=s.mapped,t--,n=s.selectionsAfter}return n.length?[S.selection(n)]:L}function _i(i,e,t){let n=St(i.selectionsAfter.length?i.selectionsAfter.map(l=>l.map(e)):L,t);if(!i.changes)return S.selection(n);let s=i.changes.map(e),o=e.mapDesc(i.changes,!0),r=i.mapped?i.mapped.composeDesc(o):o;return new S(s,x.mapEffects(i.effects,e),r,i.startSelection.map(o),n)}const Xi=/^(input\.type|delete)($|\.)/;class P{constructor(e,t,n=0,s=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=s}isolate(){return this.prevTime?new P(this.done,this.undone):this}addChanges(e,t,n,s,o){let r=this.done,l=r[r.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!n||Xi.test(n))&&(!l.selectionsAfter.length&&t-this.prevTime<s&&ji(l.changes,e.changes)||n=="input.type.compose")?r=ue(r,r.length-1,o,new S(e.changes.compose(l.changes),St(e.effects,l.effects),l.mapped,l.startSelection,L)):r=ue(r,r.length,o,e),new P(r,L,t,n)}addSelection(e,t,n,s){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:L;return o.length>0&&t-this.prevTime<s&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Ji(o[o.length-1],e)?this:new P(kt(this.done,e),this.undone,t,n)}addMapping(e){return new P(Ne(this.done,e),Ne(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let s=e==0?this.done:this.undone;if(s.length==0)return null;let o=s[s.length-1];if(n&&o.selectionsAfter.length)return t.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:Be.of({side:e,rest:Qi(s)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let r=s.length==1?L:s.slice(0,s.length-1);return o.mapped&&(r=Ne(r,o.mapped)),t.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:Be.of({side:e,rest:r}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}P.empty=new P(L,L);const Yi=[{key:"Mod-z",run:wt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Ct,preventDefault:!0},{key:"Mod-u",run:Ui,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Gi,preventDefault:!0}];class B extends ft{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}B.prototype.elementClass="",B.prototype.toDOM=void 0,B.prototype.mapMode=Pe.TrackBefore,B.prototype.startSide=B.prototype.endSide=-1,B.prototype.point=!0;const de=w.define(),Zi={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>I.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Y=w.define();function en(i){return[Mt(),Y.of(Object.assign(Object.assign({},Zi),i))]}const tn=y.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}}),Ve=w.define({combine:i=>i.some(e=>e)});function Mt(i){let e=[nn,tn];return i&&i.fixed===!1&&e.push(Ve.of(!0)),e}const nn=$.fromClass(class{constructor(i){this.view=i,this.prevViewport=i.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=i.state.facet(Y).map(e=>new Et(i,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!i.state.facet(Ve),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),i.scrollDOM.insertBefore(this.dom,i.contentDOM)}update(i){if(this.updateGutters(i)){let e=this.prevViewport,t=i.view.viewport,n=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(n<(t.to-t.from)*.8)}i.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Ve)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=i.view.viewport}syncGutters(i){let e=this.dom.nextSibling;i&&this.dom.remove();let t=I.iter(this.view.state.facet(de),this.view.viewport.from),n=[],s=this.gutters.map(o=>new sn(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks){let r;if(Array.isArray(o.type)){for(let l of o.type)if(l.type==ct.Text){r=l;break}}else r=o.type==ct.Text?o:void 0;if(!!r){n.length&&(n=[]),At(t,n,o.from);for(let l of s)l.line(this.view,r,n)}}for(let o of s)o.finish();i&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(i){let e=i.startState.facet(Y),t=i.state.facet(Y),n=i.docChanged||i.heightChanged||i.viewportChanged||!I.eq(i.startState.facet(de),i.state.facet(de),i.view.viewport.from,i.view.viewport.to);if(e==t)for(let s of this.gutters)s.update(i)&&(n=!0);else{n=!0;let s=[];for(let o of t){let r=e.indexOf(o);r<0?s.push(new Et(this.view,o)):(this.gutters[r].update(i),s.push(this.gutters[r]))}for(let o of this.gutters)o.dom.remove(),s.indexOf(o)<0&&o.destroy();for(let o of s)this.dom.appendChild(o.dom);this.gutters=s}return n}destroy(){for(let i of this.gutters)i.destroy();this.dom.remove()}},{provide:ht.scrollMargins.from(i=>i.gutters.length==0||!i.fixed?null:i.view.textDirection==le.LTR?{left:i.dom.offsetWidth}:{right:i.dom.offsetWidth})});function Tt(i){return Array.isArray(i)?i:[i]}function At(i,e,t){for(;i.value&&i.from<=t;)i.from==t&&e.push(i.value),i.next()}class sn{constructor(e,t,n){this.gutter=e,this.height=n,this.localMarkers=[],this.i=0,this.cursor=I.iter(e.markers,t.from)}line(e,t,n){this.localMarkers.length&&(this.localMarkers=[]),At(this.cursor,this.localMarkers,t.from);let s=n.length?this.localMarkers.concat(n):this.localMarkers,o=this.gutter.config.lineMarker(e,t,s);o&&s.unshift(o);let r=this.gutter;if(s.length==0&&!r.config.renderEmptyElements)return;let l=t.top-this.height;if(this.i==r.elements.length){let a=new Lt(e,t.height,l,s);r.elements.push(a),r.dom.appendChild(a.dom)}else r.elements[this.i].update(e,t.height,l,s);this.height=t.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Et{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in t.domEventHandlers)this.dom.addEventListener(n,s=>{let o=e.lineBlockAtHeight(s.clientY-e.documentTop);t.domEventHandlers[n](e,o,s)&&s.preventDefault()});this.markers=Tt(t.markers(e)),t.initialSpacer&&(this.spacer=new Lt(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Tt(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let n=e.view.viewport;return!I.eq(this.markers,t,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Lt{constructor(e,t,n,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.update(e,t,n,s)}update(e,t,n,s){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),on(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,t){let n="cm-gutterElement",s=this.dom.firstChild;for(let o=0,r=0;;){let l=r,a=o<t.length?t[o++]:null,c=!1;if(a){let h=a.elementClass;h&&(n+=" "+h);for(let f=r;f<this.markers.length;f++)if(this.markers[f].compare(a)){l=f,c=!0;break}}else l=this.markers.length;for(;r<l;){let h=this.markers[r++];if(h.toDOM){h.destroy(s);let f=s.nextSibling;s.remove(),s=f}}if(!a)break;a.toDOM&&(c?s=s.nextSibling:this.dom.insertBefore(a.toDOM(e),s)),c&&r++}this.dom.className=n,this.markers=t}destroy(){this.setMarkers(null,[])}}function on(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(!i[t].compare(e[t]))return!1;return!0}const rn=w.define(),j=w.define({combine(i){return X(i,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let n=Object.assign({},e);for(let s in t){let o=n[s],r=t[s];n[s]=o?(l,a,c)=>o(l,a,c)||r(l,a,c):r}return n}})}});class $e extends B{constructor(e){super();this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function He(i,e){return i.state.facet(j).formatNumber(e,i.state)}const ln=Y.compute([j],i=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(rn)},lineMarker(e,t,n){return n.some(s=>s.toDOM)?null:new $e(He(e,e.state.doc.lineAt(t.from).number))},lineMarkerChange:e=>e.startState.facet(j)!=e.state.facet(j),initialSpacer(e){return new $e(He(e,Dt(e.state.doc.lines)))},updateSpacer(e,t){let n=He(t.view,Dt(t.view.state.doc.lines));return n==e.number?e:new $e(n)},domEventHandlers:i.facet(j).domEventHandlers}));function an(i={}){return[j.of(i),Mt(),ln]}function Dt(i){let e=9;for(;e<i;)e=e*10+9;return e}const cn=new class extends B{constructor(){super(...arguments);this.elementClass="cm-activeLineGutter"}},hn=de.compute(["selection"],i=>{let e=[],t=-1;for(let n of i.selection.ranges)if(n.empty){let s=i.doc.lineAt(n.head).from;s>t&&(t=s,e.push(cn.range(s)))}return I.of(e)});function fn(){return hn}function Ot(i,e){let t=e.mapPos(i.from,1),n=e.mapPos(i.to,-1);return t>=n?void 0:{from:t,to:n}}const me=x.define({map:Ot}),Z=x.define({map:Ot});function Rt(i){let e=[];for(let{head:t}of i.state.selection.ranges)e.some(n=>n.from<=t&&n.to>=t)||e.push(i.lineBlockAt(t));return e}const q=V.define({create(){return v.none},update(i,e){i=i.map(e.changes);for(let t of e.effects)t.is(me)&&!un(i,t.value.from,t.value.to)?i=i.update({add:[vn.range(t.value.from,t.value.to)]}):t.is(Z)&&(i=i.update({filter:(n,s)=>t.value.from!=n||t.value.to!=s,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:n}=e.selection.main;i.between(n,n,(s,o)=>{s<n&&o>n&&(t=!0)}),t&&(i=i.update({filterFrom:n,filterTo:n,filter:(s,o)=>o<=n||s>=n}))}return i},provide:i=>y.decorations.from(i)});function pe(i,e,t){var n;let s=null;return(n=i.field(q,!1))===null||n===void 0||n.between(e,t,(o,r)=>{(!s||s.from>o)&&(s={from:o,to:r})}),s}function un(i,e,t){let n=!1;return i.between(e,e,(s,o)=>{s==e&&o==t&&(n=!0)}),n}function Pt(i,e){return i.field(q,!1)?e:e.concat(x.appendConfig.of(Nt()))}const dn=i=>{for(let e of Rt(i)){let t=he(i.state,e.from,e.to);if(t)return i.dispatch({effects:Pt(i.state,[me.of(t),It(i,t)])}),!0}return!1},mn=i=>{if(!i.state.field(q,!1))return!1;let e=[];for(let t of Rt(i)){let n=pe(i.state,t.from,t.to);n&&e.push(Z.of(n),It(i,n,!1))}return e.length&&i.dispatch({effects:e}),e.length>0};function It(i,e,t=!0){let n=i.state.doc.lineAt(e.from).number,s=i.state.doc.lineAt(e.to).number;return y.announce.of(`${i.state.phrase(t?"Folded lines":"Unfolded lines")} ${n} ${i.state.phrase("to")} ${s}.`)}const pn=i=>{let{state:e}=i,t=[];for(let n=0;n<e.doc.length;){let s=i.lineBlockAt(n),o=he(e,s.from,s.to);o&&t.push(me.of(o)),n=(o?i.lineBlockAt(o.to):s).to+1}return t.length&&i.dispatch({effects:Pt(i.state,t)}),!!t.length},gn=i=>{let e=i.state.field(q,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,i.state.doc.length,(n,s)=>{t.push(Z.of({from:n,to:s}))}),i.dispatch({effects:t}),!0},bn=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:dn},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:mn},{key:"Ctrl-Alt-[",run:pn},{key:"Ctrl-Alt-]",run:gn}],xn={placeholderDOM:null,placeholderText:"…"},Bt=w.define({combine(i){return X(i,xn)}});function Nt(i){let e=[q,Cn];return i&&e.push(Bt.of(i)),e}const vn=v.replace({widget:new class extends ut{toDOM(i){let{state:e}=i,t=e.facet(Bt),n=o=>{let r=i.lineBlockAt(i.posAtDOM(o.target)),l=pe(i.state,r.from,r.to);l&&i.dispatch({effects:Z.of(l)}),o.preventDefault()};if(t.placeholderDOM)return t.placeholderDOM(i,n);let s=document.createElement("span");return s.textContent=t.placeholderText,s.setAttribute("aria-label",e.phrase("folded code")),s.title=e.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}}}),yn={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{}};class Fe extends B{constructor(e,t){super();this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function wn(i={}){let e=Object.assign(Object.assign({},yn),i),t=new Fe(e,!0),n=new Fe(e,!1),s=$.fromClass(class{constructor(r){this.from=r.viewport.from,this.markers=this.buildMarkers(r)}update(r){(r.docChanged||r.viewportChanged||r.startState.facet(bt)!=r.state.facet(bt)||r.startState.field(q,!1)!=r.state.field(q,!1))&&(this.markers=this.buildMarkers(r.view))}buildMarkers(r){let l=new dt;for(let a of r.viewportLineBlocks){let c=pe(r.state,a.from,a.to)?n:he(r.state,a.from,a.to)?t:null;c&&l.add(a.from,a.from,c)}return l.finish()}}),{domEventHandlers:o}=e;return[s,en({class:"cm-foldGutter",markers(r){var l;return((l=r.plugin(s))===null||l===void 0?void 0:l.markers)||I.empty},initialSpacer(){return new Fe(e,!1)},domEventHandlers:Object.assign(Object.assign({},o),{click:(r,l,a)=>{if(o.click&&o.click(r,l,a))return!0;let c=pe(r.state,l.from,l.to);if(c)return r.dispatch({effects:Z.of(c)}),!0;let h=he(r.state,l.from,l.to);return h?(r.dispatch({effects:me.of(h)}),!0):!1}})}),Nt()]}const Cn=y.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),ge={brackets:["(","[","{","'",'"'],before:`)]}'":;>`},z=x.define({map(i,e){let t=e.mapPos(i,-1,Pe.TrackAfter);return t??void 0}}),qe=x.define({map(i,e){return e.mapPos(i)}}),ze=new class extends ft{};ze.startSide=1,ze.endSide=-1;const Vt=V.define({create(){return I.empty},update(i,e){if(e.selection){let t=e.state.doc.lineAt(e.selection.main.head).from,n=e.startState.doc.lineAt(e.startState.selection.main.head).from;t!=e.changes.mapPos(n,-1)&&(i=I.empty)}i=i.map(e.changes);for(let t of e.effects)t.is(z)?i=i.update({add:[ze.range(t.value,t.value+1)]}):t.is(qe)&&(i=i.update({filter:n=>n!=t.value}));return i}});function Sn(){return[y.inputHandler.of(kn),Vt]}const We="()[]{}<>";function $t(i){for(let e=0;e<We.length;e+=2)if(We.charCodeAt(e)==i)return We.charAt(e+1);return Ie(i<128?i:i+1)}function Ht(i,e){return i.languageDataAt("closeBrackets",e)[0]||ge}function kn(i,e,t,n){if(i.composing)return!1;let s=i.state.selection.main;if(n.length>2||n.length==2&&R(E(n,0))==1||e!=s.from||t!=s.to)return!1;let o=An(i.state,n);return o?(i.dispatch(o),!0):!1}const Mn=({state:i,dispatch:e})=>{let n=Ht(i,i.selection.main.head).brackets||ge.brackets,s=null,o=i.changeByRange(r=>{if(r.empty){let l=En(i.doc,r.head);for(let a of n)if(a==l&&be(i.doc,r.head)==$t(E(a,0)))return{changes:{from:r.head-a.length,to:r.head+a.length},range:m.cursor(r.head-a.length),userEvent:"delete.backward"}}return{range:s=r}});return s||e(i.update(o,{scrollIntoView:!0})),!s},Tn=[{key:"Backspace",run:Mn}];function An(i,e){let t=Ht(i,i.selection.main.head),n=t.brackets||ge.brackets;for(let s of n){let o=$t(E(s,0));if(e==s)return o==s?On(i,s,n.indexOf(s+s+s)>-1):Ln(i,s,o,t.before||ge.before);if(e==o&&Ft(i,i.selection.main.from))return Dn(i,s,o)}return null}function Ft(i,e){let t=!1;return i.field(Vt).between(0,i.doc.length,n=>{n==e&&(t=!0)}),t}function be(i,e){let t=i.sliceString(e,e+2);return t.slice(0,R(E(t,0)))}function En(i,e){let t=i.sliceString(e-2,e);return R(E(t,0))==t.length?t:t.slice(1)}function Ln(i,e,t,n){let s=null,o=i.changeByRange(r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:t,from:r.to}],effects:z.of(r.to+e.length),range:m.range(r.anchor+e.length,r.head+e.length)};let l=be(i.doc,r.head);return!l||/\s/.test(l)||n.indexOf(l)>-1?{changes:{insert:e+t,from:r.head},effects:z.of(r.head+e.length),range:m.cursor(r.head+e.length)}:{range:s=r}});return s?null:i.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function Dn(i,e,t){let n=null,s=i.selection.ranges.map(o=>o.empty&&be(i.doc,o.head)==t?m.cursor(o.head+t.length):n=o);return n?null:i.update({selection:m.create(s,i.selection.mainIndex),scrollIntoView:!0,effects:i.selection.ranges.map(({from:o})=>qe.of(o))})}function On(i,e,t){let n=null,s=i.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:z.of(o.to+e.length),range:m.range(o.anchor+e.length,o.head+e.length)};let r=o.head,l=be(i.doc,r);if(l==e){if(qt(i,r))return{changes:{insert:e+e,from:r},effects:z.of(r+e.length),range:m.cursor(r+e.length)};if(Ft(i,r)){let a=t&&i.sliceDoc(r,r+e.length*3)==e+e+e;return{range:m.cursor(r+e.length*(a?3:1)),effects:qe.of(r)}}}else{if(t&&i.sliceDoc(r-2*e.length,r)==e+e&&qt(i,r-2*e.length))return{changes:{insert:e+e+e+e,from:r},effects:z.of(r+e.length),range:m.cursor(r+e.length)};if(i.charCategorizer(r)(l)!=ae.Word){let a=i.sliceDoc(r-1,r);if(a!=e&&i.charCategorizer(r)(a)!=ae.Word)return{changes:{insert:e+e,from:r},effects:z.of(r+e.length),range:m.cursor(r+e.length)}}}return{range:n=o}});return n?null:i.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function qt(i,e){let t=xt(i).resolveInner(e+1);return t.parent&&t.from==e}const zt=w.define({combine(i){let e,t;for(let n of i)e=e||n.topContainer,t=t||n.bottomContainer;return{topContainer:e,bottomContainer:t}}});function ee(i,e){let t=i.plugin(Wt),n=t?t.specs.indexOf(e):-1;return n>-1?t.panels[n]:null}const Wt=$.fromClass(class{constructor(i){this.input=i.state.facet(te),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(i));let e=i.state.facet(zt);this.top=new xe(i,!0,e.topContainer),this.bottom=new xe(i,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(i){let e=i.state.facet(zt);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new xe(i.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new xe(i.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=i.state.facet(te);if(t!=this.input){let n=t.filter(a=>a),s=[],o=[],r=[],l=[];for(let a of n){let c=this.specs.indexOf(a),h;c<0?(h=a(i.view),l.push(h)):(h=this.panels[c],h.update&&h.update(i)),s.push(h),(h.top?o:r).push(h)}this.specs=n,this.panels=s,this.top.sync(o),this.bottom.sync(r);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let n of this.panels)n.update&&n.update(i)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:ht.scrollMargins.from(i=>({top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}))});class xe{constructor(e,t,n){this.view=e,this.top=t,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Ut(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Ut(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Ut(i){let e=i.nextSibling;return i.remove(),e}const Rn=y.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}}),te=w.define({enables:[Wt,Rn]});function p(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var s=t[n];typeof s=="string"?i.setAttribute(n,s):s!=null&&(i[n]=s)}e++}for(;e<arguments.length;e++)Gt(i,arguments[e]);return i}function Gt(i,e){if(typeof e=="string")i.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)i.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)Gt(i,e[t]);else throw new RangeError("Unsupported child node: "+e)}const jt=typeof String.prototype.normalize=="function"?i=>i.normalize("NFKD"):i=>i;class J{constructor(e,t,n=0,s=e.length,o){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,s),this.bufferStart=n,this.normalize=o?r=>o(jt(r)):jt,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return E(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Ie(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=R(e);let s=this.normalize(t);for(let o=0,r=n;;o++){let l=s.charCodeAt(o),a=this.match(l,r);if(a)return this.value=a,this;if(o==s.length-1)break;r==n&&o<t.length&&t.charCodeAt(o)==l&&r++}}}match(e,t){let n=null;for(let s=0;s<this.matches.length;s+=2){let o=this.matches[s],r=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?n={from:this.matches[s+1],to:t+1}:(this.matches[s]++,r=!0)),r||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:t,to:t+1}:this.matches.push(1,t)),n}}typeof Symbol!="undefined"&&(J.prototype[Symbol.iterator]=function(){return this});const Jt={from:-1,to:-1,match:/.*/.exec("")},Ue="gm"+(/x/.unicode==null?"":"u");class Kt{constructor(e,t,n,s=0,o=e.length){if(this.to=o,this.curLine="",this.done=!1,this.value=Jt,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new Qt(e,t,n,s,o);this.re=new RegExp(t,Ue+((n==null?void 0:n.ignoreCase)?"i":"")),this.iter=e.iter();let r=e.lineAt(s);this.curLineStart=r.from,this.matchPos=s,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,s=n+t[0].length;if(this.matchPos=s+(n==s?1:0),n==this.curLine.length&&this.nextLine(),n<s||n>this.value.to)return this.value={from:n,to:s,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Ge=new WeakMap;class K{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,n){let s=Ge.get(e);if(!s||s.from>=n||s.to<=t){let l=new K(t,e.sliceString(t,n));return Ge.set(e,l),l}if(s.from==t&&s.to==n)return s;let{text:o,from:r}=s;return r>t&&(o=e.sliceString(t,r)+o,r=t),s.to<n&&(o+=e.sliceString(s.to,n)),Ge.set(e,new K(r,o)),new K(t,o.slice(t-r,n-r))}}class Qt{constructor(e,t,n,s,o){this.text=e,this.to=o,this.done=!1,this.value=Jt,this.matchPos=s,this.re=new RegExp(t,Ue+((n==null?void 0:n.ignoreCase)?"i":"")),this.flat=K.get(e,s,this.chunkEnd(s+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let n=this.flat.from+t.index,s=n+t[0].length;return this.value={from:n,to:s,match:t},this.matchPos=s+(n==s?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=K.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}}typeof Symbol!="undefined"&&(Kt.prototype[Symbol.iterator]=Qt.prototype[Symbol.iterator]=function(){return this});function Pn(i){try{return new RegExp(i,Ue),!0}catch(e){return!1}}function je(i){let e=p("input",{class:"cm-textfield",name:"line"}),t=p("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),i.dispatch({effects:ve.of(!1)}),i.focus()):s.keyCode==13&&(s.preventDefault(),n())},onsubmit:s=>{s.preventDefault(),n()}},p("label",i.state.phrase("Go to line"),": ",e)," ",p("button",{class:"cm-button",type:"submit"},i.state.phrase("go")));function n(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!s)return;let{state:o}=i,r=o.doc.lineAt(o.selection.main.head),[,l,a,c,h]=s,f=c?+c.slice(1):0,u=a?+a:r.number;if(a&&h){let g=u/100;l&&(g=g*(l=="-"?-1:1)+r.number/o.doc.lines),u=Math.round(o.doc.lines*g)}else a&&l&&(u=u*(l=="-"?-1:1)+r.number);let b=o.doc.line(Math.max(1,Math.min(o.doc.lines,u)));i.dispatch({effects:ve.of(!1),selection:m.cursor(b.from+Math.max(0,Math.min(f,b.length))),scrollIntoView:!0}),i.focus()}return{dom:t,pos:-10}}const ve=x.define(),_t=V.define({create(){return!0},update(i,e){for(let t of e.effects)t.is(ve)&&(i=t.value);return i},provide:i=>te.from(i,e=>e?je:null)}),In=i=>{let e=ee(i,je);if(!e){let t=[ve.of(!0)];i.state.field(_t,!1)==null&&t.push(x.appendConfig.of([_t,Bn])),i.dispatch({effects:t}),e=ee(i,je)}return e&&e.dom.querySelector("input").focus(),!0},Bn=y.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Nn={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100},Xt=w.define({combine(i){return X(i,Nn,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function Vn(i){let e=[qn,Fn];return i&&e.push(Xt.of(i)),e}const $n=v.mark({class:"cm-selectionMatch"}),Hn=v.mark({class:"cm-selectionMatch cm-selectionMatch-main"}),Fn=$.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.selectionSet||i.docChanged||i.viewportChanged)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=i.state.facet(Xt),{state:t}=i,n=t.selection;if(n.ranges.length>1)return v.none;let s=n.main,o,r=null;if(s.empty){if(!e.highlightWordAroundCursor)return v.none;let a=t.wordAt(s.head);if(!a)return v.none;r=t.charCategorizer(s.head),o=t.sliceDoc(a.from,a.to)}else{let a=s.to-s.from;if(a<e.minSelectionLength||a>200)return v.none;if(o=t.sliceDoc(s.from,s.to).trim(),!o)return v.none}let l=[];for(let a of i.visibleRanges){let c=new J(t.doc,o,a.from,a.to);for(;!c.next().done;){let{from:h,to:f}=c.value;if((!r||(h==0||r(t.sliceDoc(h-1,h))!=ae.Word)&&(f==t.doc.length||r(t.sliceDoc(f,f+1))!=ae.Word))&&(r&&h<=s.from&&f>=s.to?l.push(Hn.range(h,f)):(h>=s.to||f<=s.from)&&l.push($n.range(h,f)),l.length>e.maxMatches))return v.none}}return v.set(l)}},{decorations:i=>i.decorations}),qn=y.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),zn=({state:i,dispatch:e})=>{let{selection:t}=i,n=m.create(t.ranges.map(s=>i.wordAt(s.head)||m.cursor(s.head)),t.mainIndex);return n.eq(t)?!1:(e(i.update({selection:n})),!0)};function Wn(i,e){let{main:t,ranges:n}=i.selection,s=i.wordAt(t.head),o=s&&s.from==t.from&&s.to==t.to;for(let r=!1,l=new J(i.doc,e,n[n.length-1].to);;)if(l.next(),l.done){if(r)return null;l=new J(i.doc,e,0,Math.max(0,n[n.length-1].from-1)),r=!0}else{if(r&&n.some(a=>a.from==l.value.from))continue;if(o){let a=i.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const Un=({state:i,dispatch:e})=>{let{ranges:t}=i.selection;if(t.some(o=>o.from===o.to))return zn({state:i,dispatch:e});let n=i.sliceDoc(t[0].from,t[0].to);if(i.selection.ranges.some(o=>i.sliceDoc(o.from,o.to)!=n))return!1;let s=Wn(i,n);return s?(e(i.update({selection:i.selection.addRange(m.range(s.from,s.to),!1),effects:y.scrollIntoView(s.to)})),!0):!1},Je=w.define({combine(i){var e;return{top:i.reduce((t,n)=>t??n.top,void 0)||!1,caseSensitive:i.reduce((t,n)=>t??(n.caseSensitive||n.matchCase),void 0)||!1,createPanel:((e=i.find(t=>t.createPanel))===null||e===void 0?void 0:e.createPanel)||(t=>new es(t))}}});class Yt{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||Pn(this.search))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new jn(this):new Gn(this)}}class Zt{constructor(e){this.spec=e}}class Gn extends Zt{constructor(e){super(e);this.unquoted=e.search.replace(/\\([nrt\\])/g,(t,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}cursor(e,t=0,n=e.length){return new J(e,this.unquoted,t,n,this.spec.caseSensitive?void 0:s=>s.toLowerCase())}nextMatch(e,t,n){let s=this.cursor(e,n).nextOverlapping();return s.done&&(s=this.cursor(e,0,t).nextOverlapping()),s.done?null:s.value}prevMatchInRange(e,t,n){for(let s=n;;){let o=Math.max(t,s-1e4-this.unquoted.length),r=this.cursor(e,o,s),l=null;for(;!r.nextOverlapping().done;)l=r.value;if(l)return l;if(o==t)return null;s-=1e4}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let n=this.cursor(e),s=[];for(;!n.next().done;){if(s.length>=t)return null;s.push(n.value)}return s}highlight(e,t,n,s){let o=this.cursor(e,Math.max(0,t-this.unquoted.length),Math.min(n+this.unquoted.length,e.length));for(;!o.next().done;)s(o.value.from,o.value.to)}}class jn extends Zt{cursor(e,t=0,n=e.length){return new Kt(e,this.spec.search,this.spec.caseSensitive?void 0:{ignoreCase:!0},t,n)}nextMatch(e,t,n){let s=this.cursor(e,n).next();return s.done&&(s=this.cursor(e,0,t).next()),s.done?null:s.value}prevMatchInRange(e,t,n){for(let s=1;;s++){let o=Math.max(t,n-s*1e4),r=this.cursor(e,o,n),l=null;for(;!r.next().done;)l=r.value;if(l&&(o==t||l.from>o+10))return l;if(o==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(t,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:t)}matchAll(e,t){let n=this.cursor(e),s=[];for(;!n.next().done;){if(s.length>=t)return null;s.push(n.value)}return s}highlight(e,t,n,s){let o=this.cursor(e,Math.max(0,t-250),Math.min(n+250,e.length));for(;!o.next().done;)s(o.value.from,o.value.to)}}const ie=x.define(),Ke=x.define(),H=V.define({create(i){return new Qe(_e(i).create(),Ce)},update(i,e){for(let t of e.effects)t.is(ie)?i=new Qe(t.value.create(),i.panel):t.is(Ke)&&(i=new Qe(i.query,t.value?Ce:null));return i},provide:i=>te.from(i,e=>e.panel)});class Qe{constructor(e,t){this.query=e,this.panel=t}}const Jn=v.mark({class:"cm-searchMatch"}),Kn=v.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Qn=$.fromClass(class{constructor(i){this.view=i,this.decorations=this.highlight(i.state.field(H))}update(i){let e=i.state.field(H);(e!=i.startState.field(H)||i.docChanged||i.selectionSet)&&(this.decorations=this.highlight(e))}highlight({query:i,panel:e}){if(!e||!i.spec.valid)return v.none;let{view:t}=this,n=new dt;for(let s=0,o=t.visibleRanges,r=o.length;s<r;s++){let{from:l,to:a}=o[s];for(;s<r-1&&a>o[s+1].from-2*250;)a=o[++s].to;i.highlight(t.state.doc,l,a,(c,h)=>{let f=t.state.selection.ranges.some(u=>u.from==c&&u.to==h);n.add(c,h,f?Kn:Jn)})}return n.finish()}},{decorations:i=>i.decorations});function ne(i){return e=>{let t=e.state.field(H,!1);return t&&t.query.spec.valid?i(e,t):ti(e)}}const ye=ne((i,{query:e})=>{let{from:t,to:n}=i.state.selection.main,s=e.nextMatch(i.state.doc,t,n);return!s||s.from==t&&s.to==n?!1:(i.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:Xe(i,s),userEvent:"select.search"}),!0)}),we=ne((i,{query:e})=>{let{state:t}=i,{from:n,to:s}=t.selection.main,o=e.prevMatch(t.doc,n,s);return o?(i.dispatch({selection:{anchor:o.from,head:o.to},scrollIntoView:!0,effects:Xe(i,o),userEvent:"select.search"}),!0):!1}),_n=ne((i,{query:e})=>{let t=e.matchAll(i.state.doc,1e3);return!t||!t.length?!1:(i.dispatch({selection:m.create(t.map(n=>m.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),Xn=({state:i,dispatch:e})=>{let t=i.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:n,to:s}=t.main,o=[],r=0;for(let l=new J(i.doc,i.sliceDoc(n,s));!l.next().done;){if(o.length>1e3)return!1;l.value.from==n&&(r=o.length),o.push(m.range(l.value.from,l.value.to))}return e(i.update({selection:m.create(o,r),userEvent:"select.search.matches"})),!0},ei=ne((i,{query:e})=>{let{state:t}=i,{from:n,to:s}=t.selection.main;if(t.readOnly)return!1;let o=e.nextMatch(t.doc,n,n);if(!o)return!1;let r=[],l,a;if(o.from==n&&o.to==s&&(a=t.toText(e.getReplacement(o)),r.push({from:o.from,to:o.to,insert:a}),o=e.nextMatch(t.doc,o.from,o.to)),o){let c=r.length==0||r[0].from>=o.to?0:o.to-o.from-a.length;l={anchor:o.from-c,head:o.to-c}}return i.dispatch({changes:r,selection:l,scrollIntoView:!!l,effects:o?Xe(i,o):void 0,userEvent:"input.replace"}),!0}),Yn=ne((i,{query:e})=>{if(i.state.readOnly)return!1;let t=e.matchAll(i.state.doc,1e9).map(n=>{let{from:s,to:o}=n;return{from:s,to:o,insert:e.getReplacement(n)}});return t.length?(i.dispatch({changes:t,userEvent:"input.replace.all"}),!0):!1});function Ce(i){return i.state.facet(Je).createPanel(i)}function _e(i,e){var t;let n=i.selection.main,s=n.empty||n.to>n.from+100?"":i.sliceDoc(n.from,n.to),o=(t=e==null?void 0:e.caseSensitive)!==null&&t!==void 0?t:i.facet(Je).caseSensitive;return e&&!s?e:new Yt({search:s.replace(/\n/g,"\\n"),caseSensitive:o})}const ti=i=>{let e=i.state.field(H,!1);if(e&&e.panel){let t=ee(i,Ce);if(!t)return!1;let n=t.dom.querySelector("[name=search]");if(n!=i.root.activeElement){let s=_e(i.state,e.query.spec);s.valid&&i.dispatch({effects:ie.of(s)}),n.focus(),n.select()}}else i.dispatch({effects:[Ke.of(!0),e?ie.of(_e(i.state,e.query.spec)):x.appendConfig.of(is)]});return!0},ii=i=>{let e=i.state.field(H,!1);if(!e||!e.panel)return!1;let t=ee(i,Ce);return t&&t.dom.contains(i.root.activeElement)&&i.focus(),i.dispatch({effects:Ke.of(!1)}),!0},Zn=[{key:"Mod-f",run:ti,scope:"editor search-panel"},{key:"F3",run:ye,shift:we,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:ye,shift:we,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:ii,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Xn},{key:"Alt-g",run:In},{key:"Mod-d",run:Un,preventDefault:!0}];class es{constructor(e){this.view=e;let t=this.query=e.state.field(H).query.spec;this.commit=this.commit.bind(this),this.searchField=p("input",{value:t.search,placeholder:D(e,"Find"),"aria-label":D(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=p("input",{value:t.replace,placeholder:D(e,"Replace"),"aria-label":D(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=p("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=p("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit});function n(s,o,r){return p("button",{class:"cm-button",name:s,onclick:o,type:"button"},r)}this.dom=p("div",{onkeydown:s=>this.keydown(s),class:"cm-search"},[this.searchField,n("next",()=>ye(e),[D(e,"next")]),n("prev",()=>we(e),[D(e,"previous")]),n("select",()=>_n(e),[D(e,"all")]),p("label",null,[this.caseField,D(e,"match case")]),p("label",null,[this.reField,D(e,"regexp")]),...e.state.readOnly?[]:[p("br"),this.replaceField,n("replace",()=>ei(e),[D(e,"replace")]),n("replaceAll",()=>Yn(e),[D(e,"replace all")]),p("button",{name:"close",onclick:()=>ii(e),"aria-label":D(e,"close"),type:"button"},["×"])]])}commit(){let e=new Yt({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:ie.of(e)}))}keydown(e){Li(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?we:ye)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),ei(this.view))}update(e){for(let t of e.transactions)for(let n of t.effects)n.is(ie)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Je).top}}function D(i,e){return i.state.phrase(e)}const Se=30,ke=/[\s\.,:;?!]/;function Xe(i,{from:e,to:t}){let n=i.state.doc.lineAt(e).from,s=i.state.doc.lineAt(t).to,o=Math.max(n,e-Se),r=Math.min(s,t+Se),l=i.state.sliceDoc(o,r);if(o!=n){for(let a=0;a<Se;a++)if(!ke.test(l[a+1])&&ke.test(l[a])){l=l.slice(a);break}}if(r!=s){for(let a=l.length-1;a>l.length-Se;a--)if(!ke.test(l[a-1])&&ke.test(l[a])){l=l.slice(0,a);break}}return y.announce.of(`${i.state.phrase("current match")}. ${l} ${i.state.phrase("on line")} ${i.state.doc.lineAt(e).number}`)}const ts=y.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),is=[H,mt.lowest(Qn),ts],ns=typeof navigator!="undefined"&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),Ye="-10000px";class ni{constructor(e,t,n){this.facet=t,this.createTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(s=>s),this.tooltipViews=this.tooltips.map(n)}update(e){let t=e.state.facet(this.facet),n=t.filter(o=>o);if(t===this.input){for(let o of this.tooltipViews)o.update&&o.update(e);return!1}let s=[];for(let o=0;o<n.length;o++){let r=n[o],l=-1;if(!!r){for(let a=0;a<this.tooltips.length;a++){let c=this.tooltips[a];c&&c.create==r.create&&(l=a)}if(l<0)s[o]=this.createTooltipView(r);else{let a=s[o]=this.tooltipViews[l];a.update&&a.update(e)}}}for(let o of this.tooltipViews)s.indexOf(o)<0&&o.dom.remove();return this.input=t,this.tooltips=n,this.tooltipViews=s,!0}}function ss(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const Ze=w.define({combine:i=>{var e,t,n;return{position:ns?"absolute":((e=i.find(s=>s.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=i.find(s=>s.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((n=i.find(s=>s.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||ss}}}),si=$.fromClass(class{constructor(i){var e;this.view=i,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let t=i.state.facet(Ze);this.position=t.position,this.parent=t.parent,this.classes=i.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new ni(i,et,n=>this.createTooltip(n)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(n=>{Date.now()>this.lastTransaction-50&&n.length>0&&n[n.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(e=i.dom.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let i of this.manager.tooltipViews)this.intersectionObserver.observe(i.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(i){i.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(i);e&&this.observeIntersection();let t=e||i.geometryChanged,n=i.state.facet(Ze);if(n.position!=this.position){this.position=n.position;for(let s of this.manager.tooltipViews)s.dom.style.position=this.position;t=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let s of this.manager.tooltipViews)this.container.appendChild(s.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(i){let e=i.create(this.view);if(e.dom.classList.add("cm-tooltip"),i.arrow&&!e.dom.querySelector("cm-tooltip > cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=Ye,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var i,e;(i=this.view.dom.ownerDocument.defaultView)===null||i===void 0||i.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let i=this.view.dom.getBoundingClientRect();return{editor:i,parent:this.parent?this.container.getBoundingClientRect():i,pos:this.manager.tooltips.map(e=>this.view.coordsAtPos(e.pos)),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(Ze).tooltipSpace(this.view)}}writeMeasure(i){let{editor:e,space:t}=i,n=[];for(let s=0;s<this.manager.tooltips.length;s++){let o=this.manager.tooltips[s],r=this.manager.tooltipViews[s],{dom:l}=r,a=i.pos[s],c=i.size[s];if(!a||a.bottom<=Math.max(e.top,t.top)||a.top>=Math.min(e.bottom,t.bottom)||a.right<=Math.max(e.left,t.left)||a.left>=Math.min(e.right,t.right)){l.style.top=Ye;continue}let h=o.arrow?r.dom.querySelector(".cm-tooltip-arrow"):null,f=h?7:0,u=c.right-c.left,b=c.bottom-c.top,g=r.offset||rs,F=this.view.textDirection==le.LTR,N=c.width>t.right-t.left?F?t.left:t.right-c.width:F?Math.min(a.left-(h?14:0)+g.x,t.right-u):Math.max(t.left,a.left-u+(h?14:0)-g.x),A=!!o.above;!o.strictSide&&(A?a.top-(c.bottom-c.top)-g.y<t.top:a.bottom+(c.bottom-c.top)+g.y>t.bottom)&&A==t.bottom-a.bottom>a.top-t.top&&(A=!A);let d=A?a.top-b-f-g.y:a.bottom+f+g.y,G=N+u;if(r.overlap!==!0)for(let M of n)M.left<G&&M.right>N&&M.top<d+b&&M.bottom>d&&(d=A?M.top-b-2-f:M.bottom+f+2);this.position=="absolute"?(l.style.top=d-i.parent.top+"px",l.style.left=N-i.parent.left+"px"):(l.style.top=d+"px",l.style.left=N+"px"),h&&(h.style.left=`${a.left+(F?g.x:-g.x)-(N+14-7)}px`),r.overlap!==!0&&n.push({left:N,top:d,right:G,bottom:d+b}),l.classList.toggle("cm-tooltip-above",A),l.classList.toggle("cm-tooltip-below",!A),r.positioned&&r.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let i of this.manager.tooltipViews)i.dom.style.top=Ye}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),os=y.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:`${7}px`,width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:`${7}px solid transparent`,borderRight:`${7}px solid transparent`},".cm-tooltip-above &":{bottom:`-${7}px`,"&:before":{borderTop:`${7}px solid #bbb`},"&:after":{borderTop:`${7}px solid #f5f5f5`,bottom:"1px"}},".cm-tooltip-below &":{top:`-${7}px`,"&:before":{borderBottom:`${7}px solid #bbb`},"&:after":{borderBottom:`${7}px solid #f5f5f5`,top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),rs={x:0,y:0},et=w.define({enables:[si,os]}),Me=w.define();class tt{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new ni(e,Me,t=>this.createHostedView(t))}static create(e){return new tt(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}}const ls=et.compute([Me],i=>{let e=i.facet(Me).filter(t=>t);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.filter(t=>t.end!=null).map(t=>t.end)),create:tt.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class as{constructor(e,t,n,s,o){this.view=e,this.source=t,this.field=n,this.setHover=s,this.hoverTime=o,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){var e;clearTimeout(this.restartTimeout);let{lastMove:t}=this,n=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(n==null)return;let s=this.view.coordsAtPos(n);if(s==null||t.y<s.top||t.y>s.bottom||t.x<s.left-this.view.defaultCharacterWidth||t.x>s.right+this.view.defaultCharacterWidth)return;let o=this.view.bidiSpans(this.view.state.doc.lineAt(n)).find(a=>a.from<=n&&a.to>=n),r=o&&o.dir==le.RTL?-1:1,l=this.source(this.view,n,t.x<s.left?-r:r);if((e=l)===null||e===void 0?void 0:e.then){let a=this.pending={pos:n};l.then(c=>{this.pending==a&&(this.pending=null,c&&this.view.dispatch({effects:this.setHover.of(c)}))},c=>ce(this.view.state,c,"hover tooltip"))}else l&&this.view.dispatch({effects:this.setHover.of(l)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let n=this.active;if(n&&!cs(this.lastMove.target)||this.pending){let{pos:s}=n||this.pending,o=(t=n==null?void 0:n.end)!==null&&t!==void 0?t:s;(s==o?this.view.posAtCoords(this.lastMove)!=s:!hs(this.view,s,o,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function cs(i){for(let e=i;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function hs(i,e,t,n,s,o){let r=document.createRange(),l=i.domAtPos(e),a=i.domAtPos(t);r.setEnd(a.node,a.offset),r.setStart(l.node,l.offset);let c=r.getClientRects();r.detach();for(let h=0;h<c.length;h++){let f=c[h];if(Math.max(f.top-s,s-f.bottom,f.left-n,n-f.right)<=o)return!0}return!1}function fs(i,e={}){let t=x.define(),n=V.define({create(){return null},update(o,r){if(o&&e.hideOnChange&&(r.docChanged||r.selection))return null;for(let l of r.effects){if(l.is(t))return l.value;if(l.is(ds))return null}if(o&&r.docChanged){let l=r.changes.mapPos(o.pos,-1,Pe.TrackDel);if(l==null)return null;let a=Object.assign(Object.create(null),o);return a.pos=l,o.end!=null&&(a.end=r.changes.mapPos(o.end)),a}return o},provide:o=>Me.from(o)}),s=e.hoverTime||600;return[n,$.define(o=>new as(o,i,n,t,s)),ls]}function us(i,e){let t=i.plugin(si);if(!t)return null;let n=t.manager.tooltips.indexOf(e);return n<0?null:t.manager.tooltipViews[n]}const ds=x.define();class ms{constructor(e,t,n){this.state=e,this.pos=t,this.explicit=n,this.abortListeners=[]}tokenBefore(e){let t=xt(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),n=Math.max(t.from,this.pos-250),s=t.text.slice(n-t.from,this.pos-t.from),o=s.search(li(e,!1));return o<0?null:{from:n+o,to:this.pos,text:s.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}}function oi(i){let e=Object.keys(i).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function ps(i){let e=Object.create(null),t=Object.create(null);for(let{label:s}of i){e[s[0]]=!0;for(let o=1;o<s.length;o++)t[s[o]]=!0}let n=oi(e)+oi(t)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function gs(i){let e=i.map(s=>typeof s=="string"?{label:s}:s),[t,n]=e.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:ps(e);return s=>{let o=s.matchBefore(n);return o||s.explicit?{from:o?o.from:s.pos,options:e,span:t}:null}}class ri{constructor(e,t,n){this.completion=e,this.source=t,this.match=n}}function Q(i){return i.selection.main.head}function li(i,e){var t;let{source:n}=i,s=e&&n[0]!="^",o=n[n.length-1]!="$";return!s&&!o?i:new RegExp(`${s?"^":""}(?:${n})${o?"$":""}`,(t=i.flags)!==null&&t!==void 0?t:i.ignoreCase?"i":"")}const bs=Re.define();function ai(i,e){let t=e.completion.apply||e.completion.label,n=e.source;typeof t=="string"?i.dispatch({changes:{from:n.from,to:n.to,insert:t},selection:{anchor:n.from+t.length},userEvent:"input.complete",annotations:bs.of(e.completion)}):t(i,e.completion,n.from,n.to)}const ci=new WeakMap;function xs(i){if(!Array.isArray(i))return i;let e=ci.get(i);return e||ci.set(i,e=gs(i)),e}class vs{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let n=E(e,t),s=R(n);this.chars.push(n);let o=e.slice(t,t+s),r=o.toUpperCase();this.folded.push(E(r==o?o.toLowerCase():r,0)),t+=s}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:n,any:s,precise:o,byWord:r}=this;if(t.length==1){let d=E(e,0);return d==t[0]?[0,0,R(d)]:d==n[0]?[-200,0,R(d)]:null}let l=e.indexOf(this.pattern);if(l==0)return[0,0,this.pattern.length];let a=t.length,c=0;if(l<0){for(let d=0,G=Math.min(e.length,200);d<G&&c<a;){let M=E(e,d);(M==t[c]||M==n[c])&&(s[c++]=d),d+=R(M)}if(c<a)return null}let h=0,f=0,u=!1,b=0,g=-1,F=-1,N=/[a-z]/.test(e),A=!0;for(let d=0,G=Math.min(e.length,200),M=0;d<G&&f<a;){let C=E(e,d);l<0&&(h<a&&C==t[h]&&(o[h++]=d),b<a&&(C==t[b]||C==n[b]?(b==0&&(g=d),F=d+1,b++):b=0));let re,De=C<255?C>=48&&C<=57||C>=97&&C<=122?2:C>=65&&C<=90?1:0:(re=Ie(C))!=re.toLowerCase()?1:re!=re.toUpperCase()?2:0;(!d||De==1&&N||M==0&&De!=0)&&(t[f]==C||n[f]==C&&(u=!0)?r[f++]=d:r.length&&(A=!1)),M=De,d+=R(C)}return f==a&&r[0]==0&&A?this.result(-100+(u?-200:0),r,e):b==a&&g==0?[-200-e.length,0,F]:l>-1?[-700-e.length,l,l+this.pattern.length]:b==a?[-200+-700-e.length,g,F]:f==a?this.result(-100+(u?-200:0)+-700+(A?0:-1100),r,e):t.length==2?null:this.result((s[0]?-700:0)+-200+-1100,s,e)}result(e,t,n){let s=[e-n.length],o=1;for(let r of t){let l=r+(this.astral?R(E(n,r)):1);o>1&&s[o-1]==r?s[o-1]=l:(s[o++]=r,s[o++]=l)}return s}}const W=w.define({combine(i){return X(i,{activateOnTyping:!0,override:null,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,t)=>e&&t,icons:(e,t)=>e&&t,optionClass:(e,t)=>n=>ys(e(n),t(n)),addToOptions:(e,t)=>e.concat(t)})}});function ys(i,e){return i?e?i+" "+e:i:e}function ws(i){let e=i.addToOptions.slice();return i.icons&&e.push({render(t){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),t.type&&n.classList.add(...t.type.split(/\s+/g).map(s=>"cm-completionIcon-"+s)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(t,n,s){let o=document.createElement("span");o.className="cm-completionLabel";let{label:r}=t,l=0;for(let a=1;a<s.length;){let c=s[a++],h=s[a++];c>l&&o.appendChild(document.createTextNode(r.slice(l,c)));let f=o.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(r.slice(c,h))),f.className="cm-completionMatchedText",l=h}return l<r.length&&o.appendChild(document.createTextNode(r.slice(l))),o},position:50},{render(t){if(!t.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=t.detail,n},position:80}),e.sort((t,n)=>t.position-n.position).map(t=>t.render)}function Cs(i,e){let t=document.createElement("div");t.className="cm-tooltip cm-completionInfo";let{info:n}=i.completion;if(typeof n=="string")t.textContent=n;else{let s=n(i.completion);s.then?s.then(o=>t.appendChild(o),o=>ce(e.state,o,"completion info")):t.appendChild(s)}return t}function hi(i,e,t){if(i<=t)return{from:0,to:i};if(e<=i>>1){let s=Math.floor(e/t);return{from:s*t,to:(s+1)*t}}let n=Math.floor((i-e)/t);return{from:i-(n+1)*t,to:i-n*t}}class Ss{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:l=>this.positionInfo(l),key:this};let n=e.state.field(t),{options:s,selected:o}=n.open,r=e.state.facet(W);this.optionContent=ws(r),this.optionClass=r.optionClass,this.range=hi(s.length,o,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",l=>{for(let a=l.target,c;a&&a!=this.dom;a=a.parentNode)if(a.nodeName=="LI"&&(c=/-(\d+)$/.exec(a.id))&&+c[1]<s.length){ai(e,s[+c[1]]),l.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(s,n.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=hi(t.options.length,t.selected,this.view.state.facet(W).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let n=t.options[t.selected];n.completion.info&&(this.info=this.dom.appendChild(Cs(n,this.view)),this.view.requestMeasure(this.placeInfo))}}updateSelectedOption(e){let t=null;for(let n=this.list.firstChild,s=this.range.from;n;n=n.nextSibling,s++)s==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),t=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return t&&Ms(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),s=e.getBoundingClientRect();if(s.top>Math.min(innerHeight,t.bottom)-10||s.bottom<Math.max(0,t.top)+10)return null;let o=Math.max(0,Math.min(s.top,innerHeight-n.height))-t.top,r=this.view.textDirection==le.RTL,l=t.left,a=innerWidth-t.right;return r&&l<Math.min(n.width,a)?r=!1:!r&&a<Math.min(n.width,l)&&(r=!0),{top:o,left:r}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,t,n){const s=document.createElement("ul");s.id=t,s.setAttribute("role","listbox");for(let o=n.from;o<n.to;o++){let{completion:r,match:l}=e[o];const a=s.appendChild(document.createElement("li"));a.id=t+"-"+o,a.setAttribute("role","option");let c=this.optionClass(r);c&&(a.className=c);for(let h of this.optionContent){let f=h(r,this.view.state,l);f&&a.appendChild(f)}}return n.from&&s.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&s.classList.add("cm-completionListIncompleteBottom"),s}}function ks(i){return e=>new Ss(e,i)}function Ms(i,e){let t=i.getBoundingClientRect(),n=e.getBoundingClientRect();n.top<t.top?i.scrollTop-=t.top-n.top:n.bottom>t.bottom&&(i.scrollTop+=n.bottom-t.bottom)}const Ts=300;function fi(i){return(i.boost||0)*100+(i.apply?10:0)+(i.info?5:0)+(i.type?1:0)}function As(i,e){let t=[],n=0;for(let r of i)if(r.hasResult())if(r.result.filter===!1)for(let l of r.result.options)t.push(new ri(l,r,[1e9-n++]));else{let l=new vs(e.sliceDoc(r.from,r.to)),a;for(let c of r.result.options)(a=l.match(c.label))&&(c.boost!=null&&(a[0]+=c.boost),t.push(new ri(c,r,a)))}t.sort(di);let s=[],o=null;for(let r of t.sort(di)){if(s.length==Ts)break;!o||o.label!=r.completion.label||o.detail!=r.completion.detail||o.type!=r.completion.type||o.apply!=r.completion.apply?s.push(r):fi(r.completion)>fi(o)&&(s[s.length-1]=r),o=r.completion}return s}class se{constructor(e,t,n,s,o){this.options=e,this.attrs=t,this.tooltip=n,this.timestamp=s,this.selected=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new se(this.options,ui(t,e),this.tooltip,this.timestamp,e)}static build(e,t,n,s,o){let r=As(e,t);if(!r.length)return null;let l=0;if(s&&s.selected){let a=s.options[s.selected].completion;for(let c=0;c<r.length&&!l;c++)r[c].completion==a&&(l=c)}return new se(r,ui(n,l),{pos:e.reduce((a,c)=>c.hasResult()?Math.min(a,c.from):a,1e8),create:ks(O),above:o.aboveCursor},s?s.timestamp:Date.now(),l)}map(e){return new se(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class Te{constructor(e,t,n){this.active=e,this.id=t,this.open=n}static start(){return new Te(Ds,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,n=t.facet(W),o=(n.override||t.languageDataAt("autocomplete",Q(t)).map(xs)).map(l=>(this.active.find(c=>c.source==l)||new k(l,this.active.some(c=>c.state!=0)?1:0)).update(e,n));o.length==this.active.length&&o.every((l,a)=>l==this.active[a])&&(o=this.active);let r=e.selection||o.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!Es(o,this.active)?se.build(o,t,this.id,this.open,n):this.open&&e.docChanged?this.open.map(e.changes):this.open;!r&&o.every(l=>l.state!=1)&&o.some(l=>l.hasResult())&&(o=o.map(l=>l.hasResult()?new k(l.source,0):l));for(let l of e.effects)l.is(pi)&&(r=r&&r.setSelected(l.value,this.id));return o==this.active&&r==this.open?this:new Te(o,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:Ls}}function Es(i,e){if(i==e)return!0;for(let t=0,n=0;;){for(;t<i.length&&!i[t].hasResult;)t++;for(;n<e.length&&!e[n].hasResult;)n++;let s=t==i.length,o=n==e.length;if(s||o)return s==o;if(i[t++].result!=e[n++].result)return!1}}const Ls={"aria-autocomplete":"list","aria-expanded":"false"};function ui(i,e){return{"aria-autocomplete":"list","aria-expanded":"true","aria-activedescendant":i+"-"+e,"aria-controls":i}}const Ds=[];function di(i,e){let t=e.match[0]-i.match[0];return t||i.completion.label.localeCompare(e.completion.label)}function it(i){return i.isUserEvent("input.type")?"input":i.isUserEvent("delete.backward")?"delete":null}class k{constructor(e,t,n=-1){this.source=e,this.state=t,this.explicitPos=n}hasResult(){return!1}update(e,t){let n=it(e),s=this;n?s=s.handleUserEvent(e,n,t):e.docChanged?s=s.handleChange(e):e.selection&&s.state!=0&&(s=new k(s.source,0));for(let o of e.effects)if(o.is(nt))s=new k(s.source,1,o.value?Q(e.state):-1);else if(o.is(st))s=new k(s.source,0);else if(o.is(mi))for(let r of o.value)r.source==s.source&&(s=r);return s}handleUserEvent(e,t,n){return t=="delete"||!n.activateOnTyping?this.map(e.changes):new k(this.source,1)}handleChange(e){return e.changes.touchesRange(Q(e.startState))?new k(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new k(this.source,this.state,e.mapPos(this.explicitPos))}}class Ae extends k{constructor(e,t,n,s,o,r){super(e,2,t);this.result=n,this.from=s,this.to=o,this.span=r}hasResult(){return!0}handleUserEvent(e,t,n){let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),r=Q(e.state);if((this.explicitPos>-1?r<s:r<=s)||r>o)return new k(this.source,t=="input"&&n.activateOnTyping?1:0);let l=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return this.span&&(s==o||this.span.test(e.state.sliceDoc(s,o)))?new Ae(this.source,l,this.result,s,o,this.span):new k(this.source,1,l)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new k(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Ae(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1),this.span)}}const nt=x.define(),st=x.define(),mi=x.define({map(i,e){return i.map(t=>t.map(e))}}),pi=x.define(),O=V.define({create(){return Te.start()},update(i,e){return i.update(e)},provide:i=>[et.from(i,e=>e.tooltip),y.contentAttributes.from(i,e=>e.attrs)]}),gi=75;function Ee(i,e="option"){return t=>{let n=t.state.field(O,!1);if(!n||!n.open||Date.now()-n.open.timestamp<gi)return!1;let s=1,o;e=="page"&&(o=us(t,n.open.tooltip))&&(s=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1));let r=n.open.selected+s*(i?1:-1),{length:l}=n.open.options;return r<0?r=e=="page"?0:l-1:r>=l&&(r=e=="page"?l-1:0),t.dispatch({effects:pi.of(r)}),!0}}const Os=i=>{let e=i.state.field(O,!1);return i.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<gi?!1:(ai(i,e.open.options[e.open.selected]),!0)},Rs=i=>i.state.field(O,!1)?(i.dispatch({effects:nt.of(!0)}),!0):!1,Ps=i=>{let e=i.state.field(O,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(i.dispatch({effects:st.of(null)}),!0)};class Is{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const bi=50,Bs=50,Ns=1e3,Vs=$.fromClass(class{constructor(i){this.view=i,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of i.state.field(O).active)e.state==1&&this.startQuery(e)}update(i){let e=i.state.field(O);if(!i.selectionSet&&!i.docChanged&&i.startState.field(O)==e)return;let t=i.transactions.some(n=>(n.selection||n.docChanged)&&!it(n));for(let n=0;n<this.running.length;n++){let s=this.running[n];if(t||s.updates.length+i.transactions.length>Bs&&s.time-Date.now()>Ns){for(let o of s.context.abortListeners)try{o()}catch(r){ce(this.view.state,r)}s.context.abortListeners=null,this.running.splice(n--,1)}else s.updates.push(...i.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(n=>n.state==1&&!this.running.some(s=>s.active.source==n.source))?setTimeout(()=>this.startUpdate(),bi):-1,this.composing!=0)for(let n of i.transactions)it(n)=="input"?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:i}=this.view,e=i.field(O);for(let t of e.active)t.state==1&&!this.running.some(n=>n.active.source==t.source)&&this.startQuery(t)}startQuery(i){let{state:e}=this.view,t=Q(e),n=new ms(e,t,i.explicitPos==t),s=new Is(i,n);this.running.push(s),Promise.resolve(i.source(n)).then(o=>{s.context.aborted||(s.done=o||null,this.scheduleAccept())},o=>{this.view.dispatch({effects:st.of(null)}),ce(this.view.state,o)})}scheduleAccept(){this.running.every(i=>i.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),bi))}accept(){var i;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(W);for(let n=0;n<this.running.length;n++){let s=this.running[n];if(s.done===void 0)continue;if(this.running.splice(n--,1),s.done){let r=new Ae(s.active.source,s.active.explicitPos,s.done,s.done.from,(i=s.done.to)!==null&&i!==void 0?i:Q(s.updates.length?s.updates[0].startState:this.view.state),s.done.span&&s.done.filter!==!1?li(s.done.span,!0):null);for(let l of s.updates)r=r.update(l,t);if(r.hasResult()){e.push(r);continue}}let o=this.view.state.field(O).active.find(r=>r.source==s.active.source);if(o&&o.state==1)if(s.done==null){let r=new k(s.active.source,0);for(let l of s.updates)r=r.update(l,t);r.state!=1&&e.push(r)}else this.startQuery(o)}e.length&&this.view.dispatch({effects:mi.of(e)})}},{eventHandlers:{compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:nt.of(!1)}),20),this.composing=0}}}),$s=y.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});function Hs(i={}){return[O,W.of(i),Vs,Fs,$s]}const xi=[{key:"Ctrl-Space",run:Rs},{key:"Escape",run:Ps},{key:"ArrowDown",run:Ee(!0)},{key:"ArrowUp",run:Ee(!1)},{key:"PageDown",run:Ee(!0,"page")},{key:"PageUp",run:Ee(!1,"page")},{key:"Enter",run:Os}],Fs=mt.highest(pt.computeN([W],i=>i.facet(W).defaultKeymap?[xi]:[])),qs=i=>{let e=ot(i.state);return e.line?zs(i):e.block?yi(i):!1};function vi(i,e){return({state:t,dispatch:n})=>{let s=i(e,t.selection.ranges,t);return s?(n(t.update(s)),!0):!1}}const zs=vi(js,0),yi=vi(Gs,0),Ws=[{key:"Mod-/",run:qs},{key:"Alt-A",run:yi}];function ot(i,e=i.selection.main.head){let t=i.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const oe=50;function Us(i,{open:e,close:t},n,s){let o=i.sliceDoc(n-oe,n),r=i.sliceDoc(s,s+oe),l=/\s*$/.exec(o)[0].length,a=/^\s*/.exec(r)[0].length,c=o.length-l;if(o.slice(c-e.length,c)==e&&r.slice(a,a+t.length)==t)return{open:{pos:n-l,margin:l&&1},close:{pos:s+a,margin:a&&1}};let h,f;s-n<=2*oe?h=f=i.sliceDoc(n,s):(h=i.sliceDoc(n,n+oe),f=i.sliceDoc(s-oe,s));let u=/^\s*/.exec(h)[0].length,b=/\s*$/.exec(f)[0].length,g=f.length-b-t.length;return h.slice(u,u+e.length)==e&&f.slice(g,g+t.length)==t?{open:{pos:n+u+e.length,margin:/\s/.test(h.charAt(u+e.length))?1:0},close:{pos:s-b-t.length,margin:/\s/.test(f.charAt(g-1))?1:0}}:null}function Gs(i,e,t){let n=e.map(o=>ot(t,o.from).block);if(!n.every(o=>o))return null;let s=e.map((o,r)=>Us(t,n[r],o.from,o.to));if(i!=2&&!s.every(o=>o)){let o=0;return t.changeByRange(r=>{let{open:l,close:a}=n[o++];if(s[o])return{range:r};let c=l.length+1;return{changes:[{from:r.from,insert:l+" "},{from:r.to,insert:" "+a}],range:m.range(r.anchor+c,r.head+c)}})}else if(i!=1&&s.some(o=>o)){let o=[];for(let r=0,l;r<s.length;r++)if(l=s[r]){let a=n[r],{open:c,close:h}=l;o.push({from:c.pos-a.open.length,to:c.pos+c.margin},{from:h.pos-h.margin,to:h.pos+a.close.length})}return{changes:o}}return null}function js(i,e,t){let n=[],s=-1;for(let{from:o,to:r}of e){let l=n.length,a=1e9;for(let c=o;c<=r;){let h=t.doc.lineAt(c);if(h.from>s&&(o==r||r>h.from)){s=h.from;let f=ot(t,c).line;if(!f)continue;let u=/^\s*/.exec(h.text)[0].length,b=u==h.length,g=h.text.slice(u,u+f.length)==f?u:-1;u<h.text.length&&u<a&&(a=u),n.push({line:h,comment:g,token:f,indent:u,empty:b,single:!1})}c=h.to+1}if(a<1e9)for(let c=l;c<n.length;c++)n[c].indent<n[c].line.text.length&&(n[c].indent=a);n.length==l+1&&(n[l].single=!0)}if(i!=2&&n.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:l,token:a,indent:c,empty:h,single:f}of n)(f||!h)&&o.push({from:l.from+c,insert:a+" "});let r=t.changes(o);return{changes:r,selection:t.selection.map(r,1)}}else if(i!=1&&n.some(o=>o.comment>=0)){let o=[];for(let{line:r,comment:l,token:a}of n)if(l>=0){let c=r.from+l,h=c+a.length;r.text[h-r.from]==" "&&h++,o.push({from:c,to:h})}return{changes:o}}return null}const rt=2e3;function Js(i,e,t){let n=Math.min(e.line,t.line),s=Math.max(e.line,t.line),o=[];if(e.off>rt||t.off>rt||e.col<0||t.col<0){let r=Math.min(e.off,t.off),l=Math.max(e.off,t.off);for(let a=n;a<=s;a++){let c=i.doc.line(a);c.length<=l&&o.push(m.range(c.from+r,c.to+l))}}else{let r=Math.min(e.col,t.col),l=Math.max(e.col,t.col);for(let a=n;a<=s;a++){let c=i.doc.line(a),h=gt(c.text,r,i.tabSize,!0);if(h>-1){let f=gt(c.text,l,i.tabSize);o.push(m.range(c.from+h,c.from+f))}}}return o}function Ks(i,e){let t=i.coordsAtPos(i.viewport.from);return t?Math.round(Math.abs((t.left-e)/i.defaultCharacterWidth)):-1}function wi(i,e){let t=i.posAtCoords({x:e.clientX,y:e.clientY},!1),n=i.state.doc.lineAt(t),s=t-n.from,o=s>rt?-1:s==n.length?Ks(i,e.clientX):Di(n.text,i.state.tabSize,t-n.from);return{line:n.number,col:o,off:s}}function Qs(i,e){let t=wi(i,e),n=i.state.selection;return t?{update(s){if(s.docChanged){let o=s.changes.mapPos(s.startState.doc.line(t.line).from),r=s.state.doc.lineAt(o);t={line:r.number,col:t.col,off:Math.min(t.off,r.length)},n=n.map(s.changes)}},get(s,o,r){let l=wi(i,s);if(!l)return n;let a=Js(i.state,t,l);return a.length?r?m.create(a.concat(n.ranges)):m.create(a):n}}:null}function _s(i){let e=(i==null?void 0:i.eventFilter)||(t=>t.altKey&&t.button==0);return y.mouseSelectionStyle.of((t,n)=>e(n)?Qs(t,n):null)}class Xs{constructor(e,t,n){this.from=e,this.to=t,this.diagnostic=n}}class U{constructor(e,t,n){this.diagnostics=e,this.panel=t,this.selected=n}static init(e,t,n){let s=v.set(e.map(o=>o.from==o.to||o.from==o.to-1&&n.doc.lineAt(o.from).to==o.from?v.widget({widget:new ro(o),diagnostic:o}).range(o.from):v.mark({attributes:{class:"cm-lintRange cm-lintRange-"+o.severity},diagnostic:o}).range(o.from,o.to)),!0);return new U(s,t,_(s))}}function _(i,e=null,t=0){let n=null;return i.between(t,1e9,(s,o,{spec:r})=>{if(!(e&&r.diagnostic!=e))return n=new Xs(s,o,r.diagnostic),!1}),n}function Ys(i,e){return i.field(T,!1)?e:e.concat(x.appendConfig.of([T,y.decorations.compute([T],t=>{let{selected:n,panel:s}=t.field(T);return!n||!s||n.from==n.to?v.none:v.set([eo.range(n.from,n.to)])}),fs(to),ao]))}const Zs=x.define(),lt=x.define(),Ci=x.define(),T=V.define({create(){return new U(v.none,null,null)},update(i,e){if(e.docChanged){let t=i.diagnostics.map(e.changes),n=null;if(i.selected){let s=e.changes.mapPos(i.selected.from,1);n=_(t,i.selected.diagnostic,s)||_(t,null,s)}i=new U(t,i.panel,n)}for(let t of e.effects)t.is(Zs)?i=U.init(t.value,i.panel,e.state):t.is(lt)?i=new U(i.diagnostics,t.value?Le.open:null,i.selected):t.is(Ci)&&(i=new U(i.diagnostics,i.panel,t.value));return i},provide:i=>[te.from(i,e=>e.panel),y.decorations.from(i,e=>e.diagnostics)]}),eo=v.mark({class:"cm-lintRange cm-lintRange-active"});function to(i,e,t){let{diagnostics:n}=i.state.field(T),s=[],o=2e8,r=0;return n.between(e-(t<0?1:0),e+(t>0?1:0),(l,a,{spec:c})=>{e>=l&&e<=a&&(l==a||(e>l||t>0)&&(e<a||t<0))&&(s.push(c.diagnostic),o=Math.min(l,o),r=Math.max(a,r))}),s.length?{pos:o,end:r,above:i.state.doc.lineAt(o).to<r,create(){return{dom:io(i,s)}}}:null}function io(i,e){return p("ul",{class:"cm-tooltip-lint"},e.map(t=>Mi(i,t,!1)))}const no=i=>{let e=i.state.field(T,!1);(!e||!e.panel)&&i.dispatch({effects:Ys(i.state,[lt.of(!0)])});let t=ee(i,Le.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},Si=i=>{let e=i.state.field(T,!1);return!e||!e.panel?!1:(i.dispatch({effects:lt.of(!1)}),!0)},so=i=>{let e=i.state.field(T,!1);if(!e)return!1;let t=i.state.selection.main,n=e.diagnostics.iter(t.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==t.from&&n.to==t.to)?!1:(i.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},oo=[{key:"Mod-Shift-m",run:no},{key:"F8",run:so}];function ki(i){let e=[];if(i)e:for(let{name:t}of i){for(let n=0;n<t.length;n++){let s=t[n];if(/[a-zA-Z]/.test(s)&&!e.some(o=>o.toLowerCase()==s.toLowerCase())){e.push(s);continue e}}e.push("")}return e}function Mi(i,e,t){var n;let s=t?ki(e.actions):[];return p("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},p("span",{class:"cm-diagnosticText"},e.message),(n=e.actions)===null||n===void 0?void 0:n.map((o,r)=>{let l=f=>{f.preventDefault();let u=_(i.state.field(T).diagnostics,e);u&&o.apply(i,u.from,u.to)},{name:a}=o,c=s[r]?a.indexOf(s[r]):-1,h=c<0?a:[a.slice(0,c),p("u",a.slice(c,c+1)),a.slice(c+1)];return p("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${a}${c<0?"":` (access key "${s[r]})"`}.`},h)}),e.source&&p("div",{class:"cm-diagnosticSource"},e.source))}class ro extends ut{constructor(e){super();this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return p("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class Ti{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Mi(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Le{constructor(e){this.view=e,this.items=[];let t=s=>{if(s.keyCode==27)Si(this.view),this.view.focus();else if(s.keyCode==38||s.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(s.keyCode==40||s.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(s.keyCode==36)this.moveSelection(0);else if(s.keyCode==35)this.moveSelection(this.items.length-1);else if(s.keyCode==13)this.view.focus();else if(s.keyCode>=65&&s.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:o}=this.items[this.selectedIndex],r=ki(o.actions);for(let l=0;l<r.length;l++)if(r[l].toUpperCase().charCodeAt(0)==s.keyCode){let a=_(this.view.state.field(T).diagnostics,o);a&&o.actions[l].apply(e,a.from,a.to)}}else return;s.preventDefault()},n=s=>{for(let o=0;o<this.items.length;o++)this.items[o].dom.contains(s.target)&&this.moveSelection(o)};this.list=p("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:n}),this.dom=p("div",{class:"cm-panel-lint"},this.list,p("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Si(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(T).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(T),n=0,s=!1,o=null;for(e.between(0,this.view.state.doc.length,(r,l,{spec:a})=>{let c=-1,h;for(let f=n;f<this.items.length;f++)if(this.items[f].diagnostic==a.diagnostic){c=f;break}c<0?(h=new Ti(this.view,a.diagnostic),this.items.splice(n,0,h),s=!0):(h=this.items[c],c>n&&(this.items.splice(n,c-n),s=!0)),t&&h.diagnostic==t.diagnostic?h.dom.hasAttribute("aria-selected")||(h.dom.setAttribute("aria-selected","true"),o=h):h.dom.hasAttribute("aria-selected")&&h.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)s=!0,this.items.pop();this.items.length==0&&(this.items.push(new Ti(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),s=!0),o?(this.list.setAttribute("aria-activedescendant",o.id),this.view.requestMeasure({key:this,read:()=>({sel:o.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:r,panel:l})=>{r.top<l.top?this.list.scrollTop-=l.top-r.top:r.bottom>l.bottom&&(this.list.scrollTop+=r.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),s&&this.sync()}sync(){let e=this.list.firstChild;function t(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)t();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(T),n=_(t.diagnostics,this.items[e].diagnostic);!n||this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Ci.of(n)})}static open(e){return new Le(e)}}function lo(i,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(i)}</svg>')`}function at(i){return lo(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${i}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const ao=y.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:at("#d11")},".cm-lintRange-warning":{backgroundImage:at("orange")},".cm-lintRange-info":{backgroundImage:at("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),co=[an(),fn(),Oi(),Wi(),wn(),Ri(),Pi(),Ii.allowMultipleSelections.of(!0),Ni(),Hi.fallback,Vi(),Sn(),Hs(),_s(),Bi(),Vn(),pt.of([...Tn,...$i,...Zn,...Yi,...bn,...Ws,...xi,...oo])];export{co as basicSetup};
