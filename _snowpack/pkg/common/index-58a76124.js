let Dt="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<Dt.length;n++)Dt[n]+=Dt[n-1];function Hn(n){for(let t=1;t<Dt.length;t+=2)if(Dt[t]>n)return Dt[t-1]<=n;return!1}function Ci(n){return n>=127462&&n<=127487}const Mi=8205;function X(n,t,e=!0,i=!0){return(e?Di:Fn)(n,t,i)}function Di(n,t,e){if(t==n.length)return t;t&&Oi(n.charCodeAt(t))&&Ti(n.charCodeAt(t-1))&&t--;let i=Wt(n,t);for(t+=Ce(i);t<n.length;){let s=Wt(n,t);if(i==Mi||s==Mi||e&&Hn(s))t+=Ce(s),i=s;else if(Ci(s)){let r=0,o=t-2;for(;o>=0&&Ci(Wt(n,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function Fn(n,t,e){for(;t>0;){let i=Di(n,t-2,e);if(i<t)return i;t--}return 0}function Oi(n){return n>=56320&&n<57344}function Ti(n){return n>=55296&&n<56320}function Wt(n,t){let e=n.charCodeAt(t);if(!Ti(e)||t+1==n.length)return e;let i=n.charCodeAt(t+1);return Oi(i)?(e-55296<<10)+(i-56320)+65536:e}function Wn(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function Ce(n){return n<65536?1:2}function Ri(n,t,e=n.length){let i=0;for(let s=0;s<e;)n.charCodeAt(s)==9?(i+=t-i%t,s++):(i++,s=X(n,s));return i}function Bi(n,t,e,i){for(let s=0,r=0;;){if(r>=t)return s;if(s==n.length)break;r+=n.charCodeAt(s)==9?e-r%e:1,s=X(n,s)}return i===!0?-1:n.length}class v{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,1|2),this.decompose(e,this.length,s,1),Z.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Z.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new zt(this),r=new zt(t);for(let o=e,l=e;;){if(s.next(o),r.next(o),o=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return!1;if(l+=s.value.length,s.done||l>=i)return!0}}iter(t=1){return new zt(this,t)}iterRange(t,e=this.length){return new Pi(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new Li(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?v.empty:t.length<=32?new B(t):Z.from(B.split(t,[]))}}class B extends v{constructor(t,e=zn(t)){super();this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let r=0;;r++){let o=this.text[r],l=s+o.length;if((e?i:l)>=t)return new qn(s,l,i,o);s=l+1,i++}}decompose(t,e,i,s){let r=t<=0&&e>=this.length?this:new B(Ei(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(s&1){let o=i.pop(),l=re(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new B(l,o.length+r.length));else{let h=l.length>>1;i.push(new B(l.slice(0,h)),new B(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof B))return super.replace(t,e,i);let s=re(this.text,re(i.text,Ei(this.text,0,t)),e),r=this.length+i.length-(e-t);return s.length<=32?new B(s,r):Z.from(B.split(s,[]),r)}sliceString(t,e=this.length,i=`
`){let s="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(s+=i),t<h&&e>r&&(s+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let r of t)i.push(r),s+=r.length+1,i.length==32&&(e.push(new B(i,s)),i=[],s=-1);return s>-1&&e.push(new B(i,s)),e}}class Z extends v{constructor(t,e){super();this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,s){for(let r=0;;r++){let o=this.children[r],l=s+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,s);s=l+1,i=h+1}}decompose(t,e,i,s){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=s&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let s=0,r=0;s<this.children.length;s++){let o=this.children[s],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>5-1&&h.lines>a>>5+1){let f=this.children.slice();return f[s]=h,new Z(f,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let s="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(s+=i),t<h&&e>o&&(s+=l.sliceString(t-o,e-o,i)),o=h+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Z))return 0;let i=0,[s,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,r+=e){if(s==o||r==l)return i;let h=this.children[s],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,s)=>i+s.length+1,-1)){let i=0;for(let u of t)i+=u.lines;if(i<32){let u=[];for(let g of t)g.flatten(u);return new B(u,e)}let s=Math.max(32,i>>5),r=s<<1,o=s>>1,l=[],h=0,a=-1,f=[];function c(u){let g;if(u.lines>r&&u instanceof Z)for(let p of u.children)c(p);else u.lines>o&&(h>o||!h)?(d(),l.push(u)):u instanceof B&&h&&(g=f[f.length-1])instanceof B&&u.lines+g.lines<=32?(h+=u.lines,a+=u.length+1,f[f.length-1]=new B(g.text.concat(u.text),g.length+1+u.length)):(h+u.lines>s&&d(),h+=u.lines,a+=u.length+1,f.push(u))}function d(){h!=0&&(l.push(f.length==1?f[0]:Z.from(f,a)),a=-1,h=f.length=0)}for(let u of t)c(u);return d(),l.length==1?l[0]:new Z(l,e)}}v.empty=new B([""],0);function zn(n){let t=-1;for(let e of n)t+=e.length+1;return t}function re(n,t,e=0,i=1e9){for(let s=0,r=0,o=!0;r<n.length&&s<=i;r++){let l=n[r],h=s+l.length;h>=e&&(h>i&&(l=l.slice(0,i-s)),s<e&&(l=l.slice(e-s)),o?(t[t.length-1]+=l,o=!1):t.push(l)),s=h+1}return t}function Ei(n,t,e){return re(n,[""],t,e)}class zt{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof B?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],r=this.offsets[i],o=r>>1,l=s instanceof B?s.text.length:s.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(s instanceof B){let h=s.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=s.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof B?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class Pi{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new zt(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Li{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol!="undefined"&&(v.prototype[Symbol.iterator]=function(){return this.iter()},zt.prototype[Symbol.iterator]=Pi.prototype[Symbol.iterator]=Li.prototype[Symbol.iterator]=function(){return this});class qn{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}const Me=/\r\n?|\n/;var G=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(G||(G={}));class tt{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,s,r),s+=r):s+=o,i+=r}}iterChangedRanges(t,e=!1){De(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new tt(t)}composeDesc(t){return this.empty?t:t.empty?this:Ii(this,t)}mapDesc(t,e=!1){return t.empty?this:Oe(this,t,e)}mapPos(t,e=-1,i=G.Simple){let s=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=s+l;if(h<0){if(a>t)return r+(t-s);r+=l}else{if(i!=G.Simple&&a>=t&&(i==G.TrackDel&&s<t&&a>t||i==G.TrackBefore&&s<t||i==G.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==s||e<0?r:r+h;r+=h}s=a}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return r}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let r=this.sections[i++],o=this.sections[i++],l=s+r;if(o>=0&&s<=e&&l>=t)return s<t&&l>e?"cover":!0;s=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new tt(t)}}class V extends tt{constructor(t,e){super(t);this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return De(this,(e,i,s,r,o)=>t=t.replace(s,s+(i-e),o),!1),t}mapDesc(t,e=!1){return Oe(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,r=0;s<e.length;s+=2){let o=e[s],l=e[s+1];if(l>=0){e[s]=l,e[s+1]=o;let h=s>>1;for(;i.length<h;)i.push(v.empty);i.push(o?t.slice(r,r+o):v.empty)}r+=o}return new V(e,i)}compose(t){return this.empty?t:t.empty?this:Ii(this,t,!0)}map(t,e=!1){return t.empty?this:Oe(this,t,e,!0)}iterChanges(t,e=!1){De(this,t,e)}get desc(){return new tt(this.sections)}filter(t){let e=[],i=[],s=[],r=new qt(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let f=Math.min(r.len,h-l);K(s,f,-1);let c=r.ins==-1?-1:r.off==0?r.ins:0;K(e,f,c),c>0&&yt(i,e,r.text),r.forward(f),l+=f}let a=t[o++];for(;l<a;){if(r.done)break t;let f=Math.min(r.len,a-l);K(e,f,-1),K(s,f,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(f),l+=f}}return{changes:new V(e,i),filtered:new tt(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):s==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],r=[],o=0,l=null;function h(f=!1){if(!f&&!s.length)return;o<e&&K(s,e-o,-1);let c=new V(s,r);l=l?l.compose(c.map(l)):c,s=[],r=[],o=0}function a(f){if(Array.isArray(f))for(let c of f)a(c);else if(f instanceof V){if(f.length!=e)throw new RangeError(`Mismatched change set length (got ${f.length}, expected ${e})`);h(),l=l?l.compose(f.map(l)):f}else{let{from:c,to:d=c,insert:u}=f;if(c>d||c<0||d>e)throw new RangeError(`Invalid change range ${c} to ${d} (in doc of length ${e})`);let g=u?typeof u=="string"?v.of(u.split(i||Me)):u:v.empty,p=g.length;if(c==d&&p==0)return;c<o&&h(),c>o&&K(s,c-o,-1),K(s,d-c,p),yt(r,s,g),o=d}}return a(t),h(!l),l}static empty(t){return new V(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let r=t[s];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<s;)i.push(v.empty);i[s]=v.of(r.slice(1)),e.push(r[0],i[s].length)}}}return new V(e,i)}}function K(n,t,e,i=!1){if(t==0&&e<=0)return;let s=n.length-2;s>=0&&e<=0&&e==n[s+1]?n[s]+=t:t==0&&n[s]==0?n[s+1]+=e:i?(n[s]+=t,n[s+1]+=e):n.push(t,e)}function yt(n,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(e);else{for(;n.length<i;)n.push(v.empty);n.push(e)}}function De(n,t,e){let i=n.inserted;for(let s=0,r=0,o=0;o<n.sections.length;){let l=n.sections[o++],h=n.sections[o++];if(h<0)s+=l,r+=l;else{let a=s,f=r,c=v.empty;for(;a+=l,f+=h,h&&i&&(c=c.append(i[o-2>>1])),!(e||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],h=n.sections[o++];t(s,a,r,f,c),s=a,r=f}}}function Oe(n,t,e,i=!1){let s=[],r=i?[]:null,o=new qt(n),l=new qt(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let f=Math.min(l.len,h-a);l.forward(f),K(s,f,-1),a+=f}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(K(s,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let f=0,c=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<c)f+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<c){let d=Math.min(l.len,c-a);f+=d,l.forward(d),a+=d}else break;K(s,f,o.ins),r&&yt(r,s,o.text),h=c,o.next()}else{if(o.done&&l.done)return r?new V(s,r):new tt(s);throw new Error("Mismatched change set lengths")}}function Ii(n,t,e=!1){let i=[],s=e?[]:null,r=new qt(n),o=new qt(t);for(let l=!1;;){if(r.done&&o.done)return s?new V(i,s):new tt(i);if(r.ins==0)K(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)K(i,0,o.ins,l),s&&yt(s,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let f=o.ins==-1?-1:o.off?0:o.ins;K(i,h,f,l),s&&f&&yt(s,i,o.text)}else o.ins==-1?(K(i,r.off?0:r.len,h,l),s&&yt(s,i,r.textBit(h))):(K(i,r.off?0:r.len,o.off?0:o.ins,l),s&&!o.off&&yt(s,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}class qt{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?v.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?v.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Ot{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i=t.mapPos(this.from,e),s=t.mapPos(this.to,e);return i==this.from&&s==this.to?this:new Ot(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return w.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return w.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return w.range(t.anchor,t.head)}}class w{constructor(t,e=0){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:w.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new w([this.main])}addRange(t,e=!0){return w.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,w.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new w(t.ranges.map(e=>Ot.fromJSON(e)),t.main)}static single(t,e=t){return new w([w.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let r=t[s];if(r.empty?r.from<=i:r.from<i)return Kn(t.slice(),e);i=r.to}return new w(t,e)}static cursor(t,e=0,i,s){return new Ot(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(s??33554431)<<5)}static range(t,e,i){let s=(i??33554431)<<5;return e<t?new Ot(e,t,16|s):new Ot(t,e,s)}}function Kn(n,t=0){let e=n[t];n.sort((i,s)=>i.from-s.from),t=n.indexOf(e);for(let i=1;i<n.length;i++){let s=n[i],r=n[i-1];if(s.empty?s.from<=r.to:s.from<r.to){let o=r.from,l=Math.max(s.to,r.to);i<=t&&t--,n.splice(--i,2,s.anchor>s.head?w.range(l,o):w.range(o,l))}}return new w(n,t)}function Ni(n,t){for(let e of n.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let Te=0;class S{constructor(t,e,i,s,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.extensions=r,this.id=Te++,this.default=t([])}static define(t={}){return new S(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:jn),!!t.static,t.enables)}of(t){return new oe([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new oe(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new oe(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}}function jn(n,t){return n==t||n.length==t.length&&n.every((e,i)=>e===t[i])}class oe{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=Te++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,r=t[this.id]>>1,o=this.type==2,l=!1,h=!1,a=[];for(let f of this.dependencies)f=="doc"?l=!0:f=="selection"?h=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&a.push(t[f.id]);return(f,c)=>{let d=f.values[r];if(d===Kt)return f.values[r]=i(f),1;if(c&&(l&&c.docChanged||h&&(c.docChanged||c.selection)||a.some(g=>(jt(f,g)&1)>0))){let g=i(f);if(o?!$n(g,d,s):!s(g,d))return f.values[r]=g,1}return 0}}}function $n(n,t,e){if(n.length!=t.length)return!1;for(let i=0;i<n.length;i++)if(!e(n[i],t[i]))return!1;return!0}function Un(n,t,e){let i=e.map(l=>n[l.id]),s=e.map(l=>l.type),r=i.filter(l=>!(l&1)),o=n[t.id]>>1;return(l,h)=>{let a=l.values[o],f=a===Kt||!h;for(let u of r)jt(l,u)&1&&(f=!0);if(!f)return 0;let c=[];for(let u=0;u<i.length;u++){let g=Tt(l,i[u]);if(s[u]==2)for(let p of g)c.push(p);else c.push(g)}let d=t.combine(c);return a!==Kt&&t.compare(d,a)?0:(l.values[o]=d,1)}}const Vi=S.define({static:!0});class wt{constructor(t,e,i,s,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=r,this.provides=void 0}static define(t){let e=new wt(Te++,t.create,t.update,t.compare||((i,s)=>i===s),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Vi).find(i=>i.field==this);return((e==null?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return(i,s)=>{let r=i.values[e];if(r===Kt)return i.values[e]=this.create(i),1;if(s){let o=this.updateF(r,s);if(!this.compareF(r,o))return i.values[e]=o,1}return 0}}init(t){return[this,Vi.of({field:this,create:t})]}get extension(){return this}}const et={lowest:4,low:3,default:2,high:1,highest:0};function ft(n){return t=>new Hi(t,n)}const Re={lowest:ft(et.lowest),low:ft(et.low),default:ft(et.default),high:ft(et.high),highest:ft(et.highest),fallback:ft(et.lowest),extend:ft(et.high),override:ft(et.highest)};class Hi{constructor(t,e){this.inner=t,this.prec=e}}class le{of(t){return new Be(this,t)}reconfigure(t){return le.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class Be{constructor(t,e){this.compartment=t,this.inner=e}}class he{constructor(t,e,i,s,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],r=Object.create(null),o=new Map;for(let d of Gn(t,e,o))d instanceof wt?s.push(d):(r[d.facet.id]||(r[d.facet.id]=[])).push(d);let l=Object.create(null),h=[],a=[],f=[];for(let d of s)l[d.id]=a.length<<1,a.push(u=>d.slot(u)),f.push([]);for(let d in r){let u=r[d],g=u[0].facet;if(u.every(p=>p.type==0)){l[g.id]=h.length<<1|1;let p=g.combine(u.map(b=>b.value)),m=i?i.config.address[g.id]:null;if(m!=null){let b=Tt(i,m);g.compare(p,b)&&(p=b)}h.push(p)}else{for(let p of u)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(m=>p.dynamicSlot(m)),f.push(p.dependencies.filter(m=>typeof m!="string").map(m=>m.id)));l[g.id]=a.length<<1,a.push(p=>Un(p,g,u)),f.push(u.filter(p=>p.type!=0).map(p=>p.id))}}let c=a.map(d=>Kt);if(i){let d=(u,g)=>{if(g>7)return!1;let p=l[u];if(!(p&1))return f[p>>1].every(b=>d(b,g+1));let m=i.config.address[u];return m!=null&&Tt(i,m)==h[p>>1]};for(let u in l){let g=l[u],p=i.config.address[u];p!=null&&(g&1)==0&&d(+u,0)&&(c[g>>1]=Tt(i,p))}}return{configuration:new he(t,o,a.map(d=>d(l)),l,h),values:c}}}function Gn(n,t,e){let i=[[],[],[],[],[]],s=new Map;function r(o,l){let h=s.get(o);if(h!=null){if(h>=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof Be&&e.delete(o.compartment)}if(s.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof Be){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof Hi)r(o.inner,o.prec);else if(o instanceof wt)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof oe)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(n,et.default),i.reduce((o,l)=>o.concat(l))}const Kt={};function jt(n,t){if(t&1)return 2;let e=t>>1,i=n.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[e]=4;let s=n.config.dynamicSlots[e](n,n.applying);return n.status[e]=2|s}function Tt(n,t){return t&1?n.config.staticValues[t>>1]:n.values[t>>1]}const Fi=S.define(),Wi=S.define({combine:n=>n.some(t=>t),static:!0}),zi=S.define({combine:n=>n.length?n[0]:void 0,static:!0}),qi=S.define(),Ki=S.define(),ji=S.define(),$i=S.define({combine:n=>n.length?n[0]:!1});class Rt{constructor(t,e){this.type=t,this.value=e}static define(){return new Jn}}class Jn{of(t){return new Rt(this,t)}}class Yn{constructor(t){this.map=t}of(t){return new E(this,t)}}class E{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new E(this.type,e)}is(t){return this.type==t}static define(t={}){return new Yn(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let r=s.map(e);r&&i.push(r)}return i}}E.reconfigure=E.define(),E.appendConfig=E.define();class z{constructor(t,e,i,s,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Ni(i,e.newLength),r.some(l=>l.type==z.time)||(this.annotations=r.concat(z.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(z.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}z.time=Rt.define(),z.userEvent=Rt.define(),z.addToHistory=Rt.define(),z.remote=Rt.define();function Xn(n,t){let e=[];for(let i=0,s=0;;){let r,o;if(i<n.length&&(s==t.length||t[s]>=n[i]))r=n[i++],o=n[i++];else if(s<t.length)r=t[s++],o=t[s++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function Ui(n,t,e){var i;let s,r,o;return e?(s=t.changes,r=V.empty(t.changes.length),o=n.changes.compose(t.changes)):(s=t.changes.map(n.changes),r=n.changes.mapDesc(t.changes,!0),o=n.changes.compose(s)),{changes:o,selection:t.selection?t.selection.map(r):(i=n.selection)===null||i===void 0?void 0:i.map(s),effects:E.mapEffects(n.effects,s).concat(E.mapEffects(t.effects,r)),annotations:n.annotations.length?n.annotations.concat(t.annotations):t.annotations,scrollIntoView:n.scrollIntoView||t.scrollIntoView}}function Ee(n,t,e){let i=t.selection,s=Bt(t.annotations);return t.userEvent&&(s=s.concat(z.userEvent.of(t.userEvent))),{changes:t.changes instanceof V?t.changes:V.of(t.changes||[],e,n.facet(zi)),selection:i&&(i instanceof w?i:w.single(i.anchor,i.head)),effects:Bt(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function Gi(n,t,e){let i=Ee(n,t.length?t[0]:{},n.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=Ui(i,Ee(n,t[r],o?i.changes.newLength:n.doc.length),o)}let s=new z(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Qn(e?Zn(s):s)}function Zn(n){let t=n.startState,e=!0;for(let s of t.facet(qi)){let r=s(n);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:Xn(e,r))}if(e!==!0){let s,r;if(e===!1)r=n.changes.invertedDesc,s=V.empty(t.doc.length);else{let o=n.changes.filter(e);s=o.changes,r=o.filtered.invertedDesc}n=new z(t,s,n.selection&&n.selection.map(r),E.mapEffects(n.effects,r),n.annotations,n.scrollIntoView)}let i=t.facet(Ki);for(let s=i.length-1;s>=0;s--){let r=i[s](n);r instanceof z?n=r:Array.isArray(r)&&r.length==1&&r[0]instanceof z?n=r[0]:n=Gi(t,Bt(r),!1)}return n}function Qn(n){let t=n.startState,e=t.facet(ji),i=n;for(let s=e.length-1;s>=0;s--){let r=e[s](n);r&&Object.keys(r).length&&(i=Ui(n,Ee(t,r,n.changes.newLength),!0))}return i==n?n:new z(t,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const _n=[];function Bt(n){return n==null?_n:Array.isArray(n)?n:[n]}var Q=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(Q||(Q={}));const tr=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Pe;try{Pe=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(n){}function er(n){if(Pe)return Pe.test(n);for(let t=0;t<n.length;t++){let e=n[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||tr.test(e)))return!0}return!1}function ir(n){return t=>{if(!/\S/.test(t))return Q.Space;if(er(t))return Q.Word;for(let e=0;e<n.length;e++)if(t.indexOf(n[e])>-1)return Q.Word;return Q.Other}}class k{constructor(t,e,i,s,r=null){this.config=t,this.doc=e,this.selection=i,this.values=s,this.applying=null,this.status=t.statusTemplate.slice(),this.applying=r,r&&(r._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)jt(this,o<<1);this.applying=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return jt(this,i),Tt(this,i)}update(...t){return Gi(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:s}=e;for(let o of t.effects)o.is(le.reconfigure)?(e&&(s=new Map,e.compartments.forEach((l,h)=>s.set(h,l)),e=null),s.set(o.value.compartment,o.value.extension)):o.is(E.reconfigure)?(e=null,i=o.value):o.is(E.appendConfig)&&(e=null,i=Bt(i).concat(o.value));let r;if(e)r=t.startState.values.slice();else{let o=he.resolve(i,s,this);e=o.configuration,r=new k(e,this.doc,this.selection,o.values,null).values}new k(e,t.newDoc,t.newSelection,r,t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:w.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),r=[i.range],o=Bt(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),f=a.map(s);for(let d=0;d<l;d++)r[d]=r[d].map(f);let c=s.mapDesc(a,!0);r.push(h.range.map(c)),s=s.compose(f),o=E.mapEffects(o,f).concat(E.mapEffects(Bt(h.effects),c))}return{changes:s,selection:w.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof V?t:V.of(t,this.doc.length,this.facet(k.lineSeparator))}toText(t){return v.of(t.split(this.facet(k.lineSeparator)||Me))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(jt(this,e),Tt(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof wt&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let r in i){let o=i[r],l=t[r];s.push(o.init(h=>o.spec.fromJSON(l,h)))}return k.create({doc:t.doc,selection:w.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let{configuration:e,values:i}=he.resolve(t.extensions||[],new Map),s=t.doc instanceof v?t.doc:v.of((t.doc||"").split(e.staticFacet(k.lineSeparator)||Me)),r=t.selection?t.selection instanceof w?t.selection:w.single(t.selection.anchor,t.selection.head):w.single(0);return Ni(r,s.length),e.staticFacet(Wi)||(r=r.asSingle()),new k(e,s,r,i)}get tabSize(){return this.facet(k.tabSize)}get lineBreak(){return this.facet(k.lineSeparator)||`
`}get readOnly(){return this.facet($i)}phrase(t){for(let e of this.facet(k.phrases))if(Object.prototype.hasOwnProperty.call(e,t))return e[t];return t}languageDataAt(t,e,i=-1){let s=[];for(let r of this.facet(Fi))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&s.push(o[t]);return s}charCategorizer(t){return ir(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=X(e,o,!1);if(r(e.slice(h,o))!=Q.Word)break;o=h}for(;l<s;){let h=X(e,l);if(r(e.slice(l,h))!=Q.Word)break;l=h}return o==l?null:w.range(o+i,l+i)}}k.allowMultipleSelections=Wi,k.tabSize=S.define({combine:n=>n.length?n[0]:4}),k.lineSeparator=zi,k.readOnly=$i,k.phrases=S.define(),k.languageData=Fi,k.changeFilter=qi,k.transactionFilter=Ki,k.transactionExtender=ji,le.reconfigure=E.define();function Le(n,t,e={}){let i={};for(let s of n)for(let r of Object.keys(s)){let o=s[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let s in t)i[s]===void 0&&(i[s]=t[s]);return i}const Ie="ͼ",Ji=typeof Symbol=="undefined"?"__"+Ie:Symbol.for(Ie),Ne=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Yi=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};class bt{constructor(t,e){this.rules=[];let{finish:i}=e||{};function s(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function r(o,l,h,a){let f=[],c=/^@(\w+)\b/.exec(o[0]),d=c&&c[1]=="keyframes";if(c&&l==null)return h.push(o[0]+";");for(let u in l){let g=l[u];if(/&/.test(u))r(u.split(/,\s*/).map(p=>o.map(m=>p.replace(/&/,m))).reduce((p,m)=>p.concat(m)),g,h);else if(g&&typeof g=="object"){if(!c)throw new RangeError("The value of a property ("+u+") should be a primitive value.");r(s(u),g,f,d)}else g!=null&&f.push(u.replace(/_.*/,"").replace(/[A-Z]/g,p=>"-"+p.toLowerCase())+": "+g+";")}(f.length||d)&&h.push((i&&!c&&!a?o.map(i):o).join(", ")+" {"+f.join(" ")+"}")}for(let o in t)r(s(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=Yi[Ji]||1;return Yi[Ji]=t+1,Ie+t.toString(36)}static mount(t,e){(t[Ne]||new sr(t)).mount(Array.isArray(e)?e:[e])}}let ae=null;class sr{constructor(t){if(!t.head&&t.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(ae)return t.adoptedStyleSheets=[ae.sheet].concat(t.adoptedStyleSheets),t[Ne]=ae;this.sheet=new CSSStyleSheet,t.adoptedStyleSheets=[this.sheet].concat(t.adoptedStyleSheets),ae=this}else{this.styleTag=(t.ownerDocument||t).createElement("style");let e=t.head||t;e.insertBefore(this.styleTag,e.firstChild)}this.modules=[],t[Ne]=this}mount(t){let e=this.sheet,i=0,s=0;for(let r=0;r<t.length;r++){let o=t[r],l=this.modules.indexOf(o);if(l<s&&l>-1&&(this.modules.splice(l,1),s--,l=-1),l==-1){if(this.modules.splice(s++,0,o),e)for(let h=0;h<o.rules.length;h++)e.insertRule(o.rules[h],i++)}else{for(;s<l;)i+=this.modules[s++].rules.length;i+=o.rules.length,s++}}if(!e){let r="";for(let o=0;o<this.modules.length;o++)r+=this.modules[o].getRules()+`
`;this.styleTag.textContent=r}}}class Et{eq(t){return this==t}range(t,e=t){return new Ve(t,e,this)}}Et.prototype.startSide=Et.prototype.endSide=0,Et.prototype.point=!1,Et.prototype.mapMode=G.TrackDel;class Ve{constructor(t,e,i){this.from=t,this.to=e,this.value=i}}function He(n,t){return n.from-t.from||n.value.startSide-t.value.startSide}class Fe{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let r=i?this.to:this.from;for(let o=s,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,s){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(s(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],s=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],f=this.from[h]+t,c=this.to[h]+t,d,u;if(f==c){let g=e.mapPos(f,a.startSide,a.mapMode);if(g==null||(d=u=g,a.startSide!=a.endSide&&(u=e.mapPos(f,a.endSide),u<d)))continue}else if(d=e.mapPos(f,a.startSide),u=e.mapPos(c,a.endSide),d>u||d==u&&a.startSide>0&&a.endSide<=0)continue;(u-d||a.endSide-a.startSide)<0||(o<0&&(o=d),a.point&&(l=Math.max(l,u-d)),i.push(a),s.push(d-o),r.push(u-o))}return{mapped:i.length?new Fe(s,r,i,l):null,pos:o}}}class P{constructor(t,e,i=P.empty,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&e.slice().sort(He),this.isEmpty)return e.length?P.of(e):this;let l=new Zi(this,null,-1).goto(0),h=0,a=[],f=new Pt;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let c=e[h++];f.addInner(c.from,c.to,c.value)||a.push(c)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||s>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&f.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||s>l.to||r<l.from||o(l.from,l.to,l.value))&&(f.addInner(l.from,l.to,l.value)||a.push(new Ve(l.from,l.to,l.value))),l.next());return f.finishInner(this.nextLayer.isEmpty&&!a.length?P.empty:this.nextLayer.update({add:a,filter:o,filterFrom:s,filterTo:r}))}map(t){if(t.length==0||this.isEmpty)return this;let e=[],i=[],s=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)s=Math.max(s,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:f,pos:c}=h.map(l,t);f&&(s=Math.max(s,f.maxPoint),e.push(f),i.push(c))}}let r=this.nextLayer.map(t);return e.length==0?r:new P(i,e,r,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return $t.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return $t.from(t).goto(e)}static compare(t,e,i,s,r=-1){let o=t.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=r),l=e.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=r),h=Xi(o,l,i),a=new Ut(o,h,r),f=new Ut(l,h,r);i.iterGaps((c,d,u)=>Qi(a,c,f,d,u,s)),i.empty&&i.length==0&&Qi(a,0,f,0,0,s)}static eq(t,e,i=0,s){s==null&&(s=1e9);let r=t.filter(f=>!f.isEmpty&&e.indexOf(f)<0),o=e.filter(f=>!f.isEmpty&&t.indexOf(f)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=Xi(r,o),h=new Ut(r,l,0).goto(i),a=new Ut(o,l,0).goto(i);for(;;){if(h.to!=a.to||!ze(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>s)return!0;h.next(),a.next()}}static spans(t,e,i,s,r=-1){var o;let l=new Ut(t,null,r,(o=s.filterPoint)===null||o===void 0?void 0:o.bind(s)).goto(e),h=e,a=l.openStart;for(;;){let f=Math.min(l.to,i);if(l.point?(s.point(h,f,l.point,l.activeForPoint(l.to),a),a=l.openEnd(f)+(l.to>f?1:0)):f>h&&(s.span(h,f,l.active,a),a=l.openEnd(f)),l.to>i)break;h=l.to,l.next()}return a}static of(t,e=!1){let i=new Pt;for(let s of t instanceof Ve?[t]:e?nr(t):t)i.add(s.from,s.to,s.value);return i.finish()}}P.empty=new P([],[],null,-1);function nr(n){if(n.length>1)for(let t=n[0],e=1;e<n.length;e++){let i=n[e];if(He(t,i)>0)return n.slice().sort(He);t=i}return n}P.empty.nextLayer=P.empty;class Pt{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new Fe(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new Pt)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(P.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=new P(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Xi(n,t,e){let i=new Map;for(let r of n)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let s=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!(e==null?void 0:e.touchesRange(l,l+r.chunk[o].length))&&s.add(r.chunk[o])}return s}class Zi{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<t||s.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.to-t.to||this.endSide-t.endSide}}class $t{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&s.push(new Zi(o,e,i,r));return s.length==1?s[0]:new $t(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)We(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)We(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),We(this.heap,0)}}}function We(n,t){for(let e=n[t];;){let i=(t<<1)+1;if(i>=n.length)break;let s=n[i];if(i+1<n.length&&s.compare(n[i+1])>=0&&(s=n[i+1],i++),e.compare(s)<0)break;n[i]=e,n[t]=s,t=i}}class Ut{constructor(t,e,i,s=()=>!0){this.minPoint=i,this.filterPoint=s,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=$t.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){fe(this.active,t),fe(this.activeTo,t),fe(this.activeRank,t),this.minActive=_i(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;ce(this.active,e,i),ce(this.activeTo,e,s),ce(this.activeRank,e,r),t&&ce(t,e,this.cursor.from),this.minActive=_i(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,s=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&fe(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank))this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(s=1),this.cursor.next(),this.to>t&&this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+s}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Qi(n,t,e,i,s,r){n.goto(t),e.goto(i);let o=i+s,l=i,h=i-t;for(;;){let a=n.to+h-e.to||n.endSide-e.endSide,f=a<0?n.to+h:e.to,c=Math.min(f,o);if(n.point||e.point?n.point&&e.point&&(n.point==e.point||n.point.eq(e.point))&&ze(n.activeForPoint(n.to+h),e.activeForPoint(e.to))||r.comparePoint(l,c,n.point,e.point):c>l&&!ze(n.active,e.active)&&r.compareRange(l,c,n.active,e.active),f>o)break;l=f,a<=0&&n.next(),a>=0&&e.next()}}function ze(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!=t[e]&&!n[e].eq(t[e]))return!1;return!0}function fe(n,t){for(let e=t,i=n.length-1;e<i;e++)n[e]=n[e+1];n.pop()}function ce(n,t,e){for(let i=n.length-1;i>=t;i--)n[i+1]=n[i];n[t]=e}function _i(n,t){let e=-1,i=1e9;for(let s=0;s<t.length;s++)(t[s]-i||n[s].endSide-n[e].endSide)<0&&(e=s,i=t[s]);return e}for(var ct={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},ue={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},ts=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),rr=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),or=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),es=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),lr=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),hr=ts&&(es||+ts[1]<57)||or&&es,H=0;H<10;H++)ct[48+H]=ct[96+H]=String(H);for(var H=1;H<=24;H++)ct[H+111]="F"+H;for(var H=65;H<=90;H++)ct[H]=String.fromCharCode(H+32),ue[H]=String.fromCharCode(H);for(var qe in ct)ue.hasOwnProperty(qe)||(ue[qe]=ct[qe]);function ar(n){var t=hr&&(n.ctrlKey||n.altKey||n.metaKey)||(rr||lr)&&n.shiftKey&&n.key&&n.key.length==1,e=!t&&n.key||(n.shiftKey?ue:ct)[n.keyCode]||n.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}function de(n){let t;return n.nodeType==11?t=n.getSelection?n:n.ownerDocument:t=n,t.getSelection()}function Ke(n,t){return t?n.contains(t.nodeType!=1?t.parentNode:t):!1}function fr(){let n=document.activeElement;for(;n&&n.shadowRoot;)n=n.shadowRoot.activeElement;return n}function je(n,t){if(!t.anchorNode)return!1;try{return Ke(n,t.anchorNode)}catch(e){return!1}}function Lt(n){return n.nodeType==3?Gt(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function ge(n,t,e,i){return e?is(n,t,e,i,-1)||is(n,t,e,i,1):!1}function $e(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t}function is(n,t,e,i,s){for(;;){if(n==e&&t==i)return!0;if(t==(s<0?0:pe(n))){if(n.nodeName=="DIV")return!1;let r=n.parentNode;if(!r||r.nodeType!=1)return!1;t=$e(n)+(s<0?0:1),n=r}else if(n.nodeType==1){if(n=n.childNodes[t+(s<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;t=s<0?pe(n):0}else return!1}}function pe(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}const ss={left:0,right:0,top:0,bottom:0};function me(n,t){let e=t?n.left:n.right;return{left:e,right:e,top:n.top,bottom:n.bottom}}function cr(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function ur(n,t,e,i,s,r,o,l){let h=n.ownerDocument,a=h.defaultView;for(let f=n;f;)if(f.nodeType==1){let c,d=f==h.body;if(d)c=cr(a);else{if(f.scrollHeight<=f.clientHeight&&f.scrollWidth<=f.clientWidth){f=f.parentNode;continue}let p=f.getBoundingClientRect();c={left:p.left,right:p.left+f.clientWidth,top:p.top,bottom:p.top+f.clientHeight}}let u=0,g=0;if(s=="nearest")t.top<c.top?(g=-(c.top-t.top+o),e>0&&t.bottom>c.bottom+g&&(g=t.bottom-c.bottom+g+o)):t.bottom>c.bottom&&(g=t.bottom-c.bottom+o,e<0&&t.top-g<c.top&&(g=-(c.top+g-t.top+o)));else{let p=t.bottom-t.top,m=c.bottom-c.top;g=(s=="center"&&p<=m?t.top+p/2-m/2:s=="start"||s=="center"&&e<0?t.top-o:t.bottom-m+o)-c.top}if(i=="nearest"?t.left<c.left?(u=-(c.left-t.left+r),e>0&&t.right>c.right+u&&(u=t.right-c.right+u+r)):t.right>c.right&&(u=t.right-c.right+r,e<0&&t.left<c.left+u&&(u=-(c.left+u-t.left+r))):u=(i=="center"?t.left+(t.right-t.left)/2-(c.right-c.left)/2:i=="start"==l?t.left-r:t.right-(c.right-c.left)+r)-c.left,u||g)if(d)a.scrollBy(u,g);else{if(g){let p=f.scrollTop;f.scrollTop+=g,g=f.scrollTop-p}if(u){let p=f.scrollLeft;f.scrollLeft+=u,u=f.scrollLeft-p}t={left:t.left-u,top:t.top-g,right:t.right-u,bottom:t.bottom-g}}if(d)break;f=f.assignedSlot||f.parentNode,i=s="nearest"}else if(f.nodeType==11)f=f.host;else break}class dr{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let It=null;function ns(n){if(n.setActive)return n.setActive();if(It)return n.focus(It);let t=[];for(let e=n;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(n.focus(It==null?{get preventScroll(){return It={preventScroll:!0},!0}}:void 0),!It){It=!1;for(let e=0;e<t.length;){let i=t[e++],s=t[e++],r=t[e++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let rs;function Gt(n,t,e=t){let i=rs||(rs=document.createRange());return i.setEnd(n,e),i.setStart(n,t),i}function Jt(n,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},s=new KeyboardEvent("keydown",i);s.synthetic=!0,n.dispatchEvent(s);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,n.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function gr(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function os(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}class q{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new q(t.parentNode,$e(t),e)}static after(t,e){return new q(t.parentNode,$e(t)+1,e)}}const Ue=[];class T{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=e.firstChild;for(let s of this.children){if(s.dirty){if(!s.dom&&i){let r=T.get(i);(!r||!r.parent&&r.constructor==s.constructor)&&s.reuseDOM(i)}s.sync(t),s.dirty=0}if(t&&!t.written&&t.node==e&&i!=s.dom&&(t.written=!0),s.dom.parentNode==e){for(;i&&i!=s.dom;)i=ls(i);i=s.dom.nextSibling}else e.insertBefore(s.dom,i)}for(i&&t&&t.node==e&&(t.written=!0);i;)i=ls(i)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=pe(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;s==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?s=-1:s=1),t=r}s<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!T.get(i);)i=i.nextSibling;if(!i)return this.length;for(let s=0,r=0;;s++){let o=this.children[s];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,f=i;h<this.children.length;h++){let c=this.children[h],d=a+c.length;if(a<t&&d>e)return c.domBoundsAround(t,e,a);if(d>=t&&s==-1&&(s=h,r=a),a>e&&c.dom.parentNode==this.dom){o=h,l=f;break}f=d,a=d+c.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Ue){this.markDirty();for(let s=t;s<e;s++){let r=this.children[s];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new hs(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}T.prototype.breakAfter=0;function ls(n){let t=n.nextSibling;return n.parentNode.removeChild(n),t}class hs{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function as(n,t,e,i,s,r,o,l,h){let{children:a}=n,f=a.length?a[t]:null,c=r.length?r[r.length-1]:null,d=c?c.breakAfter:o;if(!(t==i&&f&&!o&&!d&&r.length<2&&f.merge(e,s,r.length?c:null,e==0,l,h))){if(i<a.length){let u=a[i];u&&s<u.length?(t==i&&(u=u.split(s),s=0),!d&&c&&u.merge(0,s,c,!0,0,h)?r[r.length-1]=u:(s&&u.merge(0,s,null,!1,0,h),r.push(u))):(u==null?void 0:u.breakAfter)&&(c?c.breakAfter=1:o=1),i++}for(f&&(f.breakAfter=o,e>0&&(!o&&r.length&&f.merge(e,f.length,r[0],!1,l,0)?f.breakAfter=r.shift().breakAfter:(e<f.length||f.children.length&&f.children[f.children.length-1].length==0)&&f.merge(e,f.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&n.replaceChildren(t,i,r)}}function fs(n,t,e,i,s,r){let o=n.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:f}=o.findPos(t,-1),c=t-e;for(let d of i)c+=d.length;n.length+=c,as(n,a,f,l,h,i,0,s,r)}let[J,Ge]=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}];const Je=/Edge\/(\d+)/.exec(J.userAgent),cs=/MSIE \d/.test(J.userAgent),Ye=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(J.userAgent),ye=!!(cs||Ye||Je),us=!ye&&/gecko\/(\d+)/i.test(J.userAgent),Xe=!ye&&/Chrome\/(\d+)/.exec(J.userAgent),ds="webkitFontSmoothing"in Ge.documentElement.style,gs=!ye&&/Apple Computer/.test(J.vendor),ps=gs&&(/Mobile\/\w+/.test(J.userAgent)||J.maxTouchPoints>2);var y={mac:ps||/Mac/.test(J.platform),windows:/Win/.test(J.platform),linux:/Linux|X11/.test(J.platform),ie:ye,ie_version:cs?Ge.documentMode||6:Ye?+Ye[1]:Je?+Je[1]:0,gecko:us,gecko_version:us?+(/Firefox\/(\d+)/.exec(J.userAgent)||[0,0])[1]:0,chrome:!!Xe,chrome_version:Xe?+Xe[1]:0,ios:ps,android:/Android\b/.test(J.userAgent),webkit:ds,safari:gs,webkit_version:ds?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Ge.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const pr=256;class St extends T{constructor(t){super();this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof St)||this.length-(e-t)+i.length>pr)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new St(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new q(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return ms(this.dom,t,e)}}class xt extends T{constructor(t,e=[],i=0){super();this.mark=t,this.children=e,this.length=i;for(let s of e)s.setParent(this)}setAttrs(t){if(os(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=4|2)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,r,o){return i&&(!(i instanceof xt&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(fs(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),s<0&&i>=t&&(s=r),i=h,r++}let o=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new xt(this.mark,e,o)}domAtPos(t){return ys(this.dom,this.children,t)}coordsAt(t,e){return bs(this,t,e)}}function ms(n,t,e){let i=n.nodeValue.length;t>i&&(t=i);let s=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?y.chrome||y.gecko||(t?(s--,o=1):(r++,o=-1)):e<0?s--:r++;let l=Gt(n,s,r).getClientRects();if(!l.length)return ss;let h=l[(o?o<0:e>=0)?0:l.length-1];return y.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?me(h,o<0):h||null}class ut extends T{constructor(t,e,i){super();this.widget=t,this.length=e,this.side=i}static create(t,e,i){return new(t.customView||ut)(t,e,i)}split(t){let e=ut.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,r,o){return i&&(!(i instanceof ut)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof ut&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return v.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):v.empty}domAtPos(t){return t==0?q.before(this.dom):q.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return ss;for(let r=t>0?i.length-1:0;s=i[r],!(t>0?r==0:r==i.length-1||s.top<s.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?s:me(s,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class mr extends ut{domAtPos(t){return new q(this.widget.text,t)}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){return e?t.nodeType==3?Math.min(e,this.length):this.length:0}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){return ms(this.widget.text,t,e)}get isEditable(){return!0}}const Ze=y.android?"​​":"​";class Nt extends T{constructor(t){super();this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Nt&&t.side==this.side}split(){return new Nt(this.side)}sync(){this.dom?this.dirty&&this.dom.nodeValue!=Ze&&(this.dom.nodeValue=Ze):this.setDOM(document.createTextNode(Ze))}getSide(){return this.side}domAtPos(t){return q.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=Lt(this.dom);return e[e.length-1]||null}get overrideDOMText(){return v.of([this.dom.nodeValue.replace(/\u200b/g,"")])}}St.prototype.children=ut.prototype.children=Nt.prototype.children=Ue;function ys(n,t,e){let i=0;for(let s=0;i<t.length;i++){let r=t[i],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(e>s&&e<o&&r.dom.parentNode==n)return r.domAtPos(e-s);if(e<=s)break;s=o}}for(;i>0;i--){let s=t[i-1].dom;if(s.parentNode==n)return q.after(s)}return new q(n,0)}function ws(n,t,e){let i,{children:s}=n;e>0&&t instanceof xt&&s.length&&(i=s[s.length-1])instanceof xt&&i.mark.eq(t.mark)?ws(i,t.children[0],e-1):(s.push(t),t.setParent(n)),n.length+=t.length}function bs(n,t,e){for(let r=0,o=0;o<n.children.length;o++){let l=n.children[o],h=r+l.length,a;if((e<=0||h==n.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==n.children.length||(a=n.children[o+1]).length||a.getSide()>0)){let f=0;if(h==r){if(l.getSide()<=0)continue;f=e=-l.getSide()}let c=l.coordsAt(t-r,e);return f&&c?me(c,e<0):c}r=h}let i=n.dom.lastChild;if(!i)return n.dom.getBoundingClientRect();let s=Lt(i);return s[s.length-1]||null}function Qe(n,t){for(let e in n)e=="class"&&t.class?t.class+=" "+n.class:e=="style"&&t.style?t.style+=";"+n.style:t[e]=n[e];return t}function _e(n,t){if(n==t)return!0;if(!n||!t)return!1;let e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let s of e)if(i.indexOf(s)==-1||n[s]!==t[s])return!1;return!0}function ti(n,t,e){if(t)for(let i in t)e&&i in e||n.removeAttribute(i);if(e)for(let i in e)t&&t[i]==e[i]||n.setAttribute(i,e[i])}class vt{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var A=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(A||(A={}));class M extends Et{constructor(t,e,i,s){super();this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new we(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new kt(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,{start:i,end:s}=Ss(t,e),r=e?i?-3e8:-1:4e8,o=e?s?2e8:1:-5e8;return new kt(t,r,o,e,t.widget||null,!0)}static line(t){return new Yt(t)}static set(t,e=!1){return P.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}M.none=P.empty;class we extends M{constructor(t){let{start:e,end:i}=Ss(t);super(e?-1:4e8,i?1:-5e8,null,t);this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof we&&this.tagName==t.tagName&&this.class==t.class&&_e(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}we.prototype.point=!1;class Yt extends M{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Yt&&_e(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Yt.prototype.mapMode=G.TrackBefore,Yt.prototype.point=!0;class kt extends M{constructor(t,e,i,s,r,o){super(e,i,r,t);this.block=s,this.isReplace=o,this.mapMode=s?e<=0?G.TrackBefore:G.TrackAfter:G.TrackDel}get type(){return this.startSide<this.endSide?A.WidgetRange:this.startSide<=0?A.WidgetBefore:A.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof kt&&yr(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}kt.prototype.point=!0;function Ss(n,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=n;return e==null&&(e=n.inclusive),i==null&&(i=n.inclusive),{start:e??t,end:i??t}}function yr(n,t){return n==t||!!(n&&t&&n.compare(t))}function ei(n,t,e,i=0){let s=e.length-1;s>=0&&e[s]+i>=n?e[s]=Math.max(e[s],t):e.push(n,t)}class j extends T{constructor(){super(...arguments);this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,r,o){if(i){if(!(i instanceof j))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),fs(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new j;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){!this.dom||(t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){_e(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){ws(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Qe(e,this.attrs||{})),i&&(this.attrs=Qe({class:i},this.attrs||{}))}domAtPos(t){return ys(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=4|2)}sync(t){var e;this.dom?this.dirty&4&&(os(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(ti(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&T.get(i)instanceof xt;)i=i.lastChild;if(!i||i.nodeName!="BR"&&((e=T.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!y.ios||!this.children.some(s=>s instanceof St))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof St))return null;let i=Lt(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return bs(this,t,e)}become(t){return!1}get type(){return A.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let r=t.children[i],o=s+r.length;if(o>=e){if(r instanceof j)return r;if(o>e)break}s=o+r.breakAfter}return null}}class At extends T{constructor(t,e,i){super();this.widget=t,this.length=e,this.type=i,this.breakAfter=0}merge(t,e,i,s,r,o){return i&&(!(i instanceof At)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?q.before(this.dom):q.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new At(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Ue}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):v.empty}domBoundsAround(){return null}become(t){return t instanceof At&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ii{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsBelow=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof At&&t.type==A.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new j),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(be(new Nt(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(be(new St(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,r){let o=e-t;if(i instanceof kt)if(i.block){let{type:l}=i;l==A.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new At(i.widget||new xs("div"),o,l))}else{let l=ut.create(i.widget||new xs("span"),o,i.startSide),h=this.atCursorPos&&!l.isEditable&&r<=s.length&&(t<e||i.startSide>0),a=!l.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!h&&(this.pendingBuffer=0),this.flushBuffer(s),h&&(f.append(be(new Nt(1),s),r),r=s.length+Math.max(0,r-s.length)),f.append(be(l,s),r),this.atCursorPos=a,this.pendingBuffer=a?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}filterPoint(t,e,i,s){if(s>=this.disallowBlockEffectsBelow||!(i instanceof kt))return!0;if(i.block)throw new RangeError("Block decorations may not be specified via plugins");return e<=this.doc.lineAt(this.pos).to}static build(t,e,i,s,r){let o=new ii(t,e,i,r);return o.openEnd=P.spans(s,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function be(n,t){for(let e of t)n=new xt(e,[n],n.length);return n}class xs extends vt{constructor(t){super();this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const wr=[],vs=S.define(),ks=S.define(),As=S.define(),Cs=S.define(),si=S.define(),Ms=S.define(),ni=E.define({map:(n,t)=>n.map(t)}),Ds=E.define({map:(n,t)=>n.map(t)});class Vt{constructor(t,e="nearest",i="nearest",s=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=r}map(t){return t.empty?this:new Vt(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const Os=E.define({map:(n,t)=>n.map(t)});function dt(n,t,e){let i=n.facet(Cs);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const Xt=S.define({combine:n=>n.length?n[0]:!0});class br{constructor(t,e){this.field=t,this.get=e}}class ${from(t){return new br(this,t)}static define(){return new $}}$.decorations=$.define(),$.atomicRanges=$.define(),$.scrollMargins=$.define();let Sr=0;const Zt=S.define();class it{constructor(t,e,i){this.id=t,this.create=e,this.fields=i,this.extension=Zt.of(this)}static define(t,e){let{eventHandlers:i,provide:s,decorations:r}=e||{},o=[];if(s)for(let l of Array.isArray(s)?s:[s])o.push(l);return i&&o.push(Ts.from(l=>({plugin:l,handlers:i}))),r&&o.push($.decorations.from(r)),new it(Sr++,t,o)}static fromClass(t,e){return it.define(i=>new t(i),e)}}const Ts=$.define();class ri{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}takeField(t,e){if(this.spec)for(let{field:i,get:s}of this.spec.fields)i==t&&e.push(s(this.value))}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(dt(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(s){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){dt(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if((e=this.value)===null||e===void 0?void 0:e.destroy)try{this.value.destroy()}catch(i){dt(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Rs=S.define(),Bs=S.define(),Ct=S.define(),Qt=S.define();class st{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new st(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let s=0,r=0,o=0,l=0;;s++){let h=s==t.length?null:t[s],a=o-l,f=h?h.fromB:1e9;for(;r<e.length&&e[r]<f;){let c=e[r],d=e[r+1],u=Math.max(l,c),g=Math.min(f,d);if(u<=g&&new st(u+a,g+a,u,g).addToSet(i),d>f)break;r+=2}if(!h)return i;new st(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}}class Es{constructor(t,e,i=wr){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=V.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let s=[];this.changes.iterChangedRanges((o,l,h,a)=>s.push(new st(o,l,h,a))),this.changedRanges=s;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&(8|2))>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var F=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(F||(F={}));const oi=F.LTR,xr=F.RTL;function Ps(n){let t=[];for(let e=0;e<n.length;e++)t.push(1<<+n[e]);return t}const vr=Ps("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),kr=Ps("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),li=Object.create(null),_=[];for(let n of["()","[]","{}"]){let t=n.charCodeAt(0),e=n.charCodeAt(1);li[t]=e,li[e]=-t}function Ar(n){return n<=247?vr[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?kr[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203||n==8204?256:1}const Cr=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Ht{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?xr:oi}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(s!=0?s<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}}const D=[];function Mr(n,t){let e=n.length,i=t==oi?1:2,s=t==oi?2:1;if(!n||i==1&&!Cr.test(n))return Ls(e);for(let o=0,l=i,h=i;o<e;o++){let a=Ar(n.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),D[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=D[o];if(a==128)o<e-1&&l==D[o+1]&&l&24?a=D[o]=l:D[o]=256;else if(a==64){let f=o+1;for(;f<e&&D[f]==64;)f++;let c=o&&l==8||f<e&&D[f]==8?h==1?1:8:256;for(let d=o;d<f;d++)D[d]=c;o=f-1}else a==8&&h==1&&(D[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,f,c;o<e;o++)if(f=li[a=n.charCodeAt(o)])if(f<0){for(let d=l-3;d>=0;d-=3)if(_[d+1]==-f){let u=_[d+2],g=u&2?i:u&4?u&1?s:i:0;g&&(D[o]=D[_[d]]=g),l=d;break}}else{if(_.length==189)break;_[l++]=o,_[l++]=a,_[l++]=h}else if((c=D[o])==2||c==1){let d=c==i;h=d?0:1;for(let u=l-3;u>=0;u-=3){let g=_[u+2];if(g&2)break;if(d)_[u+2]|=2;else{if(g&4)break;_[u+2]|=4}}}for(let o=0;o<e;o++)if(D[o]==256){let l=o+1;for(;l<e&&D[l]==256;)l++;let h=(o?D[o-1]:i)==1,a=(l<e?D[l]:i)==1,f=h==a?h?1:2:i;for(let c=o;c<l;c++)D[c]=f;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=D[o++]!=1;for(;o<e&&h==(D[o]!=1);)o++;if(h)for(let a=o;a>l;){let f=a,c=D[--a]!=2;for(;a>l&&c==(D[a-1]!=2);)a--;r.push(new Ht(a,f,c?2:1))}else r.push(new Ht(l,o,0))}else for(let o=0;o<e;){let l=o,h=D[o++]==2;for(;o<e&&h==(D[o]==2);)o++;r.push(new Ht(l,o,h?1:2))}return r}function Ls(n){return[new Ht(0,n,0)]}let Is="";function Dr(n,t,e,i,s){var r;let o=i.head-n.from,l=-1;if(o==0){if(!s||!n.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==n.length){if(s)return null;let d=t[t.length-1];d.level!=e&&(o=d.side(!0,e),l=t.length-1)}l<0&&(l=Ht.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(s,e)&&(h=t[l+=s?1:-1],o=h.side(!s,e));let a=s==(h.dir==e),f=X(n.text,o,a);if(Is=n.text.slice(Math.min(o,f),Math.max(o,f)),f!=h.side(s,e))return w.cursor(f+n.from,a?-1:1,h.level);let c=l==(s?t.length-1:0)?null:t[l+(s?1:-1)];return!c&&h.level!=e?w.cursor(s?n.to:n.from,s?-1:1,e):c&&c.level<h.level?w.cursor(c.side(!s,e)+n.from,s?1:-1,c.level):w.cursor(f+n.from,s?-1:1,h.level)}class Ns{constructor(t,e){this.points=t,this.view=e,this.text="",this.lineBreak=e.state.lineBreak}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let r=s.nextSibling;if(r==e)break;let o=T.get(s),l=T.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:Vs(s))||Vs(r)&&(s.nodeName!="BR"||s.cmIgnore))&&(this.text+=this.lineBreak),s=r}return this.findPointBefore(i,e),this}readTextNode(t){var e,i;let s=t.nodeValue;return/^\u200b/.test(s)&&((e=t.previousSibling)===null||e===void 0?void 0:e.contentEditable)=="false"&&(s=s.slice(1)),/\u200b$/.test(s)&&((i=t.nextSibling)===null||i===void 0?void 0:i.contentEditable)=="false"&&(s=s.slice(0,s.length-1)),s}readNode(t){if(t.cmIgnore)return;let e=T.get(t),i=e&&e.overrideDOMText,s;i!=null?s=i.sliceString(0,void 0,this.lineBreak):t.nodeType==3?s=this.readTextNode(t):t.nodeName=="BR"?s=t.nextSibling?this.lineBreak:"":t.nodeType==1&&this.readRange(t.firstChild,null),s!=null&&(this.findPointIn(t,s.length),this.text+=s,y.chrome&&this.view.inputState.lastKeyCode==13&&!t.nextSibling&&/\n\n$/.test(this.text)&&(this.text=this.text.slice(0,-1)))}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointIn(t,e){for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e))}}function Vs(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class Hs{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Fs extends T{constructor(t){super();this.view=t,this.compositionDeco=M.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new j],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new st(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=M.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=Tr(this.view,t.changes)),(y.ie||y.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,s=this.updateDeco(),r=Pr(i,s,t.changes);return e=st.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let r=y.chrome||y.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof At&&r.widget instanceof Ws&&s.push(r.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let s=t.length-1;;s--){let r=s>=0?t[s]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:f,breakAtStart:c,openStart:d,openEnd:u}=ii.build(this.view.state.doc,h,a,this.decorations,this.pluginDecorationLength),{i:g,off:p}=i.findPos(l,1),{i:m,off:b}=i.findPos(o,-1);as(this,m,b,g,p,f,c,d,u)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||y.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,r=this.domAtPos(s.anchor),o=s.empty?r:this.domAtPos(s.head);if(y.gecko&&s.empty&&Or(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new q(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!ge(r.node,r.offset,l.anchorNode,l.anchorOffset)||!ge(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{y.android&&y.chrome&&this.dom.contains(l.focusNode)&&Lr(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=de(this.root);if(s.empty){if(y.gecko){let a=Br(r.node,r.offset);if(a&&a!=(1|2)){let f=qs(r.node,r.offset,a==1?1:-1);f&&(r=new q(f,a==1?0:f.nodeValue.length))}}h.collapse(r.node,r.offset),s.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=s.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();s.anchor>s.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new q(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new q(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=de(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=j.find(this,t.head);if(!i)return;let s=i.posAtStart;if(t.head==s||t.head==s+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Xt)?this.root.activeElement==this.dom:je(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=T.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let s=this.children[e];if(i<s.length||s instanceof j)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let r=this.children[s],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=A.WidgetBefore&&r.type!=A.WidgetAfter&&(!s||e==2||this.children[s-1].breakAfter||this.children[s-1].type==A.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(){let t=[],{from:e,to:i}=this.view.viewState.viewport,s=this.view.contentDOM.clientWidth,r=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1;for(let l=0,h=0;h<this.children.length;h++){let a=this.children[h],f=l+a.length;if(f>i)break;if(l>=e){let c=a.dom.getBoundingClientRect();if(t.push(c.height),r){let d=a.dom.lastChild,u=d?Lt(d):[];if(u.length){let g=u[u.length-1],p=this.view.textDirection==F.LTR?g.right-c.left:c.right-g.left;p>o&&(o=p,this.minWidth=s,this.minWidthFrom=l,this.minWidthTo=f)}}}l=f+a.breakAfter}return t}measureTextSize(){for(let s of this.children)if(s instanceof j){let r=s.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let s=Lt(t.firstChild)[0];e=t.getBoundingClientRect().height,i=s?s.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new hs(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let r=s==e.viewports.length?null:e.viewports[s],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(M.replace({widget:new Ws(l),block:!0,inclusive:!0}).range(i,o))}if(!r)break;i=r.to+1}return M.set(t)}updateDeco(){let t=this.view.pluginField($.decorations);return this.pluginDecorationLength=t.length,this.decorations=[...t,...this.view.state.facet(Ct),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),s;if(!i)return;!e.empty&&(s=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,s.left),top:Math.min(i.top,s.top),right:Math.max(i.right,s.right),bottom:Math.max(i.bottom,s.bottom)});let r=0,o=0,l=0,h=0;for(let f of this.view.pluginField($.scrollMargins))if(f){let{left:c,right:d,top:u,bottom:g}=f;c!=null&&(r=Math.max(r,c)),d!=null&&(o=Math.max(o,d)),u!=null&&(l=Math.max(l,u)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};ur(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==F.LTR)}}function Or(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class Ws extends vt{constructor(t){super();this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function zs(n){let t=n.observer.selectionRange,e=t.focusNode&&qs(t.focusNode,t.focusOffset,0);if(!e)return null;let i=n.docView.nearest(e);if(!i)return null;if(i instanceof j){let s=e;for(;s.parentNode!=i.dom;)s=s.parentNode;let r=s.previousSibling;for(;r&&!T.get(r);)r=r.previousSibling;let o=r?T.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:s,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof j)break;i=r}let s=i.posAtStart;return{from:s,to:s+i.length,node:i.dom,text:e}}}function Tr(n,t){let e=zs(n);if(!e)return M.none;let{from:i,to:s,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(s,-1)),{state:a}=n,f=r.nodeType==3?r.nodeValue:new Ns([],n).readRange(r.firstChild,null).text;if(h-l<f.length)if(a.sliceDoc(l,Math.min(a.doc.length,l+f.length))==f)h=l+f.length;else if(a.sliceDoc(Math.max(0,h-f.length),h)==f)l=h-f.length;else return M.none;else if(a.sliceDoc(l,h)!=f)return M.none;return M.set(M.replace({widget:new Rr(r,o)}).range(l,h))}class Rr extends vt{constructor(t,e){super();this.top=t,this.text=e}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return mr}}function qs(n,t,e){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&t>0&&e<=0)n=n.childNodes[t-1],t=pe(n);else if(n.nodeType==1&&t<n.childNodes.length&&e>=0)n=n.childNodes[t],t=0;else return null}}function Br(n,t){return n.nodeType!=1?0:(t&&n.childNodes[t-1].contentEditable=="false"?1:0)|(t<n.childNodes.length&&n.childNodes[t].contentEditable=="false"?2:0)}class Er{constructor(){this.changes=[]}compareRange(t,e){ei(t,e,this.changes)}comparePoint(t,e){ei(t,e,this.changes)}}function Pr(n,t,e){let i=new Er;return P.compare(n,t,e,i),i.changes}function Lr(n,t){for(let e=n;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function Ir(n,t,e=1){let i=n.charCategorizer(t),s=n.doc.lineAt(t),r=t-s.from;if(s.length==0)return w.cursor(t);r==0?e=1:r==s.length&&(e=-1);let o=r,l=r;e<0?o=X(s.text,r,!1):l=X(s.text,r);let h=i(s.text.slice(o,l));for(;o>0;){let a=X(s.text,o,!1);if(i(s.text.slice(a,o))!=h)break;o=a}for(;l<s.length;){let a=X(s.text,l);if(i(s.text.slice(l,a))!=h)break;l=a}return w.range(o+s.from,l+s.from)}function Nr(n,t){return t.left>n?t.left-n:Math.max(0,n-t.right)}function Vr(n,t){return t.top>n?t.top-n:Math.max(0,n-t.bottom)}function hi(n,t){return n.top<t.bottom-1&&n.bottom>t.top+1}function Ks(n,t){return t<n.top?{top:t,left:n.left,right:n.right,bottom:n.bottom}:n}function js(n,t){return t>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:t}:n}function ai(n,t,e){let i,s,r,o,l,h,a,f;for(let u=n.firstChild;u;u=u.nextSibling){let g=Lt(u);for(let p=0;p<g.length;p++){let m=g[p];s&&hi(s,m)&&(m=Ks(js(m,s.bottom),s.top));let b=Nr(t,m),L=Vr(e,m);if(b==0&&L==0)return u.nodeType==3?$s(u,t,e):ai(u,t,e);(!i||o>L||o==L&&r>b)&&(i=u,s=m,r=b,o=L),b==0?e>m.bottom&&(!a||a.bottom<m.bottom)?(l=u,a=m):e<m.top&&(!f||f.top>m.top)&&(h=u,f=m):a&&hi(a,m)?a=js(a,m.bottom):f&&hi(f,m)&&(f=Ks(f,m.top))}}if(a&&a.bottom>=e?(i=l,s=a):f&&f.top<=e&&(i=h,s=f),!i)return{node:n,offset:0};let c=Math.max(s.left,Math.min(s.right,t));if(i.nodeType==3)return $s(i,c,e);if(!r&&i.contentEditable=="true")return ai(i,c,e);let d=Array.prototype.indexOf.call(n.childNodes,i)+(t>=(s.left+s.right)/2?1:0);return{node:n,offset:d}}function $s(n,t,e){let i=n.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=Gt(n,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let f=h[a];if(f.top==f.bottom)continue;o||(o=t-f.left);let c=(f.top>e?f.top-e:e-f.bottom)-1;if(f.left-1<=t&&f.right+1>=t&&c<r){let d=t>=(f.left+f.right)/2,u=d;if((y.chrome||y.gecko)&&Gt(n,l).getBoundingClientRect().left==f.right&&(u=!d),c<=0)return{node:n,offset:l+(u?1:0)};s=l+(u?1:0),r=c}}}return{node:n,offset:s>-1?s:o>0?n.nodeValue.length:0}}function Us(n,{x:t,y:e},i,s=-1){var r;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,h,{docHeight:a}=n.viewState,f=e-l;if(f<0)return 0;if(f>a)return n.state.doc.length;for(let b=n.defaultLineHeight/2,L=!1;h=n.elementAtHeight(f),h.type!=A.Text;)for(;f=s>0?h.bottom+b:h.top-b,!(f>=0&&f<=a);){if(L)return i?null:0;L=!0,s=-s}e=l+f;let c=h.from;if(c<n.viewport.from)return n.viewport.from==0?0:i?null:Gs(n,o,h,t,e);if(c>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:i?null:Gs(n,o,h,t,e);let d=n.dom.ownerDocument,u=n.root.elementFromPoint?n.root:d,g=u.elementFromPoint(t,e);g&&!n.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=u.elementFromPoint(t,e),g&&!n.contentDOM.contains(g)&&(g=null));let p,m=-1;if(g&&((r=n.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(d.caretPositionFromPoint){let b=d.caretPositionFromPoint(t,e);b&&({offsetNode:p,offset:m}=b)}else if(d.caretRangeFromPoint){let b=d.caretRangeFromPoint(t,e);b&&({startContainer:p,startOffset:m}=b,y.safari&&Hr(p,m,t)&&(p=void 0))}}if(!p||!n.docView.dom.contains(p)){let b=j.find(n.docView,c);if(!b)return f>h.top+h.height/2?h.to:h.from;({node:p,offset:m}=ai(b.dom,t,e))}return n.docView.posFromDOM(p,m)}function Gs(n,t,e,i,s){let r=Math.round((i-t.left)*n.defaultCharacterWidth);n.lineWrapping&&e.height>n.defaultLineHeight*1.5&&(r+=Math.floor((s-e.top)/n.defaultLineHeight)*n.viewState.heightOracle.lineLength);let o=n.state.sliceDoc(e.from,e.to);return e.from+Bi(o,r,n.state.tabSize)}function Hr(n,t,e){let i;if(n.nodeType!=3||t!=(i=n.nodeValue.length))return!1;for(let s=n.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return Gt(n,i-1,i).getBoundingClientRect().left>e}function Fr(n,t,e,i){let s=n.state.doc.lineAt(t.head),r=!i||!n.lineWrapping?null:n.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head);if(r){let h=n.dom.getBoundingClientRect(),a=n.posAtCoords({x:e==(n.textDirection==F.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(a!=null)return w.cursor(a,e?-1:1)}let o=j.find(n.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?s.to:s.from;return w.cursor(l,e?-1:1)}function Js(n,t,e,i){let s=n.state.doc.lineAt(t.head),r=n.bidiSpans(s);for(let o=t,l=null;;){let h=Dr(s,r,n.textDirection,o,e),a=Is;if(!h){if(s.number==(e?n.state.doc.lines:1))return o;a=`
`,s=n.state.doc.line(s.number+(e?1:-1)),r=n.bidiSpans(s),h=w.cursor(e?s.from:s.to)}if(l){if(!l(a))return o}else{if(!i)return h;l=i(a)}o=h}}function Wr(n,t,e){let i=n.state.charCategorizer(t),s=i(e);return r=>{let o=i(r);return s==Q.Space&&(s=o),s==o}}function zr(n,t,e,i){let s=t.head,r=e?1:-1;if(s==(e?n.state.doc.length:0))return w.cursor(s,t.assoc);let o=t.goalColumn,l,h=n.contentDOM.getBoundingClientRect(),a=n.coordsAtPos(s),f=n.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let u=n.viewState.lineBlockAt(s-f);o==null&&(o=Math.min(h.right-h.left,n.defaultCharacterWidth*(s-u.from))),l=(r<0?u.top:u.bottom)+f}let c=h.left+o,d=i??n.defaultLineHeight>>1;for(let u=0;;u+=10){let g=l+(d+u)*r,p=Us(n,{x:c,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?p<s:p>s))return w.cursor(p,t.assoc,void 0,o)}}function fi(n,t,e){let i=n.pluginField($.atomicRanges);for(;;){let s=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?w.cursor(o,1):w.cursor(l,-1),s=!0)});if(!s)return e}}class qr{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in N){let i=N[e];t.contentDOM.addEventListener(e,s=>{e=="keydown"&&this.keydown(t,s)||!Zs(t,s)||this.ignoreDuringComposition(s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s))}),this.registeredEvents.push(e)}this.notifiedFocused=t.hasFocus,this.ensureHandlers(t),y.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t){let e=this.customHandlers=t.pluginField(Ts);for(let i of e)for(let s in i.handlers)this.registeredEvents.indexOf(s)<0&&s!="scroll"&&(this.registeredEvents.push(s),t.contentDOM.addEventListener(s,r=>{!Zs(t,r)||this.runCustomHandlers(s,t,r)&&r.preventDefault()}))}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let r=s.handlers[t];if(r)try{if(r.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(o){dt(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(r){dt(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(t,e))return!0;if(y.android&&y.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return y.ios&&(i=Ys.find(s=>s.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Jt(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:y.safari&&Date.now()-this.compositionEndedAt<500?(this.compositionEndedAt=0,!0):!1:!1}screenKeyEvent(t,e){let i=e.keyCode==9&&Date.now()<this.lastEscPress+2e3;return e.keyCode==27?this.lastEscPress=Date.now():Xs.indexOf(e.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!y.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Ys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Xs=[16,17,18,20,91,92,224,225];class Kr{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(k.allowMultipleSelections)&&jr(t,e),this.dragMove=$r(t,e),this.dragging=Ur(t,e)&&ci(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function jr(n,t){let e=n.state.facet(vs);return e.length?e[0](t):y.mac?t.metaKey:t.ctrlKey}function $r(n,t){let e=n.state.facet(ks);return e.length?e[0](t):y.mac?!t.altKey:!t.ctrlKey}function Ur(n,t){let{main:e}=n.state.selection;if(e.empty)return!1;let i=de(n.root);if(i.rangeCount==0)return!0;let s=i.getRangeAt(0).getClientRects();for(let r=0;r<s.length;r++){let o=s[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function Zs(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=n.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=T.get(e))&&i.ignoreEvent(t))return!1;return!0}const N=Object.create(null),Qs=y.ie&&y.ie_version<15||y.ios&&y.webkit_version<604;function Gr(n){let t=n.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{n.focus(),e.remove(),_s(n,e.value)},50)}function _s(n,t){let{state:e}=n,i,s=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(ui!=null&&e.selection.ranges.every(h=>h.empty)&&ui==r.toString()){let h=-1;i=e.changeByRange(a=>{let f=e.doc.lineAt(a.from);if(f.from==h)return{range:a};h=f.from;let c=e.toText((o?r.line(s++).text:t)+e.lineBreak);return{changes:{from:f.from,insert:c},range:w.cursor(a.from+c.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(s++);return{changes:{from:h.from,to:h.to,insert:a.text},range:w.cursor(h.from+a.length)}}):i=e.replaceSelection(r);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}N.keydown=(n,t)=>{n.inputState.setSelectionOrigin("select")};let tn=0;N.touchstart=(n,t)=>{tn=Date.now(),n.inputState.setSelectionOrigin("select.pointer")},N.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")},N.mousedown=(n,t)=>{if(n.observer.flush(),tn>Date.now()-2e3&&ci(t)==1)return;let e=null;for(let i of n.state.facet(As))if(e=i(n,t),e)break;if(!e&&t.button==0&&(e=Xr(n,t)),e){let i=n.root.activeElement!=n.contentDOM;i&&n.observer.ignore(()=>ns(n.contentDOM)),n.inputState.startMouseSelection(new Kr(n,t,e,i))}};function en(n,t,e,i){if(i==1)return w.cursor(t,e);if(i==2)return Ir(n.state,t,e);{let s=j.find(n.docView,t),r=n.state.doc.lineAt(s?s.posAtEnd:t),o=s?s.posAtStart:r.from,l=s?s.posAtEnd:r.to;return l<n.state.doc.length&&l==r.to&&l++,w.range(o,l)}}let sn=(n,t)=>n>=t.top&&n<=t.bottom,nn=(n,t,e)=>sn(t,e)&&n>=e.left&&n<=e.right;function Jr(n,t,e,i){let s=j.find(n.docView,t);if(!s)return 1;let r=t-s.posAtStart;if(r==0)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&nn(e,i,o))return-1;let l=s.coordsAt(r,1);return l&&nn(e,i,l)?1:o&&sn(i,o)?-1:1}function rn(n,t){let e=n.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:Jr(n,e,t.clientX,t.clientY)}}const Yr=y.ie&&y.ie_version<=11;let on=null,ln=0,hn=0;function ci(n){if(!Yr)return n.detail;let t=on,e=hn;return on=n,hn=Date.now(),ln=!t||e>Date.now()-400&&Math.abs(t.clientX-n.clientX)<2&&Math.abs(t.clientY-n.clientY)<2?(ln+1)%3:1}function Xr(n,t){let e=rn(n,t),i=ci(t),s=n.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),s=s.map(l.changes),o=null)},get(l,h,a){let f;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?f=r:(f=r=rn(n,l),o=l),!f||!e)return s;let c=en(n,f.pos,f.bias,i);if(e.pos!=f.pos&&!h){let d=en(n,e.pos,e.bias,i),u=Math.min(d.from,c.from),g=Math.max(d.to,c.to);c=u<c.from?w.range(u,g):w.range(g,u)}return h?s.replaceRange(s.main.extend(c.from,c.to)):a?s.addRange(c):w.create([c])}}}N.dragstart=(n,t)=>{let{selection:{main:e}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",n.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function an(n,t,e,i){if(!e)return;let s=n.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=n.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:s,insert:e},h=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:h,selection:{anchor:h.mapPos(s,-1),head:h.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}N.drop=(n,t)=>{if(!t.dataTransfer)return;if(n.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),s=0,r=()=>{++s==e.length&&an(n,t,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else an(n,t,t.dataTransfer.getData("Text"),!0)},N.paste=(n,t)=>{if(n.state.readOnly)return t.preventDefault();n.observer.flush();let e=Qs?null:t.clipboardData;e?(_s(n,e.getData("text/plain")),t.preventDefault()):Gr(n)};function Zr(n,t){let e=n.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function Qr(n){let t=[],e=[],i=!1;for(let s of n.selection.ranges)s.empty||(t.push(n.sliceDoc(s.from,s.to)),e.push(s));if(!t.length){let s=-1;for(let{from:r}of n.selection.ranges){let o=n.doc.lineAt(r);o.number>s&&(t.push(o.text),e.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),s=o.number}i=!0}return{text:t.join(n.lineBreak),ranges:e,linewise:i}}let ui=null;N.copy=N.cut=(n,t)=>{let{text:e,ranges:i,linewise:s}=Qr(n.state);if(!e&&!s)return;ui=s?e:null;let r=Qs?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):Zr(n,e),t.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})},N.focus=N.blur=n=>{setTimeout(()=>{n.hasFocus!=n.inputState.notifiedFocused&&n.update([])},10)},N.beforeprint=n=>{n.viewState.printing=!0,n.requestMeasure(),setTimeout(()=>{n.viewState.printing=!1,n.requestMeasure()},2e3)};function fn(n,t){if(n.docView.compositionDeco.size){n.inputState.rapidCompositionStart=t;try{n.update([])}finally{n.inputState.rapidCompositionStart=!1}}}N.compositionstart=N.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0,n.docView.compositionDeco.size&&(n.observer.flush(),fn(n,!0)))},N.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionFirstChange=null,setTimeout(()=>{n.inputState.composing<0&&fn(n,!1)},50)},N.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()},N.beforeinput=(n,t)=>{var e;let i;if(y.chrome&&y.android&&(i=Ys.find(s=>s.inputType==t.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let s=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>s+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const cn=["pre-wrap","normal","pre-line","break-spaces"];class _r{constructor(){this.doc=v.empty,this.lineWrapping=!1,this.direction=F.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForStyle(t,e){return cn.indexOf(t)>-1!=this.lineWrapping||this.direction!=e}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(s*10)]||(e=!0,this.heightSamples[Math.floor(s*10)]=!0)}return e}refresh(t,e,i,s,r,o){let l=cn.indexOf(t)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=l||this.direction!=e;if(this.lineWrapping=l,this.direction=e,this.lineHeight=i,this.charWidth=s,this.lineLength=r,h){this.heightSamples={};for(let a=0;a<o.length;a++){let f=o[a];f<0?a++:this.heightSamples[Math.floor(f*10)]=!0}}return h}}class to{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class nt{constructor(t,e,i,s,r){this.from=t,this.length=e,this.top=i,this.height=s,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new nt(this.from,this.length+t.length,this.top,this.height+t.height,e)}moveY(t){return t?new nt(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map(e=>e.moveY(t)):this.type):this}}var C=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(C||(C={}));const Se=.001;class U{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&~2}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>Se&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return U.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let r=this;for(let o=s.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:f}=s[o],c=r.lineAt(l,C.ByPosNoHeight,e,0,0),d=c.to>=h?c:r.lineAt(h,C.ByPosNoHeight,e,0,0);for(f+=d.to-h,h=d.to;o>0&&c.from<=s[o-1].toA;)l=s[o-1].fromA,a=s[o-1].fromB,o--,l<c.from&&(c=r.lineAt(l,C.ByPosNoHeight,e,0,0));a+=c.from-l,l=c.from;let u=di.build(i,t,a,f);r=r.replace(l,h,u)}return r.updateHeight(i,0)}static empty(){return new Y(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,s=0,r=0;for(;;)if(e==i)if(s>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,s-=l.size}else if(r>s*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(s<r){let l=t[e++];l&&(s+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new eo(U.of(t.slice(0,e)),o,U.of(t.slice(i)))}}U.prototype.size=1;class un extends U{constructor(t,e,i){super(t,e);this.type=i}blockAt(t,e,i,s){return new nt(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,r){return this.blockAt(0,i,s,r)}forEachLine(t,e,i,s,r,o){o(this.blockAt(0,i,s,r))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Y extends un{constructor(t,e){super(t,e,A.Text);this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return i.length==1&&(s instanceof Y||s instanceof W&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof W?s=new Y(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):U.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class W extends U{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,s),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:f}=e.line(r+h);return new nt(a,f,i+l*h,l,A.Text)}lineAt(t,e,i,s,r){if(e==C.ByHeight)return this.blockAt(t,i,s,r);if(e==C.ByPosNoHeight){let{from:c,to:d}=i.lineAt(t);return new nt(c,d-c,0,0,A.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:f}=i.lineAt(t);return new nt(h,a,s+l*(f-o),l,A.Text)}forEachLine(t,e,i,s,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),f=Math.min(r+this.length,e);a<=f;){let c=i.lineAt(a);a==t&&(s+=h*(c.number-l)),o(new nt(c.from,c.length,s,h,A.Text)),s+=h,a=c.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let r=i[i.length-1];r instanceof W?i[i.length-1]=new W(r.length+s):i.push(null,new W(s-1))}if(t>0){let r=i[0];r instanceof W?i[0]=new W(t+r.length):i.unshift(new W(t-1),null)}return U.of(i)}decomposeLeft(t,e){e.push(new W(t-1),null)}decomposeRight(t,e){e.push(null,new W(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let r=e+this.length;if(s&&s.from<=e+this.length&&s.more){let o=[],l=Math.max(e,s.from),h=-1,a=t.heightChanged;for(s.from>e&&o.push(new W(s.from-e-1).updateHeight(t,e));l<=r&&s.more;){let c=t.doc.lineAt(l).length;o.length&&o.push(null);let d=s.heights[s.index++];h==-1?h=d:Math.abs(d-h)>=Se&&(h=-2);let u=new Y(c,d);u.outdated=!1,o.push(u),l+=c+1}l<=r&&o.push(null,new W(r-l).updateHeight(t,l));let f=U.of(o);return t.heightChanged=a||h<0||Math.abs(f.height-this.height)>=Se||Math.abs(h-this.lines(t.doc,e).lineHeight)>=Se,f}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class eo extends U{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0));this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,s){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,r,s+this.left.length+this.break)}lineAt(t,e,i,s,r){let o=s+this.left.height,l=r+this.left.length+this.break,h=e==C.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,s,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let f=e==C.ByPosNoHeight?C.ByPosNoHeight:C.ByPos;return h?a.join(this.right.lineAt(l,f,i,o,l)):this.left.lineAt(l,f,i,s,r).join(a)}forEachLine(t,e,i,s,r,o){let l=s+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,s,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,C.ByPos,i,s,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,s,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&dn(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),dn(r,l)}return U.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?U.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return s&&s.from<=e+r.length&&s.more?h=r=r.updateHeight(t,e,i,s):r.updateHeight(t,e,i),s&&s.from<=l+o.length&&s.more?h=o=o.updateHeight(t,l,i,s):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function dn(n,t){let e,i;n[t]==null&&(e=n[t-1])instanceof W&&(i=n[t+1])instanceof W&&n.splice(t-1,3,new W(e.length+1+i.length))}const io=5;class di{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof Y?s.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Y(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new un(r,s,i.type)):(r||s>=io)&&this.addLineDeco(s,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Y(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new W(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Y)return t;let e=new Y(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==A.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=A.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Y)&&!this.isCovered?this.nodes.push(new Y(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let s of this.nodes)s instanceof Y&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(t,e,i,s){let r=new di(i,t);return P.spans(e,i,s,r,0),r.finish(i)}}function so(n,t,e){let i=new no;return P.compare(n,t,e,i,0),i.changes}class no{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&ei(t,e,this.changes,5)}}function ro(n,t){let e=n.getBoundingClientRect(),i=Math.max(0,e.left),s=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=n.ownerDocument.body;for(let h=n.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,f=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&f.overflow!="visible"){let c=a.getBoundingClientRect();i=Math.max(i,c.left),s=Math.min(s,c.right),r=Math.max(r,c.top),o=Math.min(o,c.bottom)}h=f.position=="absolute"||f.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,s)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}class gi{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],r=e[i];if(s.from!=r.from||s.to!=r.to||s.size!=r.size)return!1}return!0}draw(t){return M.replace({widget:new oo(this.size,t)}).range(this.from,this.to)}}class oo extends vt{constructor(t,e){super();this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class gn{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new _r,this.scaler=yn,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=U.empty().applyChanges(t.facet(Ct),v.empty,this.heightOracle.setDoc(t.doc),[new st(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=M.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>s>=r&&s<=o)){let{from:r,to:o}=this.lineBlockAt(s);t.push(new xe(r,o))}}this.viewports=t.sort((i,s)=>i.from-s.from),this.scaler=this.heightMap.height<=7e6?yn:new ao(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:_t(t,this.scaler))})}update(t,e=null){let i=this.state;this.state=t.state;let s=this.state.facet(Ct),r=t.changedRanges,o=st.extendWithRanges(r,so(t.startState.facet(Ct),s,t?t.changes:V.empty(this.state.doc.length))),l=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(s,i.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=l&&(t.flags|=2);let h=o.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let a=!t.changes.empty||t.flags&2||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),a&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,r=i.whiteSpace,o=i.direction=="rtl"?F.RTL:F.LTR,l=this.heightOracle.mustRefreshForStyle(r,o),h=l||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight,a=0,f=0;if(h){this.mustMeasureContent=!1,this.contentDOMHeight=e.clientHeight;let b=parseInt(i.paddingTop)||0,L=parseInt(i.paddingBottom)||0;(this.paddingTop!=b||this.paddingBottom!=L)&&(a|=8,this.paddingTop=b,this.paddingBottom=L)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:ro(e,this.paddingTop),d=c.top-this.pixelViewport.top,u=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let g=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(g!=this.inView&&(this.inView=g,g&&(h=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight||this.editorWidth!=t.scrollDOM.clientWidth)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,this.editorWidth=t.scrollDOM.clientWidth,a|=8),h){let b=t.docView.measureVisibleLineHeights();if(s.mustRefreshForHeights(b)&&(l=!0),l||s.lineWrapping&&Math.abs(p-this.contentDOMWidth)>s.charWidth){let{lineHeight:L,charWidth:x}=t.docView.measureTextSize();l=s.refresh(r,o,L,x,p/x,b),l&&(t.docView.minWidth=0,a|=8)}d>0&&u>0?f=Math.max(d,u):d<0&&u<0&&(f=Math.min(d,u)),s.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(s,0,l,new to(this.viewport.from,b)),s.heightChanged&&(a|=2)}let m=!this.viewportIsAppropriate(this.viewport,f)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return m&&(this.viewport=this.getViewport(f,this.scrollTarget)),this.updateForViewport(),(a&2||m)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new xe(s.lineAt(o-i*1e3,C.ByHeight,r,0,0).from,s.lineAt(l+(1-i)*1e3,C.ByHeight,r,0,0).to);if(e){let{head:a}=e.range,f=this.editorHeight;if(a<h.from||a>h.to){let c=s.lineAt(a,C.ByPos,r,0,0),d;e.y=="center"?d=(c.top+c.bottom)/2-f/2:e.y=="start"||e.y=="nearest"&&a<h.from?d=c.top:d=c.bottom-f,h=new xe(s.lineAt(d-1e3/2,C.ByHeight,r,0,0).from,s.lineAt(d+f+1e3/2,C.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new xe(this.heightMap.lineAt(i,C.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,C.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,C.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,C.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||s<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&s>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new gi(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t){let e=[];if(this.heightOracle.direction!=F.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let s=lo(i.from,i.to,this.state);if(s.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=ve(s,(this.visibleTop-i.top-a)/i.height),o=ve(s,(this.visibleBottom-i.top+a)/i.height)}else{let a=s.total*this.heightOracle.charWidth,f=2e3*this.heightOracle.charWidth;r=ve(s,(this.pixelViewport.left-f)/a),o=ve(s,(this.pixelViewport.right+f)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&mn(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&mn(l,h.to-10,h.to+10);for(let{from:a,to:f}of l)f-a>1e3&&e.push(ho(t,c=>c.from>=i.from&&c.to<=i.to&&Math.abs(c.from-a)<1e3&&Math.abs(c.to-f)<1e3)||new gi(a,f,this.gapSize(i,a,f,s)))}return e}gapSize(t,e,i,s){let r=pn(s,i)-pn(s,e);return this.heightOracle.lineWrapping?t.height*r:s.total*this.heightOracle.charWidth*r}updateLineGaps(t){gi.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=M.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.state.facet(Ct);this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];P.spans(t,this.viewport.from,this.viewport.to,{span(s,r){e.push({from:s,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((s,r)=>s.from!=e[r].from||s.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||_t(this.heightMap.lineAt(t,C.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return _t(this.heightMap.lineAt(this.scaler.fromDOM(t),C.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return _t(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class xe{constructor(t,e){this.from=t,this.to=e}}function lo(n,t,e){let i=[],s=n,r=0;return P.spans(e.facet(Ct),n,t,{span(){},point(o,l){o>s&&(i.push({from:s,to:o}),r+=o-s),s=l}},20),s<t&&(i.push({from:s,to:t}),r+=t-s),{total:r,ranges:i}}function ve({total:n,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(n*e);for(let s=0;;s++){let{from:r,to:o}=t[s],l=o-r;if(i<=l)return r+i;i-=l}}function pn(n,t){let e=0;for(let{from:i,to:s}of n.ranges){if(t<=s){e+=t-i;break}e+=s-i}return e/n.total}function mn(n,t,e){for(let i=0;i<n.length;i++){let s=n[i];if(s.from<e&&s.to>t){let r=[];s.from<t&&r.push({from:s.from,to:t}),s.to>e&&r.push({from:e,to:s.to}),n.splice(i,1,...r),i+=r.length-1}}}function ho(n,t){for(let e of n)if(t(e))return e}const yn={toDOM(n){return n},fromDOM(n){return n},scale:1};class ao{constructor(t,e,i){let s=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,C.ByPos,t,0,0).top,f=e.lineAt(h,C.ByPos,t,0,0).bottom;return s+=f-a,{from:l,to:h,top:a,bottom:f,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(e.height-s);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return s+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,s=r.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-s)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,s=r.domBottom}}}function _t(n,t){if(t.scale==1)return n;let e=t.toDOM(n.top),i=t.toDOM(n.bottom);return new nt(n.from,n.length,e,i-e,Array.isArray(n.type)?n.type.map(s=>_t(s,t)):n.type)}const wn=S.define({combine:n=>n.join(" ")}),pi=S.define({combine:n=>n.indexOf(!0)>-1}),mi=bt.newName(),bn=bt.newName(),Sn=bt.newName(),xn={"&light":"."+bn,"&dark":"."+Sn};function yi(n,t,e){return new bt(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,s=>{if(s=="&")return n;if(!e||!e[s])throw new RangeError(`Unsupported selector: ${s}`);return e[s]}):n+" "+i}})}const fo=yi("."+mi,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},xn),co={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},wi=y.ie&&y.ie_version<=11;class uo{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new dr,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(s=>{for(let r of s)this.queue.push(r);(y.ie&&y.ie_version<=11||y.ios&&t.composing)&&s.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),wi&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}),this.resize.observe(t.scrollDOM)),this.start(),this.onScroll=this.onScroll.bind(this),window.addEventListener("scroll",this.onScroll),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(s=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),s.length>0&&s[s.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(s=>{s.length>0&&s[s.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(Xt)?e.root.activeElement!=this.dom:!je(e.dom,i))return;let s=i.anchorNode&&e.docView.nearest(i.anchorNode);s&&s.ignoreEvent(t)||((y.ie&&y.ie_version<=11||y.android&&y.chrome)&&!e.state.selection.main.empty&&i.focusNode&&ge(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=de(t),i=y.safari&&t.nodeType==11&&fr()==this.view.contentDOM&&go(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,co),wi&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),wi&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.observer.takeRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null;let s=this.view.state;Jt(this.view.contentDOM,i.key,i.keyCode)?this.processRecords():this.flush(),this.view.state==s&&this.view.update([])}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let r of t){let o=this.readMutation(r);!o||(o.typeOver&&(s=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:s}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:s}=this.processRecords(),r=this.selectionChanged&&je(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state;this.onChange(e,i,s),this.view.state==o&&this.view.update([])}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=vn(e,t.previousSibling||t.target.previousSibling,-1),s=vn(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function vn(n,t,e){for(;t;){let i=T.get(t);if(i&&i.parent==n)return i;let s=t.parentNode;t=s!=n.dom?s:e>0?t.nextSibling:t.previousSibling}return null}function go(n){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,s=t.startOffset,r=t.endContainer,o=t.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return ge(l.node,l.offset,r,o)&&([i,s,r,o]=[r,o,i,s]),{anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:o}}function po(n,t,e,i){let s,r,o=n.state.selection.main;if(t>-1){let l=n.docView.domBoundsAround(t,e,0);if(!l||n.state.readOnly)return;let{from:h,to:a}=l,f=n.docView.impreciseHead||n.docView.impreciseAnchor?[]:yo(n),c=new Ns(f,n);c.readRange(l.startDOM,l.endDOM),r=wo(f,h);let d=o.from,u=null;(n.inputState.lastKeyCode===8&&n.inputState.lastKeyTime>Date.now()-100||y.android&&c.text.length<a-h)&&(d=o.to,u="end");let g=mo(n.state.sliceDoc(h,a),c.text,d-h,u);g&&(s={from:h+g.from,to:h+g.toA,insert:n.state.toText(c.text.slice(g.from,g.toB))})}else if(n.hasFocus||!n.state.facet(Xt)){let l=n.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=n.docView,f=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!Ke(n.contentDOM,l.focusNode)?n.state.selection.main.head:n.docView.posFromDOM(l.focusNode,l.focusOffset),c=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!Ke(n.contentDOM,l.anchorNode)?n.state.selection.main.anchor:n.docView.posFromDOM(l.anchorNode,l.anchorOffset);(f!=o.head||c!=o.anchor)&&(r=w.single(c,f))}if(!(!s&&!r)){if(!s&&i&&!o.empty&&r&&r.main.empty?s={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:s&&s.from>=o.from&&s.to<=o.to&&(s.from!=o.from||s.to!=o.to)&&o.to-o.from-(s.to-s.from)<=4&&(s={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,s.from).append(s.insert).append(n.state.doc.slice(s.to,o.to))}),s){let l=n.state;if(y.ios&&n.inputState.flushIOSKey(n)||y.android&&(s.from==o.from&&s.to==o.to&&s.insert.length==1&&s.insert.lines==2&&Jt(n.contentDOM,"Enter",13)||s.from==o.from-1&&s.to==o.to&&s.insert.length==0&&Jt(n.contentDOM,"Backspace",8)||s.from==o.from&&s.to==o.to+1&&s.insert.length==0&&Jt(n.contentDOM,"Delete",46)))return;let h=s.insert.toString();if(n.state.facet(Ms).some(c=>c(n,s.from,s.to,h)))return;n.inputState.composing>=0&&n.inputState.composing++;let a;if(s.from>=o.from&&s.to<=o.to&&s.to-s.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&n.inputState.composing<0){let c=o.from<s.from?l.sliceDoc(o.from,s.from):"",d=o.to>s.to?l.sliceDoc(s.to,o.to):"";a=l.replaceSelection(n.state.toText(c+s.insert.sliceString(0,void 0,n.state.lineBreak)+d))}else{let c=l.changes(s),d=r&&!l.selection.main.eq(r.main)&&r.main.to<=c.newLength?r.main:void 0;if(l.selection.ranges.length>1&&n.inputState.composing>=0&&s.to<=o.to&&s.to>=o.to-10){let u=n.state.sliceDoc(s.from,s.to),g=zs(n)||n.state.doc.lineAt(o.head),p=o.to-s.to,m=o.to-o.from;a=l.changeByRange(b=>{if(b.from==o.from&&b.to==o.to)return{changes:c,range:d||b.map(c)};let L=b.to-p,x=L-u.length;if(b.to-b.from!=m||n.state.sliceDoc(x,L)!=u||g&&b.to>=g.from&&b.from<=g.to)return{range:b};let O=l.changes({from:x,to:L,insert:s.insert}),I=b.to-o.to;return{changes:O,range:d?w.range(Math.max(0,d.anchor+I),Math.max(0,d.head+I)):b.map(O)}})}else a={changes:c,selection:d&&l.selection.replaceRange(d)}}let f="input.type";n.composing&&(f+=".compose",n.inputState.compositionFirstChange&&(f+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(a,{scrollIntoView:!0,userEvent:f})}else if(r&&!r.main.eq(o)){let l=!1,h="select";n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(l=!0),h=n.inputState.lastSelectionOrigin),n.dispatch({selection:r,scrollIntoView:l,userEvent:h})}}}function mo(n,t,e,i){let s=Math.min(n.length,t.length),r=0;for(;r<s&&n.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==s&&n.length==t.length)return null;let o=n.length,l=t.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}return o<r&&n.length<t.length?(r-=e<=r&&e>=o?r-e:0,l=r+(l-o),o=r):l<r&&(r-=e<=r&&e>=l?r-e:0,o=r+(o-l),l=r),{from:r,toA:o,toB:l}}function yo(n){let t=[];if(n.root.activeElement!=n.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:r}=n.observer.selectionRange;return e&&(t.push(new Hs(e,i)),(s!=e||r!=i)&&t.push(new Hs(s,r))),t}function wo(n,t){if(n.length==0)return null;let e=n[0].pos,i=n.length==2?n[1].pos:e;return e>-1&&i>-1?w.single(e+t,i+t):null}class R{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||gr(t.parent)||document,this.viewState=new gn(t.state||k.create()),this.plugins=this.state.facet(Zt).map(e=>new ri(e));for(let e of this.plugins)e.update(this);this.observer=new uo(this,(e,i,s)=>{po(this,e,i,s)},e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new qr(this),this.docView=new Fs(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,So(),this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof z?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i,s=this.state;for(let o of t){if(o.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=o.state}if(this.destroyed){this.viewState.state=s;return}if(s.facet(k.phrases)!=this.state.facet(k.phrases))return this.setState(s);i=new Es(this,s,t);let r=this.viewState.scrollTarget;try{this.updateState=2;for(let o of t){if(r&&(r=r.map(o.changes)),o.scrollIntoView){let{main:l}=o.state.selection;r=new Vt(l.empty?l:w.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of o.effects)l.is(ni)?r=new Vt(l.value):l.is(Ds)?r=new Vt(l.value,"center"):l.is(Os)&&(r=l.value)}this.viewState.update(i,r),this.bidiCache=ke.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),e=this.docView.update(i),this.state.facet(Qt)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(o=>o.isUserEvent("select.pointer")))}finally{this.updateState=0}if((e||r||this.viewState.mustEnforceCursorAssoc)&&this.requestMeasure(),!i.empty)for(let o of this.state.facet(si))o(i)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new gn(t),this.plugins=t.facet(Zt).map(i=>new ri(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new Fs(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Zt),i=t.state.facet(Zt);if(e!=i){let s=[];for(let r of i){let o=e.indexOf(r);if(o<0)s.push(new ri(r));else{let l=this.plugins[o];l.mustUpdate=t,s.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let s of this.plugins)s.mustUpdate=t;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let s=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(c=>{try{return c.read(this)}catch(d){return dt(this.state,d),kn}}),h=new Es(this,this.state),a=!1,f=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let c=0;c<o.length;c++)if(l[c]!=kn)try{let d=o[c];d.write&&d.write(l[c],this)}catch(d){dt(this.state,d)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,f=!0),a&&this.docView.updateSelection(!0),this.viewport.from==s.from&&this.viewport.to==s.to&&!f&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(si))i(e)}get themeClasses(){return mi+" "+(this.state.facet(pi)?Sn:bn)+" "+this.state.facet(wn)}updateAttrs(){let t=An(this,Rs,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Xt)?"true":"false",class:"cm-content",style:`${y.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),An(this,Bs,e),this.observer.ignore(()=>{ti(this.contentDOM,this.contentAttrs,e),ti(this.dom,this.editorAttrs,t)}),this.editorAttrs=t,this.contentAttrs=e}showAnnouncements(t){let e=!0;for(let i of t)for(let s of i.effects)if(s.is(R.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Qt),bt.mount(this.root,this.styleModules.concat(fo).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}pluginField(t){let e=[];for(let i of this.plugins)i.update(this).takeField(t,e);return e}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(t,e){let i=bi(e,this);return this.elementAtHeight(t-i).moveY(i)}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}visualLineAtHeight(t,e){let i=bi(e,this);return this.lineBlockAtHeight(t-i).moveY(i)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}viewportLines(t,e){let i=bi(e,this);for(let s of this.viewportLineBlocks)t(s.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(t,e=0){return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return fi(this,t,Js(this,t,e,i))}moveByGroup(t,e){return fi(this,t,Js(this,t,e,i=>Wr(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return Fr(this,t,e,i)}moveVertically(t,e,i){return fi(this,t,zr(this,t,e,i))}scrollPosIntoView(t){this.dispatch({effects:ni.of(w.cursor(t))})}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Us(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),r=this.bidiSpans(s),o=r[Ht.find(r,t-s.from,-1,e)];return me(i,o.dir==F.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>bo)return Ls(t.length);let e=this.textDirection;for(let s of this.bidiCache)if(s.from==t.from&&s.dir==e)return s.order;let i=Mr(t.text,this.textDirection);return this.bidiCache.push(new ke(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||y.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{ns(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Os.of(new Vt(typeof t=="number"?w.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return it.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=bt.newName(),s=[wn.of(i),Qt.of(yi(`.${i}`,t))];return e&&e.dark&&s.push(pi.of(!0)),s}static baseTheme(t){return Re.lowest(Qt.of(yi("."+mi,t,xn)))}}R.scrollTo=ni,R.centerOn=Ds,R.styleModule=Qt,R.inputHandler=Ms,R.exceptionSink=Cs,R.updateListener=si,R.editable=Xt,R.mouseSelectionStyle=As,R.dragMovesSelection=ks,R.clickAddsSelectionRange=vs,R.decorations=Ct,R.darkTheme=pi,R.contentAttributes=Bs,R.editorAttributes=Rs,R.lineWrapping=R.contentAttributes.of({class:"cm-lineWrapping"}),R.announce=E.define();const bo=4096;function bi(n,t){return(n??t.contentDOM.getBoundingClientRect().top)+t.viewState.paddingTop}let Si=-1;function So(){window.addEventListener("resize",()=>{Si==-1&&(Si=setTimeout(xo,50))})}function xo(){Si=-1;let n=document.querySelectorAll(".cm-content");for(let t=0;t<n.length;t++){let e=T.get(n[t]);e&&e.editorView.requestMeasure()}}const kn={};class ke{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:F.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==s&&!e.touchesRange(o.from,o.to)&&i.push(new ke(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}}function An(n,t,e){for(let i=n.state.facet(t),s=i.length-1;s>=0;s--){let r=i[s],o=typeof r=="function"?r(n):r;o&&Qe(o,e)}return e}const vo=y.mac?"mac":y.windows?"win":y.linux?"linux":"key";function ko(n,t){const e=n.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let s,r,o,l;for(let h=0;h<e.length-1;++h){const a=e[h];if(/^(cmd|meta|m)$/i.test(a))l=!0;else if(/^a(lt)?$/i.test(a))s=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))t=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+a)}return s&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function xi(n,t,e){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),e!==!1&&t.shiftKey&&(n="Shift-"+n),n}const Ao=R.domEventHandlers({keydown(n,t){return On(Dn(t.state),n,t,"editor")}}),Cn=S.define({enables:Ao}),Mn=new WeakMap;function Dn(n){let t=n.facet(Cn),e=Mn.get(t);return e||Mn.set(t,e=Do(t.reduce((i,s)=>i.concat(s),[]))),e}function Co(n,t,e){return On(Dn(n.state),t,n,e)}let gt=null;const Mo=4e3;function Do(n,t=vo){let e=Object.create(null),i=Object.create(null),s=(o,l)=>{let h=i[o];if(h==null)i[o]=l;else if(h!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,h,a)=>{let f=e[o]||(e[o]=Object.create(null)),c=l.split(/ (?!$)/).map(g=>ko(g,t));for(let g=1;g<c.length;g++){let p=c.slice(0,g).join(" ");s(p,!0),f[p]||(f[p]={preventDefault:!0,commands:[m=>{let b=gt={view:m,prefix:p,scope:o};return setTimeout(()=>{gt==b&&(gt=null)},Mo),!0}]})}let d=c.join(" ");s(d,!1);let u=f[d]||(f[d]={preventDefault:!1,commands:[]});u.commands.push(h),a&&(u.preventDefault=!0)};for(let o of n){let l=o[t]||o.key;if(!!l)for(let h of o.scope?o.scope.split(" "):["editor"])r(h,l,o.run,o.preventDefault),o.shift&&r(h,"Shift-"+l,o.shift,o.preventDefault)}return e}function On(n,t,e,i){let s=ar(t),r=s.length==1&&s!=" ",o="",l=!1;gt&&gt.view==e&&gt.scope==i&&(o=gt.prefix+" ",(l=Xs.indexOf(t.keyCode)<0)&&(gt=null));let h=c=>{if(c){for(let d of c.commands)if(d(e))return!0;c.preventDefault&&(l=!0)}return!1},a=n[i],f;if(a){if(h(a[o+xi(s,t,!r)]))return!0;if(r&&(t.shiftKey||t.altKey||t.metaKey)&&(f=ct[t.keyCode])&&f!=s){if(h(a[o+xi(f,t,!0)]))return!0}else if(r&&t.shiftKey&&h(a[o+xi(s,t,!0)]))return!0}return l}const Tn=!y.ios,te=S.define({combine(n){return Le(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})}});function Oo(n={}){return[te.of(n),To,Ro]}class Rn{constructor(t,e,i,s,r){this.left=t,this.top=e,this.width=i,this.height=s,this.className=r}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width>=0&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}}const To=it.fromClass(class{constructor(n){this.view=n,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=n.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=n.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),n.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(te).cursorBlinkRate+"ms"}update(n){let t=n.startState.facet(te)!=n.state.facet(te);(t||n.selectionSet||n.geometryChanged||n.viewportChanged)&&this.view.requestMeasure(this.measureReq),n.transactions.some(e=>e.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),t&&this.setBlinkRate()}readPos(){let{state:n}=this.view,t=n.facet(te),e=n.selection.ranges.map(s=>s.empty?[]:Bo(this.view,s)).reduce((s,r)=>s.concat(r)),i=[];for(let s of n.selection.ranges){let r=s==n.selection.main;if(s.empty?!r||Tn:t.drawRangeCursor){let o=Eo(this.view,s,r);o&&i.push(o)}}return{rangePieces:e,cursors:i}}drawSel({rangePieces:n,cursors:t}){if(n.length!=this.rangePieces.length||n.some((e,i)=>!e.eq(this.rangePieces[i]))){this.selectionLayer.textContent="";for(let e of n)this.selectionLayer.appendChild(e.draw());this.rangePieces=n}if(t.length!=this.cursors.length||t.some((e,i)=>!e.eq(this.cursors[i]))){let e=this.cursorLayer.children;if(e.length!==t.length){this.cursorLayer.textContent="";for(const i of t)this.cursorLayer.appendChild(i.draw())}else t.forEach((i,s)=>i.adjust(e[s]));this.cursors=t}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),Bn={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Tn&&(Bn[".cm-line"].caretColor="transparent !important");const Ro=Re.highest(R.theme(Bn));function En(n){let t=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==F.LTR?t.left:t.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:t.top-n.scrollDOM.scrollTop}}function Pn(n,t,e){let i=w.cursor(t);return{from:Math.max(e.from,n.moveToLineBoundary(i,!1,!0).from),to:Math.min(e.to,n.moveToLineBoundary(i,!0,!0).from),type:A.Text}}function Ln(n,t){let e=n.lineBlockAt(t);if(Array.isArray(e.type)){for(let i of e.type)if(i.to>t||i.to==t&&(i.to==e.to||i.type==A.Text))return i}return e}function Bo(n,t){if(t.to<=n.viewport.from||t.from>=n.viewport.to)return[];let e=Math.max(t.from,n.viewport.from),i=Math.min(t.to,n.viewport.to),s=n.textDirection==F.LTR,r=n.contentDOM,o=r.getBoundingClientRect(),l=En(n),h=window.getComputedStyle(r.firstChild),a=o.left+parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)),f=o.right-parseInt(h.paddingRight),c=Ln(n,e),d=Ln(n,i),u=c.type==A.Text?c:null,g=d.type==A.Text?d:null;if(n.lineWrapping&&(u&&(u=Pn(n,e,u)),g&&(g=Pn(n,i,g))),u&&g&&u.from==g.from)return m(b(t.from,t.to,u));{let x=u?b(t.from,null,u):L(c,!1),O=g?b(null,t.to,g):L(d,!0),I=[];return(u||c).to<(g||d).from-1?I.push(p(a,x.bottom,f,O.top)):x.bottom<O.top&&n.elementAtHeight((x.bottom+O.top)/2).type==A.Text&&(x.bottom=O.top=(x.bottom+O.top)/2),m(x).concat(I).concat(m(O))}function p(x,O,I,rt){return new Rn(x-l.left,O-l.top-.01,I-x,rt-O+.01,"cm-selectionBackground")}function m({top:x,bottom:O,horizontal:I}){let rt=[];for(let ot=0;ot<I.length;ot+=2)rt.push(p(I[ot],x,I[ot+1],O));return rt}function b(x,O,I){let rt=1e9,ot=-1e9,ie=[];function Ai(pt,lt,Mt,mt,Ft){let ht=n.coordsAtPos(pt,pt==I.to?-2:2),at=n.coordsAtPos(Mt,Mt==I.from?2:-2);rt=Math.min(ht.top,at.top,rt),ot=Math.max(ht.bottom,at.bottom,ot),Ft==F.LTR?ie.push(s&&lt?a:ht.left,s&&mt?f:at.right):ie.push(!s&&mt?a:at.left,!s&&lt?f:ht.right)}let se=x??I.from,ne=O??I.to;for(let pt of n.visibleRanges)if(pt.to>se&&pt.from<ne)for(let lt=Math.max(pt.from,se),Mt=Math.min(pt.to,ne);;){let mt=n.state.doc.lineAt(lt);for(let Ft of n.bidiSpans(mt)){let ht=Ft.from+mt.from,at=Ft.to+mt.from;if(ht>=Mt)break;at>lt&&Ai(Math.max(ht,lt),x==null&&ht<=se,Math.min(at,Mt),O==null&&at>=ne,Ft.dir)}if(lt=mt.to+1,lt>=Mt)break}return ie.length==0&&Ai(se,x==null,ne,O==null,n.textDirection),{top:rt,bottom:ot,horizontal:ie}}function L(x,O){let I=o.top+(O?x.top:x.bottom);return{top:I,bottom:I,horizontal:[]}}}function Eo(n,t,e){let i=n.coordsAtPos(t.head,t.assoc||1);if(!i)return null;let s=En(n);return new Rn(i.left-s.left,i.top-s.top,-1,i.bottom-i.top,e?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const In=E.define({map(n,t){return n==null?null:t.mapPos(n)}}),ee=wt.define({create(){return null},update(n,t){return n!=null&&(n=t.changes.mapPos(n)),t.effects.reduce((e,i)=>i.is(In)?i.value:e,n)}}),Po=it.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var t;let e=n.state.field(ee);e==null?this.cursor!=null&&((t=this.cursor)===null||t===void 0||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(ee)!=e||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(ee),t=n!=null&&this.view.coordsAtPos(n);if(!t)return null;let e=this.view.scrollDOM.getBoundingClientRect();return{left:t.left-e.left+this.view.scrollDOM.scrollLeft,top:t.top-e.top+this.view.scrollDOM.scrollTop,height:t.bottom-t.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(ee)!=n&&this.view.dispatch({effects:In.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Lo(){return[ee,Po]}function Nn(n,t,e,i,s){t.lastIndex=0;for(let r=n.iterRange(e,i),o=e,l;!r.next().done;o+=r.value.length)if(!r.lineBreak)for(;l=t.exec(r.value);)s(o+l.index,o+l.index+l[0].length,l)}function Io(n,t){let e=n.visibleRanges;if(e.length==1&&e[0].from==n.viewport.from&&e[0].to==n.viewport.to)return e;let i=[];for(let{from:s,to:r}of e)s=Math.max(n.state.doc.lineAt(s).from,s-t),r=Math.min(n.state.doc.lineAt(r).to,r+t),i.length&&i[i.length-1].to>=s?i[i.length-1].to=r:i.push({from:s,to:r});return i}class No{constructor(t){let{regexp:e,decoration:i,boundary:s,maxLength:r=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=e,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=s,this.maxLength=r}createDeco(t){let e=new Pt;for(let{from:i,to:s}of Io(t,this.maxLength))Nn(t.state.doc,this.regexp,i,s,(r,o,l)=>e.add(r,o,this.getDeco(l,t,r)));return e.finish()}updateDeco(t,e){let i=1e9,s=-1;return t.docChanged&&t.changes.iterChanges((r,o,l,h)=>{h>t.view.viewport.from&&l<t.view.viewport.to&&(i=Math.min(l,i),s=Math.max(h,s))}),t.viewportChanged||s-i>1e3?this.createDeco(t.view):s>-1?this.updateRange(t.view,e.map(t.changes),i,s):e}updateRange(t,e,i,s){for(let r of t.visibleRanges){let o=Math.max(r.from,i),l=Math.min(r.to,s);if(l>o){let h=t.state.doc.lineAt(o),a=h.to<l?t.state.doc.lineAt(l):h,f=Math.max(r.from,h.from),c=Math.min(r.to,a.to);if(this.boundary){for(;o>h.from;o--)if(this.boundary.test(h.text[o-1-h.from])){f=o;break}for(;l<a.to;l++)if(this.boundary.test(a.text[l-a.from])){c=l;break}}let d=[],u;if(h==a)for(this.regexp.lastIndex=f-h.from;(u=this.regexp.exec(h.text))&&u.index<c-h.from;){let g=u.index+h.from;d.push(this.getDeco(u,t,g).range(g,g+u[0].length))}else Nn(t.state.doc,this.regexp,f,c,(g,p,m)=>d.push(this.getDeco(m,t,g).range(g,p)));e=e.update({filterFrom:f,filterTo:c,filter:(g,p)=>g<f||p>c,add:d})}}return e}}const vi=/x/.unicode!=null?"gu":"g",Vo=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮\uFEFF￹-￼]`,vi),Ho={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let ki=null;function Fo(){var n;if(ki==null&&typeof document!="undefined"&&document.body){let t=document.body.style;ki=((n=t.tabSize)!==null&&n!==void 0?n:t.MozTabSize)!=null}return ki||!1}const Ae=S.define({combine(n){let t=Le(n,{render:null,specialChars:Vo,addSpecialChars:null});return(t.replaceTabs=!Fo())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,vi)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,vi)),t}});function Wo(n={}){return[Ae.of(n),zo()]}let Vn=null;function zo(){return Vn||(Vn=it.fromClass(class{constructor(n){this.view=n,this.decorations=M.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(Ae)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new No({regexp:n.specialChars,decoration:(t,e,i)=>{let{doc:s}=e.state,r=Wt(t[0],0);if(r==9){let o=s.lineAt(i),l=e.state.tabSize,h=Ri(o.text,l,i-o.from);return M.replace({widget:new $o((l-h%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[r]||(this.decorationCache[r]=M.replace({widget:new jo(n,r)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let t=n.state.facet(Ae);n.startState.facet(Ae)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const qo="•";function Ko(n){return n>=32?qo:n==10?"␤":String.fromCharCode(9216+n)}class jo extends vt{constructor(t,e){super();this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=Ko(this.code),i=t.state.phrase("Control character")+" "+(Ho[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,i,e);if(s)return s;let r=document.createElement("span");return r.textContent=e,r.title=i,r.setAttribute("aria-label",i),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class $o extends vt{constructor(t){super();this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function Uo(){return Jo}const Go=M.line({class:"cm-activeLine"}),Jo=it.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let t=-1,e=[];for(let i of n.state.selection.ranges){if(!i.empty)return M.none;let s=n.lineBlockAt(i.head);s.from>t&&(e.push(Go.range(s.from)),t=s.from)}return M.set(e)}},{decorations:n=>n.decorations});export{Rt as A,A as B,V as C,F as D,R as E,S as F,G as M,$ as P,P as R,wt as S,z as T,it as V,vt as W,w as a,tt as b,Le as c,E as d,Et as e,M as f,Pt as g,Ce as h,Wt as i,Q as j,Wn as k,Re as l,dt as m,Cn as n,Bi as o,Ri as p,Wo as q,Co as r,Oo as s,Lo as t,k as u,Uo as v,v as w,X as x,bt as y};
