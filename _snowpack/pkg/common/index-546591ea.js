import{F as Pe,c as Oe,E as D,S as Ue,f as C,a,p as q,w as H,D as m,x as b,P as Ve}from"./index-58a76124.js";import{s as S,N as A,a as M,g as G,I as j,b as K,c as Ge}from"./index-5d650ab5.js";const Fe=D.baseTheme({".cm-matchingBracket":{backgroundColor:"#328c8252"},".cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),_=1e4,W="()[]{}",J=Pe.define({combine(e){return Oe(e,{afterCursor:!0,brackets:W,maxScanDistance:_})}}),ve=C.mark({class:"cm-matchingBracket"}),ze=C.mark({class:"cm-nonmatchingBracket"}),Ne=Ue.define({create(){return C.none},update(e,t){if(!t.docChanged&&!t.selection)return e;let r=[],n=t.state.facet(J);for(let c of t.state.selection.ranges){if(!c.empty)continue;let o=h(t.state,c.head,-1,n)||c.head>0&&h(t.state,c.head-1,1,n)||n.afterCursor&&(h(t.state,c.head,1,n)||c.head<t.state.doc.length&&h(t.state,c.head+1,-1,n));if(!o)continue;let l=o.matched?ve:ze;r.push(l.range(o.start.from,o.start.to)),o.end&&r.push(l.range(o.end.from,o.end.to))}return C.set(r,!0)},provide:e=>D.decorations.from(e)}),qe=[Ne,Fe];function He(e={}){return[J.of(e),qe]}function F(e,t,r){let n=e.prop(t<0?A.openedBy:A.closedBy);if(n)return n;if(e.name.length==1){let c=r.indexOf(e.name);if(c>-1&&c%2==(t<0?1:0))return[r[c+t]]}return null}function h(e,t,r,n={}){let c=n.maxScanDistance||_,o=n.brackets||W,l=S(e),u=l.resolveInner(t,r);for(let i=u;i;i=i.parent){let s=F(i.type,r,o);if(s&&i.from<i.to)return je(e,t,r,i,s,o)}return Ke(e,t,r,l,u.type,c,o)}function je(e,t,r,n,c,o){let l=n.parent,u={from:n.from,to:n.to},i=0,s=l==null?void 0:l.cursor;if(s&&(r<0?s.childBefore(n.from):s.childAfter(n.to)))do if(r<0?s.to<=n.from:s.from>=n.to){if(i==0&&c.indexOf(s.type.name)>-1&&s.from<s.to)return{start:u,end:{from:s.from,to:s.to},matched:!0};if(F(s.type,r,o))i++;else if(F(s.type,-r,o)&&(i--,i==0))return{start:u,end:s.from==s.to?void 0:{from:s.from,to:s.to},matched:!1}}while(r<0?s.prevSibling():s.nextSibling());return{start:u,matched:!1}}function Ke(e,t,r,n,c,o,l){let u=r<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),i=l.indexOf(u);if(i<0||i%2==0!=r>0)return null;let s={from:r<0?t-1:t,to:r>0?t+1:t},f=e.doc.iterRange(t,r>0?e.doc.length:0),g=0;for(let L=0;!f.next().done&&L<=o;){let x=f.value;r<0&&(L+=x.length);let U=t+L*r;for(let k=r>0?0:x.length-1,Ie=r>0?x.length:-1;k!=Ie;k+=r){let V=l.indexOf(x[k]);if(!(V<0||n.resolve(U+k,1).type!=c))if(V%2==0==r>0)g++;else{if(g==1)return{start:s,end:{from:U+k,to:U+k+1},matched:V>>1==i>>1};g--}}r>0&&(L+=x.length)}return f.done?{start:s,matched:!1}:null}function B(e,t){return a.create(e.ranges.map(t),e.mainIndex)}function d(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function p({state:e,dispatch:t},r){let n=B(e.selection,r);return n.eq(e.selection)?!1:(t(d(e,n)),!0)}function R(e,t){return a.cursor(t?e.to:e.from)}function Q(e,t){return p(e,r=>r.empty?e.moveByChar(r,t):R(r,t))}const X=e=>Q(e,e.textDirection!=m.LTR),Y=e=>Q(e,e.textDirection==m.LTR);function Z(e,t){return p(e,r=>r.empty?e.moveByGroup(r,t):R(r,t))}const _e=e=>Z(e,e.textDirection!=m.LTR),We=e=>Z(e,e.textDirection==m.LTR);function Je(e,t,r){if(t.type.prop(r))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function E(e,t,r){let n=S(e).resolveInner(t.head),c=r?A.closedBy:A.openedBy;for(let i=t.head;;){let s=r?n.childAfter(i):n.childBefore(i);if(!s)break;Je(e,s,c)?n=s:i=r?s.to:s.from}let o=n.type.prop(c),l,u;return o&&(l=r?h(e,n.from,1):h(e,n.to,-1))&&l.matched?u=r?l.end.to:l.end.from:u=r?n.to:n.from,a.cursor(u,r?-1:1)}const Qe=e=>p(e,t=>E(e.state,t,e.textDirection!=m.LTR)),Xe=e=>p(e,t=>E(e.state,t,e.textDirection==m.LTR));function $(e,t){return p(e,r=>{if(!r.empty)return R(r,t);let n=e.moveVertically(r,t);return n.head!=r.head?n:e.moveToLineBoundary(r,t)})}const w=e=>$(e,!1),ee=e=>$(e,!0);function te(e,t){let{state:r}=e,n=B(r.selection,l=>l.empty?e.moveVertically(l,t,e.dom.clientHeight):R(l,t));if(n.eq(r.selection))return!1;let c=e.coordsAtPos(r.selection.main.head),o=e.scrollDOM.getBoundingClientRect();return e.dispatch(d(r,n),{effects:c&&c.top>o.top&&c.bottom<o.bottom?D.scrollIntoView(n.main.head,{y:"start",yMargin:c.top-o.top}):void 0}),!0}const ne=e=>te(e,!1),v=e=>te(e,!0);function T(e,t,r){let n=e.lineBlockAt(t.head),c=e.moveToLineBoundary(t,r);if(c.head==t.head&&c.head!=(r?n.to:n.from)&&(c=e.moveToLineBoundary(t,r,!1)),!r&&c.head==n.from&&n.length){let o=/^\s*/.exec(e.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;o&&t.head!=n.from+o&&(c=a.cursor(n.from+o))}return c}const re=e=>p(e,t=>T(e,t,!0)),oe=e=>p(e,t=>T(e,t,!1)),Ye=e=>p(e,t=>a.cursor(e.lineBlockAt(t.head).from,1)),Ze=e=>p(e,t=>a.cursor(e.lineBlockAt(t.head).to,-1));function $e(e,t,r){let n=!1,c=B(e.selection,o=>{let l=h(e,o.head,-1)||h(e,o.head,1)||o.head>0&&h(e,o.head-1,1)||o.head<e.doc.length&&h(e,o.head+1,-1);if(!l||!l.end)return o;n=!0;let u=l.start.from==o.head?l.end.to:l.end.from;return r?a.range(o.anchor,u):a.cursor(u)});return n?(t(d(e,c)),!0):!1}const we=({state:e,dispatch:t})=>$e(e,t,!1);function y(e,t){let r=B(e.state.selection,n=>{let c=t(n);return a.range(n.anchor,c.head,c.goalColumn)});return r.eq(e.state.selection)?!1:(e.dispatch(d(e.state,r)),!0)}function ce(e,t){return y(e,r=>e.moveByChar(r,t))}const le=e=>ce(e,e.textDirection!=m.LTR),ue=e=>ce(e,e.textDirection==m.LTR);function ie(e,t){return y(e,r=>e.moveByGroup(r,t))}const et=e=>ie(e,e.textDirection!=m.LTR),tt=e=>ie(e,e.textDirection==m.LTR),nt=e=>y(e,t=>E(e.state,t,e.textDirection!=m.LTR)),rt=e=>y(e,t=>E(e.state,t,e.textDirection==m.LTR));function se(e,t){return y(e,r=>e.moveVertically(r,t))}const ae=e=>se(e,!1),fe=e=>se(e,!0);function me(e,t){return y(e,r=>e.moveVertically(r,t,e.dom.clientHeight))}const he=e=>me(e,!1),de=e=>me(e,!0),ye=e=>y(e,t=>T(e,t,!0)),pe=e=>y(e,t=>T(e,t,!1)),ot=e=>y(e,t=>a.cursor(e.lineBlockAt(t.head).from)),ct=e=>y(e,t=>a.cursor(e.lineBlockAt(t.head).to)),ge=({state:e,dispatch:t})=>(t(d(e,{anchor:0})),!0),ke=({state:e,dispatch:t})=>(t(d(e,{anchor:e.doc.length})),!0),Be=({state:e,dispatch:t})=>(t(d(e,{anchor:e.selection.main.anchor,head:0})),!0),xe=({state:e,dispatch:t})=>(t(d(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),lt=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),ut=({state:e,dispatch:t})=>{let r=O(e).map(({from:n,to:c})=>a.range(n,Math.min(c+1,e.doc.length)));return t(e.update({selection:a.create(r),userEvent:"select"})),!0},it=({state:e,dispatch:t})=>{let r=B(e.selection,n=>{var c;let o=S(e).resolveInner(n.head,1);for(;!(o.from<n.from&&o.to>=n.to||o.to>n.to&&o.from<=n.from||!((c=o.parent)===null||c===void 0?void 0:c.parent));)o=o.parent;return a.range(o.to,o.from)});return t(d(e,r)),!0},st=({state:e,dispatch:t})=>{let r=e.selection,n=null;return r.ranges.length>1?n=a.create([r.main]):r.main.empty||(n=a.create([a.cursor(r.main.head)])),n?(t(d(e,n)),!0):!1};function I({state:e,dispatch:t},r){if(e.readOnly)return!1;let n="delete.selection",c=e.changeByRange(o=>{let{from:l,to:u}=o;if(l==u){let i=r(l);i<l?n="delete.backward":i>l&&(n="delete.forward"),l=Math.min(l,i),u=Math.max(u,i)}return l==u?{range:o}:{changes:{from:l,to:u},range:a.cursor(l)}});return c.changes.empty?!1:(t(e.update(c,{scrollIntoView:!0,userEvent:n})),!0)}function P(e,t,r){if(e instanceof D)for(let n of e.pluginField(Ve.atomicRanges))n.between(t,t,(c,o)=>{c<t&&o>t&&(t=r?o:c)});return t}const Ae=(e,t)=>I(e,r=>{let{state:n}=e,c=n.doc.lineAt(r),o,l;if(!t&&r>c.from&&r<c.from+200&&!/[^ \t]/.test(o=c.text.slice(0,r-c.from))){if(o[o.length-1]=="	")return r-1;let u=q(o,n.tabSize),i=u%G(n)||G(n);for(let s=0;s<i&&o[o.length-1-s]==" ";s++)r--;l=r}else l=b(c.text,r-c.from,t,t)+c.from,l==r&&c.number!=(t?n.doc.lines:1)&&(l+=t?1:-1);return P(e,l,t)}),z=e=>Ae(e,!1),Le=e=>Ae(e,!0),De=(e,t)=>I(e,r=>{let n=r,{state:c}=e,o=c.doc.lineAt(n),l=c.charCategorizer(n);for(let u=null;;){if(n==(t?o.to:o.from)){n==r&&o.number!=(t?c.doc.lines:1)&&(n+=t?1:-1);break}let i=b(o.text,n-o.from,t)+o.from,s=o.text.slice(Math.min(n,i)-o.from,Math.max(n,i)-o.from),f=l(s);if(u!=null&&f!=u)break;(s!=" "||n!=r)&&(u=f),n=i}return P(e,n,t)}),Ce=e=>De(e,!1),at=e=>De(e,!0),be=e=>I(e,t=>{let r=e.lineBlockAt(t).to;return P(e,t<r?r:Math.min(e.state.doc.length,t+1),!0)}),ft=e=>I(e,t=>{let r=e.lineBlockAt(t).from;return P(e,t>r?r:Math.max(0,t-1),!1)}),mt=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:H.of(["",""])},range:a.cursor(n.from)}));return t(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0},ht=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>{if(!n.empty||n.from==0||n.from==e.doc.length)return{range:n};let c=n.from,o=e.doc.lineAt(c),l=c==o.from?c-1:b(o.text,c-o.from,!1)+o.from,u=c==o.to?c+1:b(o.text,c-o.from,!0)+o.from;return{changes:{from:l,to:u,insert:e.doc.slice(c,u).append(e.doc.slice(l,c))},range:a.cursor(u)}});return r.changes.empty?!1:(t(e.update(r,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function O(e){let t=[],r=-1;for(let n of e.selection.ranges){let c=e.doc.lineAt(n.from),o=e.doc.lineAt(n.to);if(!n.empty&&n.to==o.from&&(o=e.doc.lineAt(n.to-1)),r>=c.number){let l=t[t.length-1];l.to=o.to,l.ranges.push(n)}else t.push({from:c.from,to:o.to,ranges:[n]});r=o.number+1}return t}function Se(e,t,r){if(e.readOnly)return!1;let n=[],c=[];for(let o of O(e)){if(r?o.to==e.doc.length:o.from==0)continue;let l=e.doc.lineAt(r?o.to+1:o.from-1),u=l.length+1;if(r){n.push({from:o.to,to:l.to},{from:o.from,insert:l.text+e.lineBreak});for(let i of o.ranges)c.push(a.range(Math.min(e.doc.length,i.anchor+u),Math.min(e.doc.length,i.head+u)))}else{n.push({from:l.from,to:o.from},{from:o.to,insert:e.lineBreak+l.text});for(let i of o.ranges)c.push(a.range(i.anchor-u,i.head-u))}}return n.length?(t(e.update({changes:n,scrollIntoView:!0,selection:a.create(c,e.selection.mainIndex),userEvent:"move.line"})),!0):!1}const dt=({state:e,dispatch:t})=>Se(e,t,!1),yt=({state:e,dispatch:t})=>Se(e,t,!0);function Me(e,t,r){if(e.readOnly)return!1;let n=[];for(let c of O(e))r?n.push({from:c.from,insert:e.doc.slice(c.from,c.to)+e.lineBreak}):n.push({from:c.to,insert:e.lineBreak+e.doc.slice(c.from,c.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const pt=({state:e,dispatch:t})=>Me(e,t,!1),gt=({state:e,dispatch:t})=>Me(e,t,!0),kt=e=>{if(e.state.readOnly)return!1;let{state:t}=e,r=t.changes(O(t).map(({from:c,to:o})=>(c>0?c--:o<t.doc.length&&o++,{from:c,to:o}))),n=B(t.selection,c=>e.moveVertically(c,!0)).map(r);return e.dispatch({changes:r,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Bt(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let r=S(e).resolveInner(t),n=r.childBefore(t),c=r.childAfter(t),o;return n&&c&&n.to<=t&&c.from>=t&&(o=n.type.prop(A.closedBy))&&o.indexOf(c.name)>-1&&e.doc.lineAt(n.to).from==e.doc.lineAt(c.from).from?{from:n.to,to:c.from}:null}const xt=Re(!1),At=Re(!0);function Re(e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let n=t.changeByRange(c=>{let{from:o,to:l}=c,u=t.doc.lineAt(o),i=!e&&o==l&&Bt(t,o);e&&(o=l=(l<=u.to?u:t.doc.lineAt(l)).to);let s=new j(t,{simulateBreak:o,simulateDoubleBreak:!!i}),f=K(s,o);for(f==null&&(f=/^\s*/.exec(t.doc.lineAt(o).text)[0].length);l<u.to&&/\s/.test(u.text[l-u.from]);)l++;i?{from:o,to:l}=i:o>u.from&&o<u.from+100&&!/\S/.test(u.text.slice(0,o))&&(o=u.from);let g=["",M(t,f)];return i&&g.push(M(t,s.lineIndent(u.from,-1))),{changes:{from:o,to:l,insert:H.of(g)},range:a.cursor(o+1+g[1].length)}});return r(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function N(e,t){let r=-1;return e.changeByRange(n=>{let c=[];for(let l=n.from;l<=n.to;){let u=e.doc.lineAt(l);u.number>r&&(n.empty||n.to>u.from)&&(t(u,c,n),r=u.number),l=u.to+1}let o=e.changes(c);return{changes:c,range:a.range(o.mapPos(n.anchor,1),o.mapPos(n.head,1))}})}const Lt=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=Object.create(null),n=new j(e,{overrideIndentation:o=>{let l=r[o];return l??-1}}),c=N(e,(o,l,u)=>{let i=K(n,o.from);if(i==null)return;/\S/.test(o.text)||(i=0);let s=/^\s*/.exec(o.text)[0],f=M(e,i);(s!=f||u.from<o.from+s.length)&&(r[o.from]=i,l.push({from:o.from,to:o.from+s.length,insert:f}))});return c.changes.empty||t(e.update(c,{userEvent:"indent"})),!0},Ee=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(N(e,(r,n)=>{n.push({from:r.from,insert:e.facet(Ge)})}),{userEvent:"input.indent"})),!0),Te=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(N(e,(r,n)=>{let c=/^\s*/.exec(r.text)[0];if(!c)return;let o=q(c,e.tabSize),l=0,u=M(e,Math.max(0,o-G(e)));for(;l<c.length&&l<u.length&&c.charCodeAt(l)==u.charCodeAt(l);)l++;n.push({from:r.from+l,to:r.from+c.length,insert:u.slice(l)})}),{userEvent:"delete.dedent"})),!0),Dt=[{key:"Ctrl-b",run:X,shift:le,preventDefault:!0},{key:"Ctrl-f",run:Y,shift:ue},{key:"Ctrl-p",run:w,shift:ae},{key:"Ctrl-n",run:ee,shift:fe},{key:"Ctrl-a",run:Ye,shift:ot},{key:"Ctrl-e",run:Ze,shift:ct},{key:"Ctrl-d",run:Le},{key:"Ctrl-h",run:z},{key:"Ctrl-k",run:be},{key:"Ctrl-Alt-h",run:Ce},{key:"Ctrl-o",run:mt},{key:"Ctrl-t",run:ht},{key:"Ctrl-v",run:v}],Ct=[{key:"ArrowLeft",run:X,shift:le,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:_e,shift:et},{mac:"Cmd-ArrowLeft",run:oe,shift:pe},{key:"ArrowRight",run:Y,shift:ue,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:We,shift:tt},{mac:"Cmd-ArrowRight",run:re,shift:ye},{key:"ArrowUp",run:w,shift:ae,preventDefault:!0},{mac:"Cmd-ArrowUp",run:ge,shift:Be},{mac:"Ctrl-ArrowUp",run:ne,shift:he},{key:"ArrowDown",run:ee,shift:fe,preventDefault:!0},{mac:"Cmd-ArrowDown",run:ke,shift:xe},{mac:"Ctrl-ArrowDown",run:v,shift:de},{key:"PageUp",run:ne,shift:he},{key:"PageDown",run:v,shift:de},{key:"Home",run:oe,shift:pe},{key:"Mod-Home",run:ge,shift:Be},{key:"End",run:re,shift:ye},{key:"Mod-End",run:ke,shift:xe},{key:"Enter",run:xt},{key:"Mod-a",run:lt},{key:"Backspace",run:z,shift:z},{key:"Delete",run:Le},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Ce},{key:"Mod-Delete",mac:"Alt-Delete",run:at},{mac:"Mod-Backspace",run:ft},{mac:"Mod-Delete",run:be}].concat(Dt.map(e=>({mac:e.key,run:e.run,shift:e.shift}))),bt=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Qe,shift:nt},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Xe,shift:rt},{key:"Alt-ArrowUp",run:dt},{key:"Shift-Alt-ArrowUp",run:pt},{key:"Alt-ArrowDown",run:yt},{key:"Shift-Alt-ArrowDown",run:gt},{key:"Escape",run:st},{key:"Mod-Enter",run:At},{key:"Alt-l",mac:"Ctrl-l",run:ut},{key:"Mod-i",run:it,preventDefault:!0},{key:"Mod-[",run:Te},{key:"Mod-]",run:Ee},{key:"Mod-Alt-\\",run:Lt},{key:"Shift-Mod-k",run:kt},{key:"Shift-Mod-\\",run:we}].concat(Ct),St={key:"Tab",run:Ee,shift:Te};export{He as b,bt as d,St as i};
