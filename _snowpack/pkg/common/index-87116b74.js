import{N as F,d as $,s as W}from"./index-5d650ab5.js";import{E as _,F as J,y as z,l as ee,V as te,f as G,g as ie}from"./index-58a76124.js";let ae=0;class d{constructor(e,i,a){this.set=e,this.base=i,this.modified=a,this.id=ae++}static define(e){if(e==null?void 0:e.base)throw new Error("Can not derive from a modified tag");let i=new d([],null,[]);if(i.set.push(i),e)for(let a of e.set)i.set.push(a);return i}static defineModifier(){let e=new R;return i=>i.modified.indexOf(e)>-1?i:R.get(i.base||i,i.modified.concat(e).sort((a,n)=>a.id-n.id))}}let ne=0;class R{constructor(){this.instances=[],this.id=ne++}static get(e,i){if(!i.length)return e;let a=i[0].instances.find(s=>s.base==e&&le(i,s.modified));if(a)return a;let n=[],o=new d(n,e,i);for(let s of i)s.instances.push(o);let h=L(i);for(let s of e.set)for(let c of h)n.push(R.get(s,c));return o}}function le(r,e){return r.length==e.length&&r.every((i,a)=>i==e[a])}function L(r){let e=[r];for(let i=0;i<r.length;i++)for(let a of L(r.slice(0,i).concat(r.slice(i+1))))e.push(a);return e}function re(r){let e=Object.create(null);for(let i in r){let a=r[i];Array.isArray(a)||(a=[a]);for(let n of i.split(" "))if(n){let o=[],h=2,s=n;for(let f=0;;){if(s=="..."&&f>0&&f+3==n.length){h=1;break}let b=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(s);if(!b)throw new RangeError("Invalid path: "+n);if(o.push(b[0]=="*"?null:b[0][0]=='"'?JSON.parse(b[0]):b[0]),f+=b[0].length,f==n.length)break;let y=n[f++];if(f==n.length&&y=="!"){h=0;break}if(y!="/")throw new RangeError("Invalid path: "+n);s=n.slice(f)}let c=o.length-1,w=o[c];if(!w)throw new RangeError("Invalid path: "+n);let p=new oe(a,h,c>0?o.slice(0,c):null);e[w]=p.sort(e[w])}}return Q.add(e)}const Q=new F,P=J.define({combine(r){return r.length?C.combinedMatch(r):null}}),U=J.define({combine(r){return r.length?r[0].match:null}});function B(r){return r.facet(P)||r.facet(U)}class oe{constructor(e,i,a,n){this.tags=e,this.mode=i,this.context=a,this.next=n}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}class C{constructor(e,i){this.map=Object.create(null);let a;function n(h){let s=z.newName();return(a||(a=Object.create(null)))["."+s]=h,s}this.all=typeof i.all=="string"?i.all:i.all?n(i.all):null;for(let h of e){let s=(h.class||n(Object.assign({},h,{tag:null})))+(this.all?" "+this.all:""),c=h.tag;if(!Array.isArray(c))this.map[c.id]=s;else for(let w of c)this.map[w.id]=s}this.module=a?new z(a):null,this.scope=i.scope||null,this.match=this.match.bind(this);let o=[he];this.module&&o.push(_.styleModule.of(this.module)),this.extension=o.concat(P.of(this)),this.fallback=o.concat(U.of(this))}match(e,i){if(this.scope&&i!=this.scope)return null;for(let a of e.set){let n=this.map[a.id];if(n!==void 0)return a!=e&&(this.map[e.id]=n),n}return this.map[e.id]=this.all}static combinedMatch(e){if(e.length==1)return e[0].match;let i=e.some(a=>a.scope)?void 0:Object.create(null);return(a,n)=>{let o=i&&i[a.id];if(o!==void 0)return o;let h=null;for(let s of e){let c=s.match(a,n);c&&(h=h?h+" "+c:c)}return i&&(i[a.id]=h),h}}static define(e,i){return new C(e,i||{})}static get(e,i,a){let n=B(e);return n&&n(i,a||$.none)}}class se{constructor(e){this.markCache=Object.create(null),this.tree=W(e.state),this.decorations=this.buildDeco(e,B(e.state))}update(e){let i=W(e.state),a=B(e.state),n=a!=e.startState.facet(P);i.length<e.view.viewport.to&&!n&&i.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(i!=this.tree||e.viewportChanged||n)&&(this.tree=i,this.decorations=this.buildDeco(e.view,a))}buildDeco(e,i){if(!i||!this.tree.length)return G.none;let a=new ie;for(let{from:n,to:o}of e.visibleRanges)fe(this.tree,n,o,i,(h,s,c)=>{a.add(h,s,this.markCache[c]||(this.markCache[c]=G.mark({class:c})))});return a.finish()}}const he=ee.high(te.fromClass(se,{decorations:r=>r.decorations})),X=[""];class ce{constructor(e,i,a){this.at=e,this.style=i,this.span=a,this.class=""}startSpan(e,i){i!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=i)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,i,a,n,o,h){let{type:s,from:c,to:w}=e;if(c>=a||w<=i)return;X[o]=s.name,s.isTop&&(h=s);let p=n,f=s.prop(Q),b=!1;for(;f;){if(!f.context||de(f.context,X,o)){for(let E of f.tags){let S=this.style(E,h);S&&(p&&(p+=" "),p+=S,f.mode==1?n+=(n?" ":"")+S:f.mode==0&&(b=!0))}break}f=f.next}if(this.startSpan(e.from,p),b)return;let y=e.tree&&e.tree.prop(F.mounted);if(y&&y.overlay){let E=e.node.enter(y.overlay[0].from+c,1),S=e.firstChild();for(let H=0,v=c;;H++){let M=H<y.overlay.length?y.overlay[H]:null,I=M?M.from+c:w,q=Math.max(i,v),A=Math.min(a,I);if(q<A&&S)for(;e.from<A&&(this.highlightRange(e,q,A,n,o+1,h),this.startSpan(Math.min(a,e.to),p),!(e.to>=I||!e.nextSibling())););if(!M||I>a)break;v=M.to+c,v>i&&(this.highlightRange(E.cursor,Math.max(i,M.from+c),Math.min(a,v),n,o,y.tree.type),this.startSpan(v,p))}S&&e.parent()}else if(e.firstChild()){do if(!(e.to<=i)){if(e.from>=a)break;this.highlightRange(e,i,a,n,o+1,h),this.startSpan(Math.min(a,e.to),p)}while(e.nextSibling());e.parent()}}}function fe(r,e,i,a,n){let o=new ce(e,a,n);o.highlightRange(r.cursor(),e,i,"",0,r.type),o.flush(i)}function de(r,e,i){if(r.length>i-1)return!1;for(let a=i-1,n=r.length-1;n>=0;n--,a--){let o=r[n];if(o&&o!=e[a])return!1}return!0}const t=d.define,D=t(),x=t(),Y=t(x),Z=t(x),k=t(),j=t(k),K=t(k),g=t(),N=t(g),u=t(),m=t(),V=t(),O=t(V),T=t(),l={comment:D,lineComment:t(D),blockComment:t(D),docComment:t(D),name:x,variableName:t(x),typeName:Y,tagName:t(Y),propertyName:Z,attributeName:t(Z),className:t(x),labelName:t(x),namespace:t(x),macroName:t(x),literal:k,string:j,docString:t(j),character:t(j),attributeValue:t(j),number:K,integer:t(K),float:t(K),bool:t(k),regexp:t(k),escape:t(k),color:t(k),url:t(k),keyword:u,self:t(u),null:t(u),atom:t(u),unit:t(u),modifier:t(u),operatorKeyword:t(u),controlKeyword:t(u),definitionKeyword:t(u),moduleKeyword:t(u),operator:m,derefOperator:t(m),arithmeticOperator:t(m),logicOperator:t(m),bitwiseOperator:t(m),compareOperator:t(m),updateOperator:t(m),definitionOperator:t(m),typeOperator:t(m),controlOperator:t(m),punctuation:V,separator:t(V),bracket:O,angleBracket:t(O),squareBracket:t(O),paren:t(O),brace:t(O),content:g,heading:N,heading1:t(N),heading2:t(N),heading3:t(N),heading4:t(N),heading5:t(N),heading6:t(N),contentSeparator:t(g),list:t(g),quote:t(g),emphasis:t(g),strong:t(g),link:t(g),monospace:t(g),strikethrough:t(g),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:T,documentMeta:t(T),annotation:t(T),processingInstruction:t(T),definition:d.defineModifier(),constant:d.defineModifier(),function:d.defineModifier(),standard:d.defineModifier(),local:d.defineModifier(),special:d.defineModifier()},ge=C.define([{tag:l.link,textDecoration:"underline"},{tag:l.heading,textDecoration:"underline",fontWeight:"bold"},{tag:l.emphasis,fontStyle:"italic"},{tag:l.strong,fontWeight:"bold"},{tag:l.strikethrough,textDecoration:"line-through"},{tag:l.keyword,color:"#708"},{tag:[l.atom,l.bool,l.url,l.contentSeparator,l.labelName],color:"#219"},{tag:[l.literal,l.inserted],color:"#164"},{tag:[l.string,l.deleted],color:"#a11"},{tag:[l.regexp,l.escape,l.special(l.string)],color:"#e40"},{tag:l.definition(l.variableName),color:"#00f"},{tag:l.local(l.variableName),color:"#30a"},{tag:[l.typeName,l.namespace],color:"#085"},{tag:l.className,color:"#167"},{tag:[l.special(l.variableName),l.macroName],color:"#256"},{tag:l.definition(l.propertyName),color:"#00c"},{tag:l.comment,color:"#940"},{tag:l.meta,color:"#7a757a"},{tag:l.invalid,color:"#f00"}]);export{ge as d,re as s,l as t};
